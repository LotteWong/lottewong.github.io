{"pages":[{"title":"About Me","text":"ç¨‹åºå‘˜å°é»„ï¼Œä¼šåƒç¦å»ºäººçš„å¹¿ä¸œäººï¼Œé¢ä¸´90åä¸­å¹´å±æœºï¼Œçˆ±çš„äººéƒ½å«å¤æ´›ç‰¹ã€‚","link":"/about/index.html"}],"posts":[{"title":"#Golang# Golangä¸å¹¶å‘ç¼–ç¨‹(4) Channelä½¿ç”¨","text":"æœ¬æ–‡ä¸»è¦è®¨è®º channel ä½¿ç”¨çš„ç›¸å…³å†…å®¹ã€‚ ç›®å½• Table of Contents å‰æƒ…æè¦ ä¸ºäº†å®ç° goroutine é€šä¿¡ï¼Œæœ‰ä¸¤ç§å¸¸è§å¹¶å‘æ¨¡å‹ï¼š å…±äº«å†…å­˜ï¼šä½¿ç”¨å…±äº«å†…å­˜æ–¹å¼ï¼ŒGo ä¸­ sync åº“åŒ…æä¾›äº†å¤šç§åŒæ­¥çš„æœºåˆ¶ã€‚ æ¶ˆæ¯é˜Ÿåˆ—ï¼šä½¿ç”¨ç±»ä¼¼ç®¡é“å’Œæ¶ˆæ¯é˜Ÿåˆ—çš„æ–¹å¼ï¼Œå„ä¸ªå¹¶å‘å•å…ƒæ•°æ®ç›¸äº’ç‹¬ç«‹ï¼Œé€šè¿‡æ¶ˆæ¯è¿›è¡Œæ•°æ®äº¤æ¢ï¼ŒGo ä¸­ channel ç±»å‹æ¨¡æ‹Ÿäº†è¿™ç§åŒæ­¥çš„æ¨¡å¼ã€‚ è®©æˆ‘ä»¬å†ä¸€æ¬¡æ¥å¤è¯» Go ç¤¾åŒºçš„å¹¶å‘å£å·â€”â€”â€œä¸è¦é€šè¿‡å…±äº«å†…å­˜æ¥é€šä¿¡ï¼Œè€Œåº”è¯¥é€šè¿‡é€šä¿¡æ¥å…±äº«å†…å­˜â€ã€‚ æœ¬æ–‡å°†è®¨è®º Go å¹¶å‘ç¼–ç¨‹ä¸­çš„é€šä¿¡æ¡¥æ¢ channelçš„ä½¿ç”¨ï¼Œå¦‚æœ‰é”™æ¼ï¼Œæ¬¢è¿æŒ‡å‡º ;P æ¦‚å¿µå¼•ç”³ç®¡é“ Pipe ç®¡é“ (Pipe) æ˜¯æ“ä½œç³»ç»Ÿä¸­è¿›ç¨‹é—´é€šä¿¡çš„ä¸€ç§æ–¹å¼ã€‚ç®¡é“çš„æœ¬è´¨æ˜¯ä¸€ä¸ªå­˜åœ¨äºå†…å­˜æˆ–æ–‡ä»¶ç³»ç»Ÿçš„ç¼“å†²æœ‰é™çš„ç‰¹æ®Šæ–‡ä»¶ï¼Œè¿›ç¨‹ä»¥å…ˆè¿›å…ˆå‡ºçš„æ–¹å¼ä»ç¼“å†²åŒºå­˜å–æ•°æ®ï¼Œç®¡é“ä¸€ç«¯çš„è¿›ç¨‹é¡ºåºåœ°å°†æ•°æ®å†™å…¥ç¼“å†²åŒºï¼Œå¦ä¸€ç«¯çš„è¿›ç¨‹åˆ™é¡ºåºåœ°è¯»å‡ºæ•°æ®ã€‚ åŒ¿åç®¡é“æ²¡æœ‰åå­—ï¼Œæ˜¯åŠåŒå·¥çš„ï¼›åŒ¿åç®¡é“å¯¹äºç®¡é“ä¸¤ç«¯çš„è¿›ç¨‹è€Œè¨€æ˜¯ä¸€ä¸ªå­˜åœ¨äºå†…å­˜çš„ç‰¹æ®Šæ–‡ä»¶ï¼›åŒ¿åç®¡é“åªèƒ½ç”¨äºçˆ¶å­è¿›ç¨‹æˆ–å…„å¼Ÿè¿›ç¨‹ä¹‹é—´é€šä¿¡ã€‚ æœ‰åç®¡é“æ‹¥æœ‰åå­—ï¼Œæ˜¯å…¨åŒå·¥çš„ï¼›æœ‰åç®¡é“å¯¹äºç®¡é“ä¸¤ç«¯çš„è¿›ç¨‹è€Œè¨€æ˜¯ä¸€ä¸ªå­˜åœ¨äºæ–‡ä»¶ç³»ç»Ÿçš„ç‰¹æ®Šæ–‡ä»¶ï¼›æœ‰åç®¡é“å¯ä»¥ç”¨äºæœ¬æœºä»»æ„ä¸¤ä¸ªè¿›ç¨‹ä¹‹é—´é€šä¿¡ã€‚ ç®¡é“ä¼ é€æ— æ ¼å¼å­—èŠ‚æµï¼Œè¿™å°±è¦æ±‚ç®¡é“çš„è¯»å‡ºæ–¹å’Œå†™å…¥æ–¹å¿…é¡»äº‹å…ˆçº¦å®šå¥½æ•°æ®çš„æ ¼å¼ã€‚ æ¶ˆæ¯é˜Ÿåˆ— Message æ¶ˆæ¯é˜Ÿåˆ— (Message) æ˜¯æ“ä½œç³»ç»Ÿä¸­è¿›ç¨‹é—´é€šä¿¡çš„ä¸€ç§æ–¹å¼ã€‚ç®¡é“çš„æœ¬è´¨æ˜¯ä¸€ä¸ªå­˜æ”¾åœ¨å†…æ ¸ä¸­çš„é•¿åº¦ä¸é™çš„æ¶ˆæ¯é“¾è¡¨ï¼Œä¸€èˆ¬éµå¾ªå…ˆè¿›å…ˆå‡ºè§„åˆ™ï¼Œä¹Ÿå¯ä»¥éšæœºæˆ–æŒ‰æ¶ˆæ¯çš„ç±»å‹æŸ¥è¯¢ï¼Œå¹¶ä¸”å…è®¸ä¸€ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹å‘å®ƒå†™å…¥æˆ–è¯»å–æ¶ˆæ¯ã€‚ æ¶ˆæ¯é˜Ÿåˆ—ç”±æ¶ˆæ¯é˜Ÿåˆ—æ ‡è¯†ç¬¦æ ‡è¯†ï¼Œæä¾›æœ‰æ ¼å¼å­—èŠ‚æµå¹¶ä¸”å…·æœ‰ç±»å‹ã€‚ ä¿¡é“ Channel ä¿¡é“ (Channel) æ˜¯ Golang ä¸­åç¨‹é—´é€šä¿¡çš„ä¸€ç§æ–¹å¼ã€‚ä¿¡é“çš„æœ¬è´¨æ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„å…ˆè¿›å…ˆå‡ºé˜Ÿåˆ—ï¼Œå¯é€‰æ‹©æ— ç¼“å†²æˆ–æœ‰ç¼“å†²ï¼Œä»»æ„æ—¶åˆ»åŒæ—¶åªèƒ½æœ‰ä¸€ä¸ª goroutine è®¿é—® channelã€‚ ä¿¡é“å¯ä»¥æŒ‡å®šç±»å‹ã€‚ channel ä½¿ç”¨åˆ›å»º12345678// åŒå‘channelch := make(chan T, cap)// åªè¯»channelï¼ˆä½†æ˜¯æ²¡ä»€ä¹ˆæ„ä¹‰ï¼ŒåŒå‘channelå¯ä»¥èµ‹å€¼å•å‘channelï¼‰ch_or := make(&lt;-chan T, cap)// åªå†™channelï¼ˆä½†æ˜¯æ²¡ä»€ä¹ˆæ„ä¹‰ï¼ŒåŒå‘channelå¯ä»¥èµ‹å€¼å•å‘channelï¼‰ch_ow := make(chan&lt;- T, cap) å¼•ç”¨ç±»å‹ï¼Œä½¿ç”¨ make åˆ›å»ºï¼Œé›¶å€¼ä¸º nil å¯é€‰æ‹©æ•°æ®ç±»å‹ å¯é€‰æ‹©ç¼“å†²å®¹é‡ æ— ç¼“å†²ï¼šcap = 0ï¼Œè¯»å†™åŒæ­¥ æœ‰ç¼“å†²ï¼šcap &gt; 0ï¼Œè¯»å†™å¼‚æ­¥ å¯é€‰æ‹©é€šä¿¡æ–¹å‘ åªè¯»ï¼š&lt;-chan åªå†™ï¼šchan&lt;- è¯»å†™1data := &lt;- ch ä» channel ä¸­è¯»å–æ•°æ®ï¼š æ— ç¼“å†²ï¼šæ²¡æœ‰ goroutine å†™å…¥ï¼Œchannel é˜»å¡ æœ‰ç¼“å†²ï¼šchannel å®¹é‡å˜ç©ºï¼Œchannel é˜»å¡ 1ch &lt;- data å‘ channel é‡Œå†™å…¥æ•°æ®ï¼š æ— ç¼“å†²ï¼šæ²¡æœ‰ goroutine è¯»å–ï¼Œchannel é˜»å¡ æœ‰ç¼“å†²ï¼šchannel å®¹é‡å˜æ»¡ï¼Œchannel é˜»å¡ å…³é—­123456789101112131415161718192021// å…³é—­ channel// close æ‰‹åŠ¨å…³é—­æˆ–ç­‰å¾…è‡ªåŠ¨ GCclose(ch)// å°è¯•å†™å…¥å·²å…³é—­çš„ channel// å¯¼è‡´ panic å¼‚å¸¸ch &lt;- d// è¿”å›æ•°æ®æˆ–é›¶å€¼// è¿˜æœ‰å‰©ä½™æ•°æ®åˆ™è¿”å›æ•°æ®// æ²¡æœ‰å‰©ä½™æ•°æ®åˆ™è¿”å›é›¶å€¼d := &lt;-ch// è¿”å›æ•°æ®å’Œå¸ƒå°”å€¼// true è¡¨ç¤ºæˆåŠŸä» channel æ¥æ”¶åˆ°å€¼// false è¡¨ç¤º channel å·²ç»è¢«å…³é—­å¹¶ä¸”é‡Œé¢æ²¡æœ‰å€¼å¯æ¥æ”¶d, ok := &lt;-ch// å°è¯•é‡å¤å…³é—­ channel// å¯¼è‡´ panic å¼‚å¸¸close(ch) å…³é—­ channel å¯ä»¥é€šè¿‡æ˜¾å¼çš„ä»£ç å…³é—­æˆ–éšå¼çš„åƒåœ¾å›æ”¶ å¯¹å…³é—­åçš„ channel è¿›è¡Œå†™å…¥æ“ä½œï¼š å¯¼è‡´ panic å¼‚å¸¸ å¯¹å…³é—­åçš„ channel è¿›è¡Œè¯»å–æ“ä½œï¼š å­˜åœ¨å·²ç»å‘é€æˆåŠŸçš„æ•°æ®ï¼šè¿”å›æ•°æ® ä¸å­˜åœ¨å·²ç»å‘é€æˆåŠŸçš„æ•°æ®ï¼šè¿”å›é›¶å€¼ å¯¹å…³é—­åçš„ channel è¿›è¡Œé‡å¤å…³é—­ï¼š å¯¼è‡´ panic å¼‚å¸¸ close å¸¸å¸¸ä¸ selectã€range å’Œ defer ä¸€èµ·ä½¿ç”¨ PSï¼šGolang å¹¶ä¸æ”¯æŒæ— é™å®¹é‡çš„ channelï¼ŒåŸå› æ˜¯å¦‚æœç”Ÿäº§é€Ÿç‡è¿œè¿œå¤§äºæ¶ˆè´¹é€Ÿç‡ï¼Œé‚£ä¹ˆ channel å†…çš„æ•°æ®ä¸æ–­ç´¯ç§¯å°†ä¼šçˆ†æ‰å†…å­˜ã€‚ åº”ç”¨å®ä¾‹å•ç”Ÿäº§è€…-å•æ¶ˆè´¹è€…æ¨¡å‹1234567891011121314151617181920212223242526272829303132333435363738394041424344package mainimport ( \"fmt\" \"time\")const BUFLEN = 5// ç”Ÿäº§è€…func producer(ch chan&lt;- int) { d := 1 for { ch &lt;- d fmt.Println(\"Produce:\", d) d++ time.Sleep(1 * time.Second) // ç”Ÿäº§è€…é€Ÿç‡ä¸å®œè¿‡å¿« }}// æ¶ˆè´¹è€…func consumer(ch &lt;-chan int) { for { d := &lt;-ch fmt.Println(\"Consume:\", d) time.Sleep(2 * time.Second) // æ¶ˆè´¹è€…é€Ÿç‡ä¸å®œè¿‡å¿« }}func main() { // ç”Ÿäº§æ¶ˆè´¹çš„ç¼“å†²åŒº ch := make(chan int, BUFLEN) // å¯åŠ¨ç”Ÿäº§è€…åç¨‹ go producer(ch) // å¯åŠ¨æ¶ˆè´¹è€…åç¨‹ go consumer(ch) // é˜²æ­¢ä¸»å‡½æ•°çš„é€€å‡º for { }} å¤šç”Ÿäº§è€…-å¤šæ¶ˆè´¹è€…æ¨¡å‹12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667package mainimport ( \"fmt\" \"math/rand\" \"sync\" \"time\")const BUFLEN = 5var cond *sync.Cond = sync.NewCond(&amp;sync.Mutex{})// ç”Ÿäº§è€…func producer(ch chan&lt;- int) { for { cond.L.Lock() for len(ch) == BUFLEN { cond.Wait() } data := rand.Intn(1000) ch &lt;- data fmt.Println(\"Produce:\", data) cond.L.Unlock() cond.Signal() time.Sleep(2 * time.Second) // ç”Ÿäº§è€…é€Ÿç‡ä¸å®œè¿‡å¿« }}// æ¶ˆè´¹è€…func consumer(ch &lt;-chan int) { for { cond.L.Lock() for len(ch) == 0 { cond.Wait() } data := &lt;-ch fmt.Println(\"Consume:\", data) cond.L.Unlock() cond.Signal() time.Sleep(1 * time.Second) // æ¶ˆè´¹è€…é€Ÿç‡ä¸å®œè¿‡å¿« }}func main() { rand.Seed(time.Now().UnixNano()) // ç”Ÿäº§æ¶ˆè´¹çš„ç¼“å†²åŒº ch := make(chan int, BUFLEN) // å¯åŠ¨ 10 ä¸ªç”Ÿäº§è€…åç¨‹ for i := 0; i &lt; 10; i++ { go producer(ch) } // å¯åŠ¨ 10 ä¸ªæ¶ˆè´¹è€…åç¨‹ for i := 0; i &lt; 10; i++ { go consumer(ch) } // é˜²æ­¢ä¸»å‡½æ•°çš„é€€å‡º for { }} å‚è€ƒé“¾æ¥ Goè¯­è¨€åœ£ç» channel channelçš„åº”ç”¨","link":"/2020/03/06/Golangä¸å¹¶å‘ç¼–ç¨‹(4)/"},{"title":"#Golang# Golangä¸å¹¶å‘ç¼–ç¨‹(2) goroutineè°ƒåº¦","text":"æœ¬æ–‡ä¸»è¦è®¨è®º goroutine è°ƒåº¦çš„ç›¸å…³å†…å®¹ã€‚ ç›®å½• Table of Contents å‰æƒ…æè¦ Go ä¸­çš„å¹¶å‘æ€§æ˜¯ä»¥ goroutine (ç‹¬ç«‹æ´»åŠ¨)å’Œ channel (ç”¨äºé€šä¿¡)çš„å½¢å¼å®ç°çš„ï¼Œè¿™æ˜¯å› ä¸º Go æ‰€ä¿¡å¥‰çš„â€œä¸è¦é€šè¿‡å…±äº«å†…å­˜æ¥é€šä¿¡ï¼Œè€Œåº”è¯¥é€šè¿‡é€šä¿¡æ¥å…±äº«å†…å­˜â€ã€‚å½“ç„¶ï¼ŒGo ä¹Ÿæä¾›äº†å¯¹ä¼ ç»Ÿé€šä¿¡æœºåˆ¶çš„æ”¯æŒï¼Œå¦‚ Mutex (äº’æ–¥é”) å’Œ WaitGroup (ä¿¡å·é‡)ã€‚ æœ¬æ–‡å°†è®¨è®º Go å¹¶å‘ç¼–ç¨‹ä¸­çš„åŸºæœ¬å•ä½ goroutineçš„è°ƒåº¦ï¼Œå¦‚æœ‰é”™æ¼ï¼Œæ¬¢è¿æŒ‡å‡º ;P goroutine è°ƒåº¦ goroutines ä»…å­˜åœ¨äº go runtime ä¸­è€Œä¸å­˜åœ¨äº OS ä¸­ï¼Œå› æ­¤éœ€è¦ Go Runtime Scheduler æ¥ç®¡ç†å®ƒä»¬çš„ç”Ÿå‘½å‘¨æœŸã€‚ çº¿ç¨‹æ¨¡å‹ Mï¼šmachineï¼Œä¸€ä¸ª M ä»£è¡¨ä¸€ä¸ªç”¨æˆ·çº¿ç¨‹ Pï¼šprocessorï¼Œä¸€ä¸ª P ä»£è¡¨ä¸€ä¸ª Go åç¨‹æ‰€éœ€çš„ä¸Šä¸‹æ–‡ç¯å¢ƒ Gï¼šgoroutineï¼Œä¸€ä¸ª G ä»£è¡¨ä¸€ä¸ª Go åç¨‹ KSEï¼škernel schedule entityï¼Œä¸€ä¸ª KSE ä»£è¡¨ä¸€ä¸ªå†…æ ¸çº¿ç¨‹ + å…±äº«ä»»åŠ¡é˜Ÿåˆ—ï¼ˆGlobal Queueï¼‰ æµç¨‹ï¼š Step1. å…ˆå¼€ä¸€ä¸ªçº¿ç¨‹æ± ï¼› Step2. æ¯ä¸ªçº¿ç¨‹ä¸æ–­ä» Global Queue ä¸­å– G æ‰§è¡Œï¼Œäº¦å³ä¸€ä¸ªçº¿ç¨‹éåŒæ—¶åˆ»å¯ä»¥æ‰§è¡Œå¤šä¸ªåç¨‹ï¼› Step3. å¦‚æœæ²¡æœ‰ç³»ç»Ÿè°ƒç”¨ã€I/O ä¸­æ–­æˆ–è€… channel é˜»å¡ï¼Œgoroutine å¯¹åº”çš„çº¿ç¨‹æ­£å¸¸å·¥ä½œï¼›å¦‚æœæœ‰ç³»ç»Ÿè°ƒç”¨ã€I/Oä¸­æ–­æˆ–è€… channel é˜»å¡ï¼Œgoroutine å¯¹åº”çš„çº¿ç¨‹å°†è¢«é˜»å¡ã€‚ é—®é¢˜ï¼š çº¿ç¨‹æ¯æ¬¡å– G æ—¶éœ€è¦åŠ é”ï¼Œå¦åˆ™å‡ºç°ç«æ€å±å®³ï¼› goroutine æœ¬èº«å¯ä»¥è¢«é˜»å¡ï¼Œgoroutine å¯¹åº”çš„çº¿ç¨‹ä¸åº”è¯¥è¢«é˜»å¡ã€‚ è§£å†³ï¼š å¼•å…¥ç‹¬æœ‰ä»»åŠ¡é˜Ÿåˆ—ï¼Œæ¯ä¸ªçº¿ç¨‹åªè¯»è‡ªå·±çš„ä»»åŠ¡é˜Ÿåˆ—ï¼Œä¸å­˜åœ¨èµ„æºç«äº‰ï¼› å‘ç”Ÿç³»ç»Ÿè°ƒç”¨æˆ–I/Oä¸­æ–­çš„ goroutine å¯¹åº”çš„çº¿ç¨‹è¦è®°å½• goroutine çš„ä¸Šä¸‹æ–‡ï¼› å‘ç”Ÿç³»ç»Ÿè°ƒç”¨æˆ–I/Oä¸­æ–­çš„ goroutine å¯¹åº”çš„çº¿ç¨‹å¯ä»¥æ¢å‡ºè¯¥ goroutineï¼Œç„¶åæ‰§è¡Œæ–° goroutineã€‚ + ç‹¬æœ‰ä»»åŠ¡é˜Ÿåˆ—ï¼ˆLocal Queueï¼‰ æµç¨‹ï¼š Step2. æ¯ä¸ªçº¿ç¨‹ä¸æ–­ä» Local Queue ä¸­å– G æ‰§è¡Œï¼Œäº¦å³ä¸€ä¸ªçº¿ç¨‹éåŒæ—¶åˆ»å¯ä»¥æ‰§è¡Œå¤šä¸ªåç¨‹ï¼› é—®é¢˜ï¼š çº¿ç¨‹æ—¢è¦è´Ÿè´£è°ƒåº¦åˆè¦è´Ÿè´£æ‰§è¡Œï¼Œæ€§èƒ½ä¸‹é™ã€‚ è§£å†³ï¼š å¼•å…¥ä¸€ä¸ªè´Ÿè´£çº¿ç¨‹è°ƒåº¦çš„æŠ½è±¡å±‚ï¼Œä¹Ÿå°±æ˜¯ Mã€‚ + çº¿ç¨‹è°ƒåº¦å™¨ï¼ˆMï¼‰ æµç¨‹ï¼š Step1. çº¿ç¨‹æ± ä¸­æ¯ä¸ªçº¿ç¨‹å¯¹åº”ä¸€ä¸ª Mï¼ŒM å°†æ ¹æ®è°ƒåº¦ç®—æ³•é€‰æ‹©åˆé€‚çš„ G äº¤ç”±å†…æ ¸çº¿ç¨‹æ‰§è¡Œã€‚ é—®é¢˜ï¼š åˆ°ç›®å‰ä¸ºæ­¢ï¼Œgoroutine ä»ç„¶æ˜¯åä½œå¼çš„ï¼Œè¿™æ„å‘³ç€ä¸€ä¸ª G å¯ä»¥é•¿æ—¶é—´å ç”¨ CPUï¼Œç›´åˆ°å®ƒå®Œæˆä»»åŠ¡æˆ–è¢«é˜»å¡ã€‚ è§£å†³ï¼š å¼•å…¥ä¸€ä¸ªè´Ÿè´£èµ„æºåˆ†é…çš„æŠ½è±¡å±‚ï¼Œä¹Ÿå°±æ˜¯ Pã€‚ + æŠ¢å å¼ï¼ˆPï¼‰ æµç¨‹ï¼š Step3.å½“ä¸€ä¸ª G å ç”¨ä¸€å®šçš„ CPU æ—¶é—´ï¼Œåˆæ²¡æœ‰è¢«è°ƒåº¦è¿‡ï¼Œé‚£ä¹ˆå®ƒå°†è¢« runtime æŠ¢å ã€‚ é—®é¢˜ï¼š ä¿ç•™äº† Global Queue æ‰¿è½½ Local Queue æº¢å‡ºçš„ Gï¼Œæ­¤æ—¶å¦‚æœå¤šä¸ª P åŒæ—¶è®¿é—® Global Queueï¼Œè¿˜æ˜¯è¦åŠ å…¨å±€é”ã€‚ è§£å†³ï¼š å¼•å…¥å…¨å±€è°ƒåº¦å™¨ Schedã€‚ + å…¨å±€è°ƒåº¦å™¨ï¼ˆSchedï¼‰ P ä¸»è¦è´Ÿè´£ Local Queue çš„è°ƒåº¦ï¼ŒSched ä¸»è¦è´Ÿè´£ Global Queue çš„è°ƒåº¦ã€‚ + éé˜»å¡ï¼ˆnetpollerï¼‰ é˜»å¡çš„ IO æ¨¡å‹ä¸ºï¼šG1 è¢«é˜»å¡åï¼ŒM1 ä¹Ÿè¢«é˜»å¡ï¼Œä½†æ˜¯ M1 çš„å…¶å®ƒ G# å¯ä»¥è½¬ç§»åˆ°ç©ºé—²æˆ–æ–°èµ·çš„ M# ä¸­æ‰§è¡Œã€‚ éé˜»å¡çš„ IO æ¨¡å‹ä¸ºï¼šG1 è¢«é˜»å¡åï¼ŒM1 ä¸ä¼šé˜»å¡ï¼ŒM1 çš„å…¶å®ƒ G# ä»ç„¶å¯ä»¥æ‰§è¡Œã€‚ æ­¤å¤–ï¼Œnetpoller è¿˜æŠ½è±¡äº† epoll çš„å¤šè·¯å¤ç”¨ï¼Œnetpoller å°†å¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦æ³¨å†Œåˆ° epoll å®ä¾‹ä¸­è¿›è¡Œ epoll_waitï¼Œå°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦å›è°ƒé€šçŸ¥ç»™é˜»å¡çš„ Gï¼ŒG æ›´æ–°ä¸ºå°±ç»ªçŠ¶æ€ç­‰å¾…è°ƒåº¦ç»§ç»­æ‰§è¡Œã€‚ è°ƒåº¦åœºæ™¯ è°ƒåº¦çš„æœ¬è´¨å°±æ˜¯ P å°† G åˆç†åœ°åˆ†é…ç»™æŸä¸ª M çš„è¿‡ç¨‹ï¼ŒM åªæœ‰å’Œ P ç»‘å®šæ‰èƒ½è¿è¡Œ Gã€‚ è´Ÿè½½å‡è¡¡ ä»æœ¬åœ°åˆ°å…¨å±€ï¼šLocal Queue æ»¡äº†ï¼Œä¼šå°†å‰ä¸€åŠçš„ G å’Œæ–°åˆ›å»ºçš„ G æ”¾åˆ° Global Queue å¹¶æ‰“ä¹±é¡ºåºï¼› ä»å…¨å±€åˆ°æœ¬åœ°ï¼šLocal Queue ç©ºäº†ï¼Œä¼šä» Glocal Queue éšæœºé€‰å– n = min(len(GQ)/GOMAXPROCS + 1, len(GQ/2)) ä¸ª Gï¼› ä¸ºäº†è°ƒåº¦å…¬å¹³ï¼š1/61 çš„å‡ ç‡åœ¨ Global Queue ä¸­æ‰¾ Gï¼Œ60/61 çš„å‡ ç‡åœ¨ Local Queue æ‰¾ Gï¼Œå¦åˆ™ Global Queue ä¸­çš„ G æœ‰å¯èƒ½æ°¸è¿œæ²¡åŠæ³•è¢«è°ƒåº¦ã€‚ ä»»åŠ¡çªƒå– å‡ºç°ç©ºé—²çš„Mï¼Œæ­¤æ—¶å®ƒç»‘å®šçš„ P çš„ Local Queue ä¸ºç©ºï¼Œå¹¶ä¸” Global Queue ä¹Ÿä¸ºç©ºï¼Œåˆ™ä»å…¶å®ƒ P ä¸­çªƒå–åä¸€åŠçš„ Gï¼Œè¿™å°±æ˜¯ work-stealing ç®—æ³•ã€‚ çº¿ç¨‹è‡ªæ—‹ åœ¨åˆ›å»º G æ—¶ï¼Œè¿è¡Œçš„ G ä¼šå°è¯•å”¤é†’å…¶ä»–ç©ºé—²çš„ M æ‰§è¡Œï¼Œå¦‚æœæ²¡æœ‰ Gï¼ŒM å°†è‡ªæ—‹è€Œä¸é˜»å¡ï¼Œä¸åœåœ°æ‰¾ Gï¼› è‡ªæ—‹çš„ä¼˜ç‚¹æ˜¯é™ä½äº† M åˆ‡æ¢ä¸Šä¸‹æ–‡çš„æˆæœ¬ï¼Œç¼ºç‚¹æ˜¯ CPU ç©ºè½¬æµªè´¹èµ„æºï¼› æŠ˜ä¸­æ–¹æ¡ˆæ˜¯ï¼šæœ€å¤šæœ‰ GOMAXPROCS ä¸ªè‡ªæ—‹çš„çº¿ç¨‹ï¼Œå¤šä½™çš„çº¿ç¨‹å°†ä¼‘çœ ã€‚ è¯·æ±‚æŠ¢å  æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶ï¼Œsysmon å°†ä¼šå‘é€æŠ¢å è¯·æ±‚ï¼Œä½†æ˜¯èƒ½å¦æŠ¢å æˆåŠŸä¸è¢«ä¿éšœï¼š G è¿›è¡Œç³»ç»Ÿè°ƒç”¨è¶…è¿‡ 20 Î¼s G è¿è¡Œ (éå¾ªç¯)è¶…è¿‡ 10 ms network IO / channel é˜»å¡ å½“ network IO / channel æ“ä½œå‘ç”Ÿï¼Œè¢«é˜»å¡çš„ G æ”¾å…¥ç­‰å¾…é˜Ÿåˆ—ï¼ŒM é€‰æ‹©å…¶å®ƒçš„ G ï¼› å¦‚æœæœ‰å°±ç»ªçš„ Gï¼ŒM æ­£å¸¸æ‰§è¡Œï¼›å¦‚æœæ— å°±ç»ªçš„ Gï¼ŒM å°†è§£ç»‘ P å¹¶ä¸”ä¼‘çœ ï¼› å½“ network IO / channel æ“ä½œå®Œæˆï¼Œè¢«é˜»å¡çš„ G ä»ç­‰å¾…å˜æˆå°±ç»ªï¼ŒåŠ å…¥æŸä¸ª P ä¸­è¢«æ–°çš„ M æ‰§è¡Œæˆ–åŠ å…¥åˆ° Global Queueï¼Œä¼‘çœ çš„ M å°†ç­‰å¾…æ–°åˆ›å»ºçš„ G å”¤é†’ã€‚ åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œè°ƒåº¦å®é™…ä¸Šæ˜¯éé˜»å¡çš„â€”â€”M ä¸ä¼šå› ä¸º G é˜»å¡è€Œä¼‘çœ ã€‚ system call é˜»å¡ å½“ system call æ“ä½œå‘ç”Ÿï¼ŒG ä¼šé˜»å¡ï¼ŒM ä¼šè§£ç»‘ P å¹¶ä¸”ä¼‘çœ ï¼› å¦‚æœæœ‰ç©ºé—²çš„ Mï¼Œè¯¥ç©ºé—²çš„ M å°†ç»‘å®š P ï¼Œå¦‚æœæ— ç©ºé—²çš„ Mï¼Œå°†æ–°å»ºä¸€ä¸ª M æ¥ç»‘å®š Pï¼› å½“ system call æ“ä½œå®Œæˆï¼Œè¢«é˜»å¡çš„ G ä»é˜»å¡å˜æˆå°±ç»ªï¼ŒåŠ å…¥æŸä¸ª P ä¸­è¢«æ–°çš„ M æ‰§è¡Œæˆ–åŠ å…¥åˆ° Global Queueï¼Œä¼‘çœ çš„ M å°†ç­‰å¾…æ–°åˆ›å»ºçš„ G å”¤é†’ã€‚ åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œè°ƒåº¦å®é™…ä¸Šæ˜¯é˜»å¡çš„â€”â€”M ä¼šå› ä¸º G é˜»å¡è€Œä¼‘çœ  å‚è€ƒé“¾æ¥ Goå¹¶å‘ç¼–ç¨‹-Goroutineå¦‚ä½•è°ƒåº¦çš„? Goè°ƒåº¦å™¨ç³»åˆ—ï¼ˆ3ï¼‰å›¾è§£è°ƒåº¦åŸç† ä¸€æ–‡æ‘¸æ¸… Go çš„å¹¶å‘è°ƒåº¦æ¨¡å‹ ä¹Ÿè°ˆgoroutineè°ƒåº¦å™¨","link":"/2020/03/04/Golangä¸å¹¶å‘ç¼–ç¨‹(2)/"},{"title":"#Golang# Golangä¸å¹¶å‘ç¼–ç¨‹(1) goroutineä½¿ç”¨","text":"æœ¬æ–‡ä¸»è¦è®¨è®º goroutine ä½¿ç”¨çš„ç›¸å…³å†…å®¹ã€‚ ç›®å½• Table of Contents å‰æƒ…æè¦ Go ä¸­çš„å¹¶å‘æ€§æ˜¯ä»¥ goroutine (ç‹¬ç«‹æ´»åŠ¨)å’Œ channel (ç”¨äºé€šä¿¡)çš„å½¢å¼å®ç°çš„ï¼Œè¿™æ˜¯å› ä¸º Go æ‰€ä¿¡å¥‰çš„â€œä¸è¦é€šè¿‡å…±äº«å†…å­˜æ¥é€šä¿¡ï¼Œè€Œåº”è¯¥é€šè¿‡é€šä¿¡æ¥å…±äº«å†…å­˜â€ã€‚å½“ç„¶ï¼ŒGo ä¹Ÿæä¾›äº†å¯¹ä¼ ç»Ÿé€šä¿¡æœºåˆ¶çš„æ”¯æŒï¼Œå¦‚ Mutex (äº’æ–¥é”) å’Œ WaitGroup (ä¿¡å·é‡)ã€‚ æœ¬æ–‡å°†è®¨è®º Go å¹¶å‘ç¼–ç¨‹ä¸­çš„åŸºæœ¬å•ä½ goroutineçš„ä½¿ç”¨ï¼Œå¦‚æœ‰é”™æ¼ï¼Œæ¬¢è¿æŒ‡å‡º ;P æ¦‚å¿µè¾¨æä¸²è¡Œã€å¹¶å‘ä¸å¹¶è¡Œä¸²è¡Œ CPUæŒ‰é¡ºåºæ‰§è¡Œå®Œä¸€ä¸ªçº¿ç¨‹åï¼Œæ‰èƒ½å¼€å§‹å¦ä¸€ä¸ªçº¿ç¨‹ï¼ˆæ˜¾ç„¶ä¸æ˜¯åŒæ—¶æ‰§è¡Œï¼‰ã€‚ å¹¶å‘ CPUåœ¨å„ä¸ªä»»åŠ¡é—´åˆ‡æ¢ï¼ŒåŒæ—¶åˆ»ä¸€ä¸ªCPUåªèƒ½è¿è¡Œä¸€ä¸ªçº¿ç¨‹ï¼ˆçœ‹èµ·æ¥çš„åŒæ—¶æ‰§è¡Œï¼‰ã€‚ å¹¶è¡Œ åŒæ—¶åˆ»å¤šä¸ªä»»åŠ¡åœ¨å¤šä¸ªCPUä¸Šè¿è¡Œï¼ˆäº‹å®ä¸Šçš„åŒæ—¶æ‰§è¡Œï¼‰ã€‚ è¿›ç¨‹ã€çº¿ç¨‹ä¸åç¨‹è¿›ç¨‹ è¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿèµ„æºåˆ†é…çš„æœ€å°å•ä½ã€‚ è¿›ç¨‹å…·æœ‰ç‹¬ç«‹çš„åœ°å€ç©ºé—´ï¼Œé€šä¿¡éœ€è¦é€šè¿‡IPCã€‚ ä¸€ä¸ªç³»ç»Ÿå†…çš„å¤šä¸ªè¿›ç¨‹å¯ä»¥å¹¶å‘æ‰§è¡Œã€‚ çº¿ç¨‹ çº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿè°ƒåº¦æ‰§è¡Œçš„æœ€å°å•ä½ã€‚ çº¿ç¨‹å…±äº«è¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼Œé€šä¿¡ç›´æ¥å…±äº«å†…å­˜ã€‚ ä¸€ä¸ªè¿›ç¨‹å†…çš„å¤šä¸ªçº¿ç¨‹å¯ä»¥å¹¶å‘æ‰§è¡Œã€‚ åç¨‹ åç¨‹è¿è¡Œåœ¨ç”¨æˆ·æ€ï¼Œè€Œè¿›ç¨‹å’Œçº¿ç¨‹éƒ½è¿è¡Œåœ¨å†…æ ¸æ€ã€‚ åç¨‹æ˜¯å‡½æ•°é—´åˆ‡æ¢ä¸æ˜¯çº¿ç¨‹é—´åˆ‡æ¢ï¼Œå ç”¨å†…å­˜å’Œåˆ‡æ¢å¼€é”€æ›´å°ã€‚ ä¸€ä¸ªçº¿ç¨‹å†…çš„å¤šä¸ªåç¨‹åªå¯ä¸²è¡Œæ‰§è¡Œã€‚ PSï¼šLinuxè™šæ‹Ÿåœ°å€ç©ºé—´å¸ƒå±€ ç”¨æˆ·çº¿ç¨‹ä¸å†…æ ¸çº¿ç¨‹ å†…æ ¸å¯è§ï¼šç”¨æˆ·çº¿ç¨‹å¯¹äºå†…æ ¸æ¥è¯´æ˜¯é€æ˜çš„ï¼Œç”¨æˆ·çº¿ç¨‹æ•°é‡å‡ ä¹ä¸å—é™ï¼›å†…æ ¸çº¿ç¨‹å¯¹äºå†…æ ¸æ¥è¯´æ˜¯å¯è§çš„ï¼Œå†…æ ¸çº¿ç¨‹æ•°é‡æ˜¯æœ‰é™åˆ¶çš„ã€‚ è°ƒåº¦å®ä½“ï¼šç”¨æˆ·çº¿ç¨‹ç”±åº”ç”¨ç¨‹åºæˆ–è¿è¡Œæ—¶è°ƒåº¦å™¨è°ƒåº¦ï¼Œç”¨æˆ·çº¿ç¨‹åˆ‡æ¢åªå‘ç”Ÿåœ¨ç”¨æˆ·æ€ï¼›å†…æ ¸çº¿ç¨‹ç”±å†…æ ¸è°ƒåº¦ï¼Œå†…æ ¸çº¿ç¨‹åˆ‡æ¢éœ€è¦é™·å…¥å†…æ ¸æ€ã€‚ èµ„æºç«äº‰ï¼šç”¨æˆ·çº¿ç¨‹åœ¨è¿›ç¨‹å†…ç«äº‰èµ„æºï¼Œç”¨æˆ·çº¿ç¨‹é˜»å¡é‚£ä¹ˆå¯¹åº”è¿›ç¨‹é˜»å¡ï¼Œå…¶å®ƒçº¿ç¨‹åŒæ—¶é˜»å¡ï¼›å†…æ ¸çº¿ç¨‹åœ¨ç³»ç»Ÿå†…ç«äº‰èµ„æºï¼Œå†…æ ¸çº¿ç¨‹é˜»å¡åªä¼šé˜»å¡è¯¥ä¸ªçº¿ç¨‹ï¼Œå…¶å®ƒçº¿ç¨‹ä¸è¢«å½±å“ã€‚ å¹¶è¡Œæ”¯æŒï¼šä½¿ç”¨ç”¨æˆ·çº¿ç¨‹ï¼ŒCPU çš„æ‰§è¡Œå•ä½ä¸ºè¿›ç¨‹ï¼Œè¦å¹¶è¡Œå°±è¦å¤šè¿›ç¨‹ï¼›ä½¿ç”¨å†…æ ¸çº¿ç¨‹ï¼ŒCPU çš„æ‰§è¡Œå•ä½ä¸ºçº¿ç¨‹ï¼Œè¦å¹¶è¡Œåªéœ€å¤šçº¿ç¨‹ã€‚ PSï¼šçº¿ç¨‹å®ç°æ¨¡å‹ goroutine ä¸ coroutine goroutine çš„è¿è¡Œæœºåˆ¶å±äºæŠ¢å å¼ä»»åŠ¡å¤„ç†ï¼Œåº”ç”¨ç¨‹åºå¯¹CPUçš„æ§åˆ¶ç”± Go Runtime Scheduler ç®¡ç†ï¼›coroutine çš„è¿è¡Œæœºåˆ¶å±äºåä½œå¼ä»»åŠ¡å¤„ç†ï¼Œåº”ç”¨ç¨‹åºå¯¹CPUçš„æ§åˆ¶ç”±åº”ç”¨ç¨‹åºå†³å®šã€‚ goroutine å¯ä»¥å¹¶è¡Œæ‰§è¡Œï¼Œå¯èƒ½å‘ç”Ÿåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼›coroutine å§‹ç»ˆé¡ºåºæ‰§è¡Œï¼Œæ€»æ˜¯å‘ç”Ÿåœ¨å•çº¿ç¨‹ç¯å¢ƒä¸‹ã€‚ goroutine ä½¿ç”¨ channel é€šä¿¡ï¼›coroutine ä½¿ç”¨ yield å’Œ resume é€šä¿¡ã€‚ goroutine ä½¿ç”¨main goroutine Golang çš„å…¥å£å‡½æ•° main() æœ¬èº«å°±æ˜¯ä¸ª goroutineï¼š 123func main() { // ...} normal goroutine åˆ›å»ºä¸€ä¸ªæ™®é€šçš„ goroutineï¼Œåªéœ€è¦åœ¨å‡½æ•°å‰åŠ å…³é”®å­— goï¼š 12345678910111213func sample() { // ...}func main() { // å‘½ågoroutine go sample() // åŒ¿ågoroutine go func() { // ... }} PSï¼šé™¤äº† main å¯ä»¥æ‰“æ–­ goroutine æ‰§è¡Œå¤–ï¼Œå„ goroutine é—´æ˜¯ç‹¬ç«‹çš„ã€‚ç”±äº goroutine æ‰§è¡Œé¡ºåºæ— æ³•ç¡®å®šï¼Œä»£ç çš„é€»è¾‘è¦ç‹¬ç«‹äºè°ƒç”¨çš„é¡ºåºã€‚ è¦ç‚¹æ€»ç»“ goroutine æ˜¯åœ¨è¯­è¨€å±‚é¢å°±æä¾›çš„ï¼Œåªéœ€è¦å…³é”®å­— goï¼Œä½¿ç”¨éå¸¸æ–¹ä¾¿ã€‚ å‚è€ƒé“¾æ¥ å¹¶å‘ç®€ç•¥-æ¦‚è¿° å¹¶å‘ç®€ç•¥-å¯¹æ¯”å¹¶å‘æ¨¡å‹ Goè¯­è¨€åœ£ç»","link":"/2020/03/03/Golangä¸å¹¶å‘ç¼–ç¨‹(1)/"},{"title":"#Machine Learning# SCUT Machine Learning(3) ç®—æ³•ä¸å·¥ç¨‹","text":"æœ¬æ–‡ä¸»è¦è®¨è®ºMachine Learningçš„åŸºæœ¬æ­¥éª¤ï¼ŒåŒ…æ‹¬ä»¥ä¸‹ä¸¤ä¸ªéƒ¨åˆ†ï¼š ä¼˜åŒ–ä¸è°ƒå‚å­¦ è½¯ä»¶å·¥ç¨‹ä¹‹æˆ’ Machine Learningä¼˜åŒ–ä¸è°ƒå‚å­¦æ•°æ®çš„é¢„å¤„ç†å½’ä¸€åŒ–æ ‡å‡†åŒ–ä¸­å¿ƒåŒ–æ­£åˆ™åŒ–å‚æ•°çš„åˆå§‹åŒ–å…¨é›¶åˆå§‹1self.theta = np.zeros((n, 1)) # æƒé‡åç½® å…¨ä¸€åˆå§‹1self.theta = np.ones((n, 1)) # æƒé‡åç½® éšæœºåˆå§‹1self.theta = np.random.random((n, 1)) # æƒé‡åç½® æ­£æ€åˆå§‹123self.theta = np.random.normal(size=(n, 1)) # æƒé‡åç½®æˆ–self.theta = np.random.randn(n, 1) # æƒé‡åç½® æ¢¯åº¦ä¸‹é™é€‰æ‹© å‚è€ƒé“¾æ¥ï¼šæ·±åº¦å­¦ä¹ æœ€å…¨ä¼˜åŒ–æ–¹æ³•æ€»ç»“æ¯”è¾ƒï¼ˆSGDï¼ŒAdagradï¼ŒAdadeltaï¼ŒAdamï¼ŒAdamaxï¼ŒNadamï¼‰ ç»éªŒä¹‹è°ˆï¼š å¯¹äºç¨€ç–æ•°æ®ï¼Œå°½é‡ä½¿ç”¨å­¦ä¹ ç‡å¯è‡ªé€‚åº”çš„ä¼˜åŒ–æ–¹æ³•ï¼Œä¸ç”¨æ‰‹åŠ¨è°ƒèŠ‚ï¼Œè€Œä¸”æœ€å¥½é‡‡ç”¨é»˜è®¤å€¼ã€‚ SGDé€šå¸¸è®­ç»ƒæ—¶é—´æ›´é•¿ï¼Œä½†æ˜¯åœ¨å¥½çš„åˆå§‹åŒ–å’Œå­¦ä¹ ç‡è°ƒåº¦æ–¹æ¡ˆçš„æƒ…å†µä¸‹ï¼Œç»“æœæ›´å¯é ã€‚ å¦‚æœåœ¨æ„æ›´å¿«çš„æ”¶æ•›ï¼Œå¹¶ä¸”éœ€è¦è®­ç»ƒè¾ƒæ·±è¾ƒå¤æ‚çš„ç½‘ç»œæ—¶ï¼Œæ¨èä½¿ç”¨å­¦ä¹ ç‡è‡ªé€‚åº”çš„ä¼˜åŒ–æ–¹æ³•ã€‚ Adadeltaï¼ŒRMSpropï¼ŒAdamæ˜¯æ¯”è¾ƒç›¸è¿‘çš„ç®—æ³•ï¼Œåœ¨ç›¸ä¼¼çš„æƒ…å†µä¸‹è¡¨ç°å·®ä¸å¤šã€‚ åœ¨æƒ³ä½¿ç”¨å¸¦åŠ¨é‡çš„RMSpropï¼Œæˆ–è€…Adamçš„åœ°æ–¹ï¼Œå¤§å¤šå¯ä»¥ä½¿ç”¨Nadamå–å¾—æ›´å¥½çš„æ•ˆæœã€‚ å•æ ·æœ¬ æ¢¯åº¦ä¸‹é™é€Ÿåº¦æœ€å¿«ï¼Œè¿­ä»£è®¡ç®—æ—¶é—´æœ€é•¿ 123456# å•æ ·æœ¬æ¢¯åº¦ä¸‹é™def sgd(self, X_array, y_array): for X_item, y_item in zip(X_array, y_array): X_single = X_item.reshape(1, -1) y_single = y_item.reshape(1, -1) self.update(X_single, y_single) å°æ‰¹é‡ æ¢¯åº¦ä¸‹é™é€Ÿåº¦é€‚ä¸­ï¼Œè¿­ä»£è®¡ç®—æ—¶é—´é€‚ä¸­ 123456# å°æ‰¹é‡æ¢¯åº¦ä¸‹é™def mbgd(self, X_array, y_array, batch_size=64): for idx in range(0, X_array.shape[0], batch_size): X_batch = X_array[idx:idx+batch_size] y_batch = y_array[idx:idx+batch_size] self.update(X_batch, y_batch) å…¨æ ·æœ¬ æ¢¯åº¦ä¸‹é™é€Ÿåº¦æœ€æ…¢ï¼Œè¿­ä»£è®¡ç®—æ—¶é—´æœ€çŸ­ 123# å…¨æ ·æœ¬æ¢¯åº¦ä¸‹é™def fbgd(self, X_array, y_array): self.update(X_array, y_array) Adagrad è‡ªå®šä¹‰å­¦ä¹ ç‡ï¼ŒåæœŸæ›´æ–°å¾ˆæ…¢ 123456789101112# Adagraddef adagrad(self, X_array, y_array): sigma = 1e-7 # å¹³æ»‘é¡¹ for X_item, y_item in zip(X_array, y_array): X_single = X_item.reshape(1, -1) y_single = y_item.reshape(1, -1) grad = X_single.T.dot(self.model(X_single) - y_single) / 1 self.grad_sum = self.grad_sum + np.sum(grad * grad) dTheta = -self.eta * (grad / math.sqrt(self.grad_sum + sigma)) self.theta = self.theta + dTheta RMSprop è¿›åŒ–Adagradï¼Œå˜ç§Adadelta 123456789101112# RMSpropdef adadelta(self, X_array, y_array): sigma = 1e-7 # å¹³æ»‘é¡¹ gama = 0.5 # å†²é¡¶é¡¹ for X_item, y_item in zip(X_array, y_array): X_single = X_item.reshape(1, -1) y_single = y_item.reshape(1, -1) grad = X_single.T.dot(self.model(X_single) - y_single) / 1 self.grad_sum = gama * self.grad_sum + (1 - gama) * np.sum(grad * grad) dTheta = -self.eta * (grad / math.sqrt(self.grad_sum + sigma)) Adadelta è‡ªå®šä¹‰å­¦ä¹ ç‡ï¼ŒåæœŸæ›´æ–°å˜å¿« 1234567891011121314# Adadeltadef adadelta(self, X_array, y_array): sigma = 1e-7 # å¹³æ»‘é¡¹ gama = 0.9 # å†²é¡¶é¡¹ for X_item, y_item in zip(X_array, y_array): X_single = X_item.reshape(1, -1) y_single = y_item.reshape(1, -1) grad = X_single.T.dot(self.model(X_single) - y_single) / 1 self.grad_sum = gama * self.grad_sum + (1 - gama) * np.sum(grad * grad) dTheta = -self.eta * (grad / math.sqrt(self.grad_sum + sigma)) self.theta = self.theta + dTheta Adamax ç®€å•èŒƒå›´çš„Adamï¼Œå­¦ä¹ ç‡æœ‰ç¡®å®šèŒƒå›´ï¼Œå‚æ•°æ¯”è¾ƒå¹³ç¨³ 123456789101112131415161718# Adamaxdef adamax(self, X_array, y_array): sigma = 1e-7 # å¹³æ»‘é¡¹ u = 0.5 # å†²é¡¶é¡¹ v = 0.5 # å†²é¡¶é¡¹ for X_item, y_item in zip(X_array, y_array): X_single = X_item.reshape(1, -1) y_single = y_item.reshape(1, -1) grad = X_single.T.dot(self.model(X_single) - y_single) / 1 self.grad = u * self.grad + (1 - u) * grad self.grad_sum = np.maximum(v * self.grad_sum, np.sum(grad)) m_t_hat = self.grad / (1 - u) n_t_hat = self.grad_sum / (1 - v) dTheta = - self.eta / (n_t_hat + sigma) * m_t_hat self.theta = self.theta + dTheta Adam å¸¦åŠ¨é‡é¡¹çš„RMSpropï¼Œå­¦ä¹ ç‡æœ‰ç¡®å®šèŒƒå›´ï¼Œå‚æ•°æ¯”è¾ƒå¹³ç¨³ 123456789101112131415161718# Adamdef adam(self, X_array, y_array): sigma = 1e-7 # å¹³æ»‘é¡¹ u = 0.5 # å†²é¡¶é¡¹ v = 0.5 # å†²é¡¶é¡¹ for X_item, y_item in zip(X_array, y_array): X_single = X_item.reshape(1, -1) y_single = y_item.reshape(1, -1) grad = X_single.T.dot(self.model(X_single) - y_single) / 1 self.grad = u * self.grad + (1 - u) * grad self.grad_sum = v * self.grad_sum + (1 - v) * np.sum(grad * grad) m_t_hat = self.grad / (1 - u) n_t_hat = self.grad_sum / (1 - v) dTheta = - self.eta * (m_t_hat / (math.sqrt(n_t_hat) + sigma)) self.theta = self.theta + dTheta è½¯ä»¶å·¥ç¨‹ä¹‹æˆ’æ¨¡å—å‡½æ•°","link":"/2019/11/04/SCUTæœºå™¨å­¦ä¹  (3) ç®—æ³•ä¸å·¥ç¨‹/"},{"title":"#Machine Learning# SCUT Machine Learning(2) è®­ç»ƒã€æµ‹è¯•ä¸å¯è§†åŒ–","text":"æœ¬æ–‡ä¸»è¦è®¨è®ºMachine Learningçš„åŸºæœ¬æ­¥éª¤ï¼ŒåŒ…æ‹¬ä»¥ä¸‹ä¸‰ä¸ªéƒ¨åˆ†ï¼š è®­ç»ƒçš„ä¸‰éƒ¨æ›² æµ‹è¯•çš„éªŒè¯æ³• æ•°æ®çš„å¯è§†åŒ– Machine Learningè®­ç»ƒçš„ä¸‰éƒ¨æ›²Step 1: ModelStep 2: Goodness of FunctionStep 3: Best Functionåˆå¹¶æ›´æ–°å‚æ•°123456# æ›´æ–°å‚æ•°ï¼šæ¢¯åº¦ä¸‹é™def update(self, X, y): m = X.shape[0] # æ ‡ç­¾ä¸ªæ•° dTheta = X.T.dot(self.model(X) - y) / m self.theta = self.theta - self.eta * dTheta åˆ†å¼€æ›´æ–°å‚æ•°123456789# æ›´æ–°å‚æ•°ï¼šæ¢¯åº¦ä¸‹é™def update(self, X, y): m = X.shape[0] # æ ‡ç­¾ä¸ªæ•° dZ = self.model(X) - y dW = X.T.dot(dZ) / m db = dZ.sum(axis=0, keepdims=True) / m self.W = self.W - self.eta * dW self.b = self.b - self.eta * db æµ‹è¯•çš„éªŒè¯æ³•æŸå¤±å€¼å‡†ç¡®ç‡å›å½’é—®é¢˜1# pass åˆ†ç±»é—®é¢˜1234567891011121314# æ•°æ®çš„å‡†ç¡®ç‡def accuracy(self, X, y, threshold): y_pred = self.predict(X_test, threshold) y_true = y right = 0 total = y_pred.shape[0] for i in range(total): if y_pred[i] == y_true[i]: right += 1 acc = right / total return str(acc * 100) æ•°æ®çš„å¯è§†åŒ–æŸå¤±å€¼123456789# æ•°æ®çš„å¯è§†åŒ–def visualize(self, iter_list, loss_list): plt.figure('program title') plt.title('chart title') ax = plt.gca() ax.set_xlabel('epoch') ax.set_ylabel('loss') ax.plot(iter_list, loss_list, color='r', linewidth=1, alpha=0.6) plt.show()","link":"/2019/11/04/SCUTæœºå™¨å­¦ä¹  (2) è®­ç»ƒã€æµ‹è¯•ä¸å¯è§†åŒ–/"},{"title":"#Machine Learning# SCUT Machine Learning(1) æ•°æ®ä¸å‚æ•°","text":"æœ¬æ–‡ä¸»è¦è®¨è®ºMachine Learningçš„åŸºæœ¬æ­¥éª¤ï¼ŒåŒ…æ‹¬ä»¥ä¸‹ä¸¤ä¸ªéƒ¨åˆ†ï¼š è¯»å–å¤„ç†æ•°æ® åˆå§‹åŒ–å„å‚æ•° Machine Learningè¯»å–å¤„ç†æ•°æ®æœ¬åœ°æ•°æ®åˆå¹¶æ›´æ–°å‚æ•°123456789101112131415local_file = '$local_dataset_path'def load_data(path): # è¯»å–æœ¬åœ°åŸå§‹æ•°æ®é›† raw_data = datasets.load_svmlight_file(path) # è¿”å›scipy.matrix æˆ– raw_data = datasets.load_files(path) # è¿”å›numpy.ndarray # åˆ†å¼€å¤„ç†ç‰¹å¾å’Œæ ‡ç­¾ X, y = np.c_[raw_data[0].A, np.ones((raw_data[0].shape[0], 1))], raw_data[1].reshape(-1, 1) æˆ– X, y = np.c_[raw_data[0], np.ones((raw_data[0].shape[0], 1))], raw_data[1].reshape(-1, 1) # åˆ‡åˆ†è®­ç»ƒé›†å’ŒéªŒè¯é›† return model_selection.train_test_split(X, y, test_size=0.3, random_state=0) åˆ†å¼€æ›´æ–°å‚æ•°123456789101112131415local_file = '$local_dataset_path'def load_data(path): # è¯»å–æœ¬åœ°åŸå§‹æ•°æ®é›† raw_data = datasets.load_svmlight_file(path) # è¿”å›scipy.matrix æˆ– raw_data = datasets.load_files(path) # è¿”å›numpy.ndarray\"\"\" # åˆ†å¼€å¤„ç†ç‰¹å¾å’Œæ ‡ç­¾ X, y = raw_data[0].A, raw_data[1].reshape(-1, 1) æˆ– X, y = raw_data[0], raw_data[1].reshape(-1, 1) # åˆ‡åˆ†è®­ç»ƒé›†å’ŒéªŒè¯é›† return model_selection.train_test_split(X, y, test_size=0.3, random_state=0) ç½‘ç»œæ•°æ®åˆå¹¶æ›´æ–°å‚æ•°1# pass åˆ†å¼€æ›´æ–°å‚æ•°1# pass éšæœºæŠ½æ ·1234567891011121314# éšæœºæŠ½æ ·def random_select(self, X, y, sample_size=1024): m = X.shape[0] # æ ‡ç­¾ä¸ªæ•° i_list = random.sample([idx for idx in range(n)], batch_size) # ä¸‹æ ‡åºåˆ— X_list = [] y_list = [] for i in i_list: X_list.append(X[i]) y_list.append(y[i]) X_array = np.array(X_list) y_array = np.array(y_list) return X_array, y_array åˆå§‹åŒ–å„å‚æ•°ä¸æŠ½æ ·åˆå¹¶æ›´æ–°å‚æ•°123456# åŠ è½½å‚æ•°def __init__(self, eta, epo, batch_size, n): self.eta = eta # å­¦ä¹ é€Ÿç‡ self.epo = epo # è¿­ä»£æ¬¡æ•° self.batch_size = batch_size # æ‰¹å¤„ç†é‡ self.theta = np.zeros((n, 1)) # æƒé‡åç½® åˆ†å¼€æ›´æ–°å‚æ•°1234567# åŠ è½½å‚æ•°def __init__(self, eta, epo, batch_size, n): self.eta = eta # å­¦ä¹ é€Ÿç‡ self.epo = epo # è¿­ä»£æ¬¡æ•° self.batch_size = batch_size # æ‰¹å¤„ç†é‡ self.W = np.zeros((n, 1)) # æƒé‡å‚æ•° self.b = 0 # åç½®å‚æ•° è¦æŠ½æ ·åˆå¹¶æ›´æ–°å‚æ•°1234567# åŠ è½½å‚æ•°def __init__(self, eta, epo, sample_size, batch_size, n): self.eta = eta # å­¦ä¹ é€Ÿç‡ self.epo = epo # è¿­ä»£æ¬¡æ•° self.sample_size = sample_size # æŠ½æ ·å¤§å° self.batch_size = batch_size # æ‰¹å¤„ç†é‡ self.theta = np.zeros((n, 1)) # æƒé‡åç½® åˆ†å¼€æ›´æ–°å‚æ•°12345678# åŠ è½½å‚æ•°def __init__(self, eta, epo, sample_size, batch_size, n): self.eta = eta # å­¦ä¹ é€Ÿç‡ self.epo = epo # è¿­ä»£æ¬¡æ•° self.sample_size = sample_size # æŠ½æ ·å¤§å° self.batch_size = batch_size # æ‰¹å¤„ç†é‡ self.W = np.zeros((n, 1)) # æƒé‡å‚æ•° self.b = 0 # åç½®å‚æ•°","link":"/2019/11/04/SCUTæœºå™¨å­¦ä¹  (1) æ•°æ®ä¸å‚æ•°/"},{"title":"#WSL# WSLä»å…¥é—¨åˆ°...(1) WSL 1 vs WSL 2","text":"å¯¹æ¯”é€‚ç”¨äº Linux çš„ Windows å­ç³»ç»Ÿï¼ˆWindows Subsystem for Linux, WSLï¼‰çš„ä¸¤ä¸ªç‰ˆæœ¬ - WSL 1 å’Œ WSL 2 ï¼Œä¸»è¦åˆ†ä¸ºä»¥ä¸‹å…­ä¸ªéƒ¨åˆ†ï¼š å‰æƒ…æè¦ ç›¸å…³ç®€ä»‹ æ€§èƒ½å¯¹æ¯” æ¶æ„å¯¹æ¯” å‡ ç‚¹æ€»ç»“ å‚è€ƒé“¾æ¥ ç›®å½• Table of Contents å‰æƒ…æè¦ å‰é˜µç½‘ä¸Šå†²æµªå›´è§‚ M$ Build 2019 çš„ WSL Session ï¼Œæ„Ÿå—äº†ä¸€æ³¢ Microsoft â¤ Open Sourceï¼Œé‚å†³å®šæ ¹æ®è®²åº§å’Œæ–‡æ¡£å†…å®¹å½“ä¸€æ¬¡å¤è¯»æœºè®¨è®ºä¸€ä¸‹ WSL ( å•Šæˆ‘çš„å¡‘æ–™è‹±è¯­_(:Ğ·)âˆ )_ã€‚ ç›¸å…³ç®€ä»‹ The Windows Subsystem for Linux lets developers run a GNU/Linux environment â€“ including most command-line tools, utilities, and applications â€“ directly on Windows, unmodified, without the overhead of a virtual machine. é€‚ç”¨äº Linux çš„ Windows å­ç³»ç»Ÿï¼ˆWindows Subsystem for Linux, WSLï¼‰å¯ä»¥ç®€å•åœ°ç†è§£ä¸ºåœ¨ Windows ä¸Šæä¾›äº†è¿è¡Œ Linux çš„å¹³å°ã€‚ç”±äºæ˜¯ Subsystem ï¼Œä¸è£¸æœºè£… Linux Distribution ç›¸æ¯”ï¼Œå­˜åœ¨åŠŸèƒ½é™åˆ¶å’Œæ€§èƒ½æ‰“æŠ˜çš„æƒ…å†µã€‚ You can: â€¦â€¦ Invoke Windows applications using a Unix-like command-line shell. Invoke GNU/Linux applications on Windows. â€¦â€¦ å¯¹äºæ‡’å¾—å¼€è™šæ‹Ÿæœºorè£…åŒç³»ç»Ÿ + ECSæ¸£æ¸£çº§é…ç½® + éå°Šè´µè‹¹æœç”¨æˆ·è€Œè¨€ï¼Œ WSL è¿˜æ˜¯å¾ˆæœ‰å¸å¼•åŠ›çš„ (è™½ç„¶ä¹Ÿå¾ˆå¤šå‘ã€‚é™¤äº†å¯¹ Linux æœ¬èº«æœ‰éœ€æ±‚å¤–ï¼Œä¸Šé¢æåˆ°çš„ Windows å’Œ Linux äº’ç›¸invoke ä¹Ÿå¾ˆæœ‰æ„æ€ï¼Œ WSL å› æ­¤å¤§å¤§é™ä½äº†åŸæœ¬é…ç½®ä¸¤ä¸ªæ–‡ä»¶ç³»ç»Ÿçš„ç¹çç¨‹åº¦ã€‚ æ€§èƒ½å¯¹æ¯” WSL 2 ç›¸æ¯” WSL 1ï¼Œä¸»è¦ä¼˜åŒ–äº†è®¿é—®æ–‡ä»¶ç³»ç»Ÿçš„é€Ÿåº¦ä»¥åŠæä¾›äº†æ›´å®Œæ•´çš„ç³»ç»Ÿè°ƒç”¨æ¥å£ã€‚ File system performance Full system call compatibility æ¶æ„å¯¹æ¯” WSL 1 WSL 1 çš„å¤§ä½“æ€è·¯æ˜¯ï¼Œåœ¨ä¸€å° Windows ä¸»æœºä¸Šå®‰è£… Linux å‘è¡Œç‰ˆæœ¬ï¼Œä¾èµ–ä¸­é—´å±‚çš„é©±åŠ¨å™¨å®Œæˆ Linux Namespace å’Œ Windows Kernel ä¹‹é—´çš„é€šä¿¡æ•è·å’ŒæŒ‡ä»¤ç¿»è¯‘ï¼ˆæ¯”å¦‚ path å’Œ flag ï¼‰ï¼Œä½œç”¨èŒƒå›´åŒ…æ‹¬ä½†ä¸å±€é™äºç³»ç»Ÿè°ƒç”¨ã€æ–‡ä»¶ç³»ç»Ÿã€æƒé™ç®¡ç†å’Œç½‘ç»œé…ç½®ç­‰ã€‚ è¿™æ ·çš„è®¾è®¡å­˜åœ¨ä¸€äº›ç¼ºé™·ï¼š æŸäº›ç¿»è¯‘æ— å¯é¿å…åœ°éœ€è¦ä»˜å‡ºæ—¶ç©ºä»£ä»·ï¼Œç”šè‡³ç”±äºä¸¤ç§å†…æ ¸çš„è®¾è®¡æ€æƒ³å­˜åœ¨å†²çªè€Œæ— æ³•è¿›è¡Œã€‚ ç”±äº Linux Kernel æ›´æ–°å¾—éå¸¸å¿«ï¼Œå•é  M$ Team è‡ªå·±å®ç°ç¿»è¯‘ï¼Œå¼€å‘è¿›åº¦è¿œè¿œæ»åäºå®é™…ç”Ÿäº§éœ€æ±‚ã€‚ ã€æ›´å¤šè¯¦è§ ğŸ‘‰ WSLä»å…¥é—¨åˆ°â€¦(2) Dive into WSL 1ã€‘ WSL 2 WSL 2 çš„å¤§ä½“æ€è·¯æ˜¯ï¼Œå¼€å¯ Hyper-V åŠŸèƒ½ï¼ŒWindows Hyper-V Containerï¼ˆåŒ…å«Windows Kernelå’ŒWindows Usermodeï¼‰æŒç»­è¿è¡Œï¼ŒLinux Hyper-V Containerï¼ˆåŒ…å«Linux Kernelå’ŒLinux Usermodeï¼‰éšç”¨éšå¼€ï¼Œä¸¤è€…é€šè¿‡ Socket é€šä¿¡ã€‚ è¿™æ ·çš„è®¾è®¡å­˜åœ¨ä¸€äº›ç¼ºé™·ï¼š éœ€è¦å¤„ç†å™¨æä¾›è™šæ‹ŸåŒ–é€‰é¡¹ï¼Œä¸€äº› arm64 æ¶æ„çš„èŠ¯ç‰‡ä¸æ”¯æŒè¯¥åŠŸèƒ½ã€‚ Windows å¼€Hyper-Våå°†æ— æ³•åŒæ—¶è¿è¡Œ VMware å’Œ Virtual Box ç­‰å·¥å…·ï¼Œå› ä¸ºå®ƒä»¬éƒ½è¦æ±‚ç‹¬å  Hypervisor æ‰èƒ½å¤Ÿè¿è¡Œã€‚ è™šæ‹ŸåŒ–ä¼´éšä¸€ç³»åˆ—ä¸€è‡´æ€§é—®é¢˜ï¼Œæ¯”å¦‚æƒé™ç®¡ç†å’Œç½‘ç»œé…ç½®ç­‰ç­‰ã€‚ ã€æ›´å¤šè¯¦è§ ğŸ‘‰ WSLä»å…¥é—¨åˆ°â€¦(3) Dive into WSL 2ã€‘ Linux Kernel ç”¨ Linux Kernel æ˜¯ä¸ºäº†è§£å†³ WSL 1 çš„é—ç•™é—®é¢˜ï¼ˆâ€œUses real Linux kernel for improved performance and perfect compatibilityâ€ï¼‰ï¼Œç¿»è¯‘ä¸å¥½æå°±â€œæ‹¿æ¥ä¸»ä¹‰â€ã€‚ M$ ç”šè‡³ä¸º WSL 2 å®šåˆ¶äº† Linux Kernel (æ²¡æƒ³åˆ°å§.jpg Virtualization è¦ä½¿ä¸¤ç§å†…æ ¸èƒ½å¤Ÿå…±å­˜æœ€ç›´æ¥çš„æ€è·¯å°±æ˜¯ä½¿ç”¨è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œè€Œ WSL 2 é‡‡ç”¨äº†ä¸€ç§æœ‰åˆ«äºä¼ ç»Ÿè™šæ‹Ÿæœºå’Œæ–°å…´å®¹å™¨çš„æ–°(?)æ–¹æ³• - Lightweight utility VMï¼Œå…¶ç‰¹ç‚¹æ˜¯é›†æˆåº¦é«˜ï¼ˆå…³è” Windows æœåŠ¡ï¼‰ä¸”åªåœ¨è¿è¡Œæ—¶å¯åŠ¨ï¼ˆå¦åˆ™è¢«é”€æ¯å›æ”¶ï¼‰ã€‚ ç›¸æ¯”ä¼ ç»Ÿè™šæ‹Ÿæœºï¼Œå†…å­˜å ç”¨æ›´å°ã€å¯åŠ¨é€Ÿåº¦æ›´å¿«ä»¥åŠå¯ä»¥åŒæ—¶è¿è¡Œæ›´å¤šå®ä¾‹ã€‚ ç›¸æ¯”æ–°å…´å®¹å™¨ï¼ŒåŸºäº Hyper-V é¢å‘ server åœºæ™¯ï¼Œæœ¬è´¨è¿˜æ˜¯ VM ï¼Œéš”ç¦»å¾—æ›´å½»åº•ã€‚ å‡ ç‚¹æ€»ç»“ æ ¹æ®PMçš„è¯´æ³•ï¼Œ WSL 1 å’Œ WSL 2 ä¼šå¹¶è¡Œç»´æŠ¤ï¼Œæ—¢é€‚ç”¨äºæ¡Œé¢ç‰ˆä¹Ÿå¯ä»¥è¿è¡Œåœ¨æœåŠ¡å™¨ã€‚ä¸‹é¢ç®€å•å›é¡¾ä¸¤è€…çš„åŒºåˆ«ï¼š WSL 1 WSL 2 æ ¸å¿ƒæŠ€æœ¯ Pico provider drivers Lightweight utility VM åŒä¸€å®ä¾‹ï¼ˆContainerï¼‰ âœ“ âœ— é¢å¤–æ”¯æŒï¼ˆè™šæ‹ŸåŒ–ï¼‰ âœ— âœ“ æ–‡ä»¶ç³»ç»Ÿ è®¿é—®æ…¢ è®¿é—®å¿« ç³»ç»Ÿè°ƒç”¨ ç¼ºå°‘ å®Œæ•´ æƒé™ç®¡ç† ç›¸åŒ ä¸åŒ ç½‘ç»œé…ç½® ç›¸åŒ ä¸åŒ åç»­ä¸¤èŠ‚å°†åˆ†åˆ«å†æ·±å…¥ä»‹ç» WSL 1 å’Œ WSL 2 çš„å®ç°ç»†èŠ‚ã€‚é‚£ä¹ˆæˆ‘å…ˆå å‘é€ƒäº†ï¼ˆï¼ˆï¼ˆ å‚è€ƒé“¾æ¥ The new Windows subsystem for Linux architecture: a deep dive Windows Subsystem for Linux Documentation","link":"/2019/12/12/WSLä»å…¥é—¨åˆ°...(1)/"},{"title":"#Git# é€ŸæŸ¥æ‰‹å†Œï¼šå¸¸ç”¨ Git å‘½ä»¤","text":"è¦†ç›–åœ¨å­¦ä¹ å’Œå·¥ä½œä¸­çš„å¸¸ç”¨ Git å‘½ä»¤ï¼šé…ç½® / ä»“åº“ / æŸ¥çœ‹ / æš‚å­˜ / æäº¤ / å›é€€ / å…‹éš† / æ‹‰å– / æ¨é€ / åˆå¹¶ / å†²çª / åˆ†æ”¯ / æ ‡ç­¾ / å·¥å…· ç›®å½• Table of Contents é…ç½®è´¦å·1234567891011# é…ç½®å¤šä¸ªæœ¬åœ°ç”¨æˆ·çš„è´¦å·# å…¨å±€çº§git config --global user.name \"${user_name}\"git config --global user.email \"${user_email}\"# ä»“åº“çº§# git config --global --unset user.name \"${user_name}\"# git config --global --unset user.name \"${user_email}\"git config --local user.name \"${user_name}\"git config --local user.email \"${user_email}\" å¯†é’¥1234567891011121314151617181920# é…ç½®å¤šä¸ªè¿œç¨‹ä»“åº“çš„å¯†é’¥# ç”Ÿæˆå¯†é’¥ssh-keygen -t rsa_githubssh-keygen -t rsa_gitlab# é…ç½®å¯†é’¥vim ~/.ssh/configHost github.comHostName github.comUser gitIdentityFile ~/.ssh/rsa_github Host gitlab.comHostName gitlab.comUser gitIdentityFile ~/.ssh/rsa_gitlab:wq ä»“åº“æŸ¥çœ‹1git remote -v æ–°å»º12# Example: git remote add origin git@github.com:LotteWong/lottewong.github.io.gitgit remote add ${origin_name} git@host:/path/to/registry.git åˆ é™¤1git remote rm ${origin_name} æŸ¥è¯¢å½“å‰çŠ¶æ€1git status å·®å¼‚åˆ†æå·¥ä½œåŒº vs æš‚å­˜åŒº1git diff (${branch_name}) (${file}) # é»˜è®¤ branch = current; file è‹¥ä¸å¡«ä½œç”¨äºå…¨éƒ¨æ–‡ä»¶ æš‚å­˜åŒº vs ç‰ˆæœ¬åº“1git diff --cached (${commit_id}) (${file}) # é»˜è®¤ commit = HEAD; file è‹¥ä¸å¡«ä½œç”¨äºå…¨éƒ¨æ–‡ä»¶ å·¥ä½œåŒº vs ç‰ˆæœ¬åº“1git diff ${commit_id} (${file}) # file è‹¥ä¸å¡«ä½œç”¨äºå…¨éƒ¨æ–‡ä»¶ ç‰ˆæœ¬åº“ vs ç‰ˆæœ¬åº“1git diff ${commit_id} ${commit_id} (${file}) # file è‹¥ä¸å¡«ä½œç”¨äºå…¨éƒ¨æ–‡ä»¶ æäº¤è®°å½•123git log # è¯¦ç»†git log --oneline # ç®€ç•¥git log --graph # å›¾ç¤º æ“ä½œè®°å½•1git reflog æš‚å­˜æŸ¥çœ‹1git stash list ä¿å­˜1git stash æ¢å¤12git stash pop # é»˜è®¤è¿˜åŸæ ˆé¡¶æ•°æ®git stash pop stash@{${id}} # æŒ‡å®šè¿˜åŸç‰¹å®šæ•°æ® åˆ é™¤12git stash clear # åˆ é™¤å…¨éƒ¨æš‚å­˜æ•°æ®git stash drop stash@{${id}} # åˆ é™¤æŒ‡å®šæš‚å­˜æ•°æ® æäº¤æš‚å­˜åŒº123git add -A or git add --all # æäº¤æ•´ä¸ªä»“åº“å…¨éƒ¨æ–‡ä»¶(New/Modified/Deleted)git add /path/to/file # æäº¤æŒ‡å®šç›®å½•å…¨éƒ¨æ–‡ä»¶(New/Modified/Deleted)git add -u # æäº¤æ•´ä¸ªä»“åº“å·²æœ‰æ–‡ä»¶(Modified/Deleted) ç‰ˆæœ¬åº“123git commit -m \"${commit_message}\" # æŒ‡å®šæäº¤ä¿¡æ¯æ ‡é¢˜git commit # æ‰“å¼€é»˜è®¤çš„ç¼–è¾‘å™¨git commit --amend # è¿½åŠ æäº¤ å›é€€å·¥ä½œåŒº12git reset --hard (${commit_id}) (${file}) # é»˜è®¤ commit = HEAD; file è‹¥ä¸å¡«ä½œç”¨äºå…¨éƒ¨æ–‡ä»¶# git checkout ${commit_id} ${file} æš‚å­˜åŒº12git reset (--mixed) (${commit_id}) (${file}) # ä¼šæ¸…é™¤æš‚å­˜åŒº; é»˜è®¤ commit = HEAD; file è‹¥ä¸å¡«ä½œç”¨äºå…¨éƒ¨æ–‡ä»¶# git checkout ${commit_id} ${file} ç‰ˆæœ¬åº“1234567# å‘å‰ç§»åŠ¨æŒ‡é’ˆgit reset --soft (${commit_id}) (${file}) # ä¸æ¸…é™¤æš‚å­˜åŒº; é»˜è®¤ commit = HEAD; file è‹¥ä¸å¡«ä½œç”¨äºå…¨éƒ¨æ–‡ä»¶# git checkout ${commit_id} ${file}# å‘åç§»åŠ¨æŒ‡é’ˆgit revert (${commit_id}) # é»˜è®¤ commit = HEAD; æ’¤é”€å•æ¬¡æäº¤å¹¶ç”Ÿæˆå•æ¬¡æäº¤git revert -n ${old_commit}^..${new_commit} # æ’¤é”€è¿ç»­æäº¤å¹¶ç”Ÿæˆå•æ¬¡æäº¤ å…‹éš†12345# Example: git clone git@github.com:LotteWong/lottewong.github.io.gitgit clone git@host:/path/to/registry.git # å…‹éš†é»˜è®¤åˆ†æ”¯# Example: git clone -b backup git@github.com:LotteWong/lottewong.github.io.gitgit clone -b ${branch_name} git@host:/path/to/registry.git # å…‹éš†æŒ‡å®šåˆ†æ”¯ æ‹‰å–123456git pull origin ${remote_branch} # æ‹‰å–åˆ°å·²æœ‰æœ¬åœ°åˆ†æ”¯git checkout -b ${local_branch}:${remote_branch} # æ‹‰å–å¹¶æ–°å»ºæœ¬åœ°åˆ†æ”¯git fetch origin ${remote_branch}git pull origin ${remote_branch} # git fetch + git mergegit pull origin --rebase ${remote_branch} # git fetch + git rebase æ¨é€12git push origin ${remote_branch} # æ¨é€åˆ°å·²æœ‰è¿œç¨‹åˆ†æ”¯git push origin ${local_branch}:${remote_branch} # æ¨é€å¹¶æ–°å»ºè¿œç¨‹åˆ†æ”¯ åˆå¹¶Merge1234git merge ${branch_name} # å¸¦æœ‰å•ç‹¬åˆå¹¶æäº¤ä¿¡æ¯git merge ${branch_name} --no-commit # ä¸å¸¦å•ç‹¬åˆå¹¶æäº¤ä¿¡æ¯git merge --continue # è§£å†³å†²çªåä½¿ç”¨git merge --abort # ä¸æ‰“ç®—è§£å†³å†²çª Squash1234git merge --squash ${branch_name} # A1 â†’ B1 â†’ M3git rebase -i ${startpoint} (${endpoint}) # A1 â†’ B1 â†’ C2 â†’ D2; é»˜è®¤ endpoint = HEAD# pick(p)ï¼šä¿ç•™æœ¬æ¬¡æäº¤# squash(s)ï¼šåˆå¹¶å‰åæäº¤ Rebase123git rebase ${branch_name}git rebase --continue # è§£å†³å†²çªåä½¿ç”¨git rebase --abort # ä¸æ‰“ç®—è§£å†³å†²çª Cherry-Pick123git cherry-pick ${commit_id}git cherry-pick --continue # è§£å†³å†²çªåä½¿ç”¨git cherry-pick --abort # ä¸æ‰“ç®—è§£å†³å†²çª å†²çª1234git status # æŸ¥çœ‹å†²çªæ–‡ä»¶vim /path/to/file # è§£å†³å†²çªä¹‹å¤„git add /path/to/file # å°†æ–‡ä»¶åŠ å…¥æš‚å­˜åŒºgit commit -m \"${commit_message}\" # å°†æ–‡ä»¶åŠ å…¥ç‰ˆæœ¬åº“ åˆ†æ”¯æŸ¥çœ‹123git branch -a # å…¨éƒ¨åˆ†æ”¯git branch -v # æœ¬åœ°åˆ†æ”¯git branch -r # è¿œç¨‹åˆ†æ”¯ æ›´æ–°1git remote update æ–°å»º12git checkout -b ${local_branch}:${remote_branch} # åˆ›å»ºæœ¬åœ°åˆ†æ”¯ï¼šè¿œç¨‹åˆ†æ”¯ â†’ æœ¬åœ°åˆ†æ”¯git push origin ${local_branch}:${remote_branch} # åˆ›å»ºè¿œç¨‹åˆ†æ”¯ï¼šæœ¬åœ°åˆ†æ”¯ â†’ è¿œç¨‹åˆ†æ”¯ åˆ‡æ¢1git checkout ${branch_name} åˆ é™¤123git branch -d ${local_branch} # éå¼ºåˆ¶åˆ é™¤æœ¬åœ°åˆ†æ”¯git branch -D ${local_branch} # å¼ºåˆ¶æ€§åˆ é™¤æœ¬åœ°åˆ†æ”¯git push origin --delete ${remote_branch} # åˆ é™¤è¿œç¨‹åˆ†æ”¯ æ ‡ç­¾æŸ¥çœ‹12git tag # å…¨éƒ¨æ ‡ç­¾git show ${tag_name} # æŒ‡å®šæ ‡ç­¾ æ–°å»º123git tag ${tag_name} (${commit_id}) # åˆ›å»ºæœ¬åœ°æ ‡ç­¾; é»˜è®¤ commit = HEADgit push origin --tags # åˆ›å»ºå…¨éƒ¨è¿œç¨‹æ ‡ç­¾git push origin ${tag_name} # åˆ›å»ºæŒ‡å®šè¿œç¨‹æ ‡ç­¾ åˆ é™¤12git tag -d ${tag_name} # åˆ é™¤æœ¬åœ°æ ‡ç­¾git push origin --delete ${tag_name} å·¥å…·æäº¤è§„èŒƒ12345# å®‰è£…npm install -g commitizen cz-conventional-changelog# ä½¿ç”¨git cz å˜æ›´æ—¥å¿—12345# å®‰è£…npm install -g conventional-changelog-cli# ä½¿ç”¨conventional-changelog -p angular -i CHANGELOG.md -s -r 0 ä»£ç è¯„å®¡ To be continuedâ€¦ å­çº§æ¨¡å— To be continuedâ€¦","link":"/2020/05/21/é€ŸæŸ¥æ‰‹å†Œä¹‹å¸¸ç”¨Gitå‘½ä»¤/"},{"title":"#WSL# WSLä»å…¥é—¨åˆ°...(3) Dive into WSL 2","text":"å¯¹ WSL 2 çš„ä¸€äº›å®ç°ç»†èŠ‚è¿›è¡Œè¡¥å……è¯´æ˜ï¼Œä¸»è¦åˆ†ä¸ºä»¥ä¸‹äº”ä¸ªéƒ¨åˆ†ï¼š å‰æƒ…æè¦ èƒŒæ™¯ æ¶æ„ä¸ç­”ç–‘ æ€»ç»“ å‚è€ƒé“¾æ¥ ç›®å½• Table of Contents å‰æƒ…æè¦ å‰é¢å·²ç»ç®€è¦ä»‹ç»äº† WSL 1 å’Œ WSL 2 çš„åŒºåˆ«ï¼Œæœ¬èŠ‚å°†èšç„¦äº WSL 2çš„å®ç°ç»†èŠ‚ã€‚ç‚¹å¼€å®˜æ–¹åšå®¢å¼€å§‹æ”¶è·æƒŠ(da)å–œ(keng)ï¼Œæ‰ç–å­¦æµ…å†™é”™ä¹Ÿä¸è¦æ‰“æˆ‘ (é¢„å…ˆæ„Ÿè°¢å„ä½å‹˜è¯¯ é€ƒ ã€æ›´å¤šä¿¡æ¯ ğŸ‘‰ WSLä»å…¥é—¨åˆ°â€¦(1) WSL 1 vs WSL 2ã€‘ èƒŒæ™¯åŠŸèƒ½ â€¦â€¦ still provides the same user experience as in WSL 1 (the current widely available version). æ€§èƒ½ Its primary goals are to increase file system performance, as well as adding full system call compatibility. å…¼å®¹ Individual Linux distros can be run either as a WSL 1 distro, or as a WSL 2 distro, can be upgraded or downgraded at any time, and you can run WSL 1 and WSL 2 distros side by side. æ¶æ„ å·¥ä½œæµå¤§æ¦‚æ˜¯ï¼š å¯åŠ¨ LXSS Manager Service è·Ÿè¸ª Linux Distribution çš„å®‰è£…ã€è¿è¡Œå’Œå¸è½½ã€‚ å¯åŠ¨ Host compute service å’Œ Host Network Service åˆ›å»ºå’Œåˆå§‹åŒ– Lightweight utility VM å®ä¾‹ã€‚ è¢«å°è£…å¥½çš„ï¼ˆâ€œshipping in boxâ€ï¼‰åŸºäº Linux Kernel çš„è™šæ‹Ÿæœºè¿è¡Œã€‚ LXSS Manager Service æ˜ å°„ã€åŠ è½½å’Œç®¡ç† Linux Distribution çš„æ–‡ä»¶ç³»ç»Ÿã€‚ ä»¥ä¸Šå‡†å¤‡å·¥ä½œå®Œæˆåï¼Œwsl.exe å’Œ bash ä¹‹é—´å°†é€šè¿‡ socket ä¼ é€’æŒ‡ä»¤æ¥å®Œæˆä½œä¸šã€‚ PS: Lightweight utility VM åªä¼šåœ¨éœ€è¦æ—¶åˆ›å»ºè¿è¡Œï¼Œå¦‚æœ bash æˆ– wsl.exe é€€å‡ºï¼Œä¸€æ®µæ—¶é—´åå°†ä¼šè¢«å›æ”¶ã€‚ è®¿é—® Windows æ–‡ä»¶ Windows ä¸»æœºå¯åŠ¨ä¸€ä¸ªæ–‡ä»¶æœåŠ¡å™¨ï¼Œæ­¤æ—¶ Linux ä½œä¸ºå®¢æˆ·ç«¯å‘é€è¯·æ±‚ï¼Œä¸¤è€…ä½¿ç”¨ 9P åè®®è¿›è¡Œé€šä¿¡ã€‚ æ•ˆæœçœ‹èµ·æ¥åƒæŠŠ Windows çš„ C ç›˜æŒ‚è½½åˆ°äº† Linux çš„ /mnt ç›®å½•ä¸‹ã€‚è®¿é—® Linux çš„ /mnt/c å°±æ˜¯åœ¨ è®¿é—® Window çš„ C:\\ ã€‚ PS: ç‰¹åˆ«åœ°ï¼Œå¦‚æœåœ¨ bash å†…å¯åŠ¨ cmd.exe ï¼Œç”±äº Windows å’Œ Linux çš„å¯æ‰§è¡Œæ–‡ä»¶æ ¼å¼ä¸åŒï¼ˆå‰è€…æ˜¯ PE æˆ– PE32+ ï¼Œåè€…æ˜¯ ELF32 æˆ– ELF64ï¼‰ï¼Œ.exe æ–‡ä»¶æ— æ³•ç›´æ¥è¿è¡Œã€‚WSL 2 çš„å¤„ç†æ–¹æ³•å®é™…ä¸Šæ˜¯ï¼šLinux ä¸‹çš„ bash å‘ wsl.exe å‘é€ Interop commandï¼ŒWindows ä¸‹çš„ wsl.exe è§£æåå¯åŠ¨ .exe æ–‡ä»¶ã€‚ è®¿é—® Linux æ–‡ä»¶ Linux è™šæ‹Ÿæœºå¯åŠ¨ä¸€ä¸ªæ–‡ä»¶æœåŠ¡å™¨ï¼Œæ­¤æ—¶ Windows ä½œä¸ºå®¢æˆ·ç«¯å‘é€è¯·æ±‚ï¼Œä¸¤è€…ä½¿ç”¨ 9P åè®®è¿›è¡Œé€šä¿¡ã€‚ æ•ˆæœçœ‹èµ·æ¥åƒåœ¨ Windows ä¸Šå¼€ä¸€èˆ¬çš„è™šæ‹Ÿæœºï¼Œå¯¹åº”çš„ç›®å½•ï¼ˆåœ¨ Network å†…ï¼‰å¯ä»¥è¢«æ–‡ä»¶èµ„æºç®¡ç†å™¨è½»æ¾åœ°è®¿é—®ã€‚ PS: ä»ä¸Šè¿°ä¸­å¯è§ï¼ŒWSL 2 è®¿é—®æ–‡ä»¶çš„ä¸­å¿ƒè§‚ç‚¹ â€”â€” â€œä¸¤ä¸ªç³»ç»Ÿéƒ½åšå„è‡ªå¯ä»¥åš / æ“…é•¿åšçš„äº‹æƒ…ï¼Œé‡äº‹ä¸å†³å°±é€šè¿‡socketå‘æŒ‡ä»¤å±ä¸€å£°ï¼Œè€Œä¸ä¼šé€‰æ‹©ç®€å•ç²—æš´åœ°ç¿»è¯‘ã€‚â€ ç­”ç–‘ Q1: Microsoft çš„ Linux Team æ ¹æ® WSL 2 é’ˆå¯¹ Linux Kernel åšäº†å“ªäº›è°ƒæ•´ï¼Ÿ A1: é¦–å…ˆï¼Œå’Œ WSL 1 ä¸€æ ·ï¼ŒWSL 2 æœ¬èº«å¹¶ä¸æä¾› Linux å‘è¡Œç‰ˆæœ¬ï¼Œç”¨æˆ·éœ€è‡ªè¡Œå‰å¾€ Windows Store ä¸‹è½½æˆ–è„šæœ¬å®‰è£…è‡ªå®šä¹‰çš„å‘è¡Œç‰ˆæœ¬ï¼›å…¶æ¬¡ï¼ŒWSL 2 çš„ Linux Kernel åŸºäºç¨³å®šçš„ version 4.19ï¼Œå¹¶åœ¨å¯åŠ¨æ—¶é—´ã€å†…å­˜å ç”¨å’Œéœ€æ”¯æŒè®¾å¤‡æ•°ç­‰æ–¹é¢éƒ½è¿›è¡Œäº†ç›¸åº”çš„ä¼˜åŒ–ï¼›æœ€åï¼Œ WSL 2 å°†é€šè¿‡ Windows æ›´æ–°æ¥æ¨é€æ–°æœåŠ¡ï¼Œå¹¶ç”± Microsoft åŠå…¶å®ƒä¸“ä¸šçš„å•†ä¸šä¼™ä¼´æä¾›å®‰å…¨ç›‘æ§å’Œä¿éšœã€‚ Q2: å¯ä»¥åœ¨è™šæ‹Ÿæœºä¸­ä½¿ç”¨ WSL 2 å—ï¼Ÿ A2: å¯ä»¥ï¼Œä½†è¦ç¡®ä¿å¼€å¯ nested virtualization é€‰é¡¹ï¼ˆåœ¨ Windows PowerShell ï¼ˆä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œï¼‰ä¸­è¾“å…¥ Set-VMProcessor -VMName &lt;VMName&gt; -ExposeVirtualizationExtensions $true å‘½ä»¤ï¼‰ã€‚ Q3: WSL 1 ä¸­çš„é…ç½®æ–‡ä»¶ wsl.conf åœ¨ WSL 2 ä¸­ä»å¯ä»¥ä½¿ç”¨å—ï¼Ÿ A3: å¯ä»¥ï¼Œæ¯”å¦‚è‡ªåŠ¨æŒ‚è½½ç£ç›˜ã€å¼€å¯æˆ–å…³é—­ interop commandå’Œæ›´æ”¹æŒ‚è½½ç›®å½•ç­‰æ“ä½œéƒ½å°†ç»§ç»­æ”¯æŒï¼Œæ›´å¤š WSL é…ç½®é¡¹å¯è§ Distro Management ã€‚ Q4: WSL 2 å°†æ”¯æŒ Docker æŠ€æœ¯ï¼ŒWSL 2 çš„ Docker ä¼šæœ‰ä»€ä¹ˆç‰¹åˆ«çš„é™åˆ¶å—ï¼Ÿ A4: å¦‚æœå¯åŠ¨çš„æ˜¯ Windows çš„ Docker ï¼Œå°†æŒ‰ç…§ Window çš„ Docker å·¥ä½œï¼›å¦‚æœå¯åŠ¨çš„æ˜¯ Linux çš„ Docker ï¼Œå°†æŒ‰ç…§ Linux çš„ Docker å·¥ä½œã€‚å°½ç®¡ Windows çš„ Docker å’Œ Linux çš„ Docker å®ç°æ–¹å¼æœ‰æ‰€å‡ºå…¥ï¼ˆç”±äºç¯‡å¹…æœ‰é™ï¼Œå°†ä¸å±•å¼€è¯´æ˜ï¼‰ï¼Œä½†åŸåˆ™ä¸Š WSL 2 ä¸å­˜åœ¨å¯¹ Docker çš„ç‰¹åˆ«é™åˆ¶ã€‚ Q5: æœ‰æ²¡æœ‰é’ˆå¯¹ WSL 2 çš„ç¡¬ä»¶æ”¯æŒï¼Œæ¯”å¦‚è®¿é—®å¹¶åŠ é€ŸGPUå¹¶ä¹‹ç±»ï¼Ÿ A5: æš‚æœªå®Œå–„ï¼Œä½†æŒç»­å¼€å‘ä¸­ï¼ˆä½† WSL 1 æ”¯æŒä¸²è¡Œç«¯å£å’ŒUSBè®¾å¤‡çš„è®¿é—®ï¼Œæœ‰éœ€è¦å¯ä»¥å…ˆå‡‘åˆç”¨ï¼‰ã€‚ Q6: æœ‰æ²¡æœ‰ç»Ÿä¸€ Windows æ–‡ä»¶å’Œ Linux æ–‡ä»¶æƒé™ç®¡ç†çš„è§£å†³æ–¹æ¡ˆï¼Ÿ A6: åœ¨ WSL 1 ä¸­ï¼Œå› ä¸ºæ˜¯åŒä¸€ä¸»æœºä¸å­˜åœ¨ç³»ç»Ÿè¾¹ç•Œï¼ˆæ˜ å°„ç›¸å¯¹å®¹æ˜“ï¼‰ï¼Œæƒé™ç®¡ç†æ˜¯é€šè¿‡ä¸­é—´å±‚çš„é©±åŠ¨å™¨æä¾›é¢å¤–æœåŠ¡å®ç°çš„ï¼›åœ¨ WSL 2 ä¸­ï¼Œå› ä¸ºæ˜¯ä¸åŒä¸»æœºè€Œå­˜åœ¨ç³»ç»Ÿè¾¹ç•Œï¼ˆæ˜ å°„ç›¸å¯¹å›°éš¾ï¼‰ï¼ŒWSL 2 é‡‡å–çš„ç­–ç•¥æ˜¯ä¿æŒå„è‡ªç³»ç»ŸåŸæœ‰çš„è®¿é—®æƒé™ï¼Œé€šè¿‡è¡¥å……ä¸€äº›ä¸Šå±‚åè®®ï¼ˆæ¯”å¦‚ SSHï¼‰è¿›è¡Œè¾…åŠ©ç®¡ç†ï¼Œæ–°çš„ Release ç‰ˆæœ¬å·²ç»æ”¯æŒ â€œSharing SSH keys between Windows and WSL 2â€œã€‚ Q7: æœ‰æ²¡æœ‰ WSL 2 å¯¹ç½‘ç»œé…ç½®çš„æ”¯æŒï¼Ÿ A7: åœ¨ WSL 1 ä¸­ï¼Œå› ä¸ºæ˜¯åŒä¸€ä¸»æœºï¼Œç½‘ç»œå‡ºå£çš„ IP åœ°å€æ˜¯ç›¸åŒçš„ï¼Œç›¸å…³æ“ä½œä¹Ÿæ¥è¿‘åŸç”Ÿ ï¼›åœ¨ WSL 2 ä¸­ï¼Œå› ä¸ºæ˜¯ä¸åŒä¸»æœºï¼Œç½‘ç»œå‡ºå£çš„ IP åœ°å€æ˜¯ä¸åŒçš„ï¼ŒWSL 2 è®¡åˆ’å®ç°çš„ Feature åŒ…æ‹¬ï¼šâ‘  åœ¨æä¾›ä¸åŒçš„IP åœ°å€æƒ…æ™¯ä¸‹ï¼ŒåŠ é€Ÿç½‘ç»œè®¿é—®ï¼›â‘¡ å°†å®¢æœºæ˜ å°„åˆ°ä¸»æœºï¼Œå…±äº«åŒä¸€ IP åœ°å€ï¼›â‘¢ å°½å¿«æ”¯æŒå…¨éƒ¨ Linux ä¸‹çš„ç½‘ç»œåº”ç”¨ã€‚ æ€»ç»“ ç®€å•çš„ç†è§£ï¼šé€šè¿‡ä½¿ç”¨è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œä½¿å¾— Hypervisor ä¸ŠåŒæ—¶è¿è¡Œ Windows å®ä¾‹å’Œ Linux å®ä¾‹ï¼ŒWindows å®ä¾‹å ä¸»å¯¼åœ°ä½å¹¶ä¸”æŒç»­åœ°è¿è¡Œï¼ŒLinux å®ä¾‹éå¸¸è½»é‡çº§å¹¶ä¸”åªæœ‰åœ¨ç”¨åˆ°æ—¶æ‰ä¼šå¯åŠ¨ã€‚é‡‡ç”¨åŸç”Ÿçš„ Linux Kernel ä¿è¯äº†ç³»ç»Ÿè°ƒç”¨çš„å®Œæ•´æ€§ï¼Œ9P åè®®çš„æ³¨å…¥åˆå¾ˆå¥½åœ°è§£å†³äº†ä¸¤ä¸ªä¸åŒæ–‡ä»¶ç³»ç»Ÿä¹‹é—´çš„äº¤äº’é—®é¢˜ã€‚ å‚è€ƒé“¾æ¥ The new Windows subsystem for Linux architecture: a deep dive About WSL 2 Shipping a Linux Kernel with Windows WSL 2 Frequently Asked Questions","link":"/2019/12/14/WSLä»å…¥é—¨åˆ°...(3)/"},{"title":"#Sucks# å†™åœ¨äºŒé›¶äºŒå£¹","text":"ï¼ˆï¼ˆï¼ˆå‡è£…æœ‰ç®€ä»‹.jpg è¿‡å»çš„ä¸€å¹´å…¶å®è¿˜è›®ç³Ÿç³•çš„ï¼ˆæˆ–è€…è¯´ä¸‹åŠå¹´ï¼Œä½†æ˜¯ä¹Ÿå‘ç”Ÿäº†å¾ˆå¤šç¾å¥½çš„äº‹æƒ…ã€‚å› ä¸ºå¾ˆé•¿ä¸€æ®µæ—¶é—´éƒ½ä¸å†™ä½œäº†ï¼Œæ„Ÿè§‰åˆ°æ—¢é—æ†¾åˆæ°”æ„¤ï¼Œæ‰€ä»¥è¿™ä¸ä¼šæ˜¯ä¸€ç¯‡å¥½éšæ„Ÿï¼Œç´¢æ€§å°±åƒæ¯æ—¥é¢å¯¹çš„å®¢ä½“ä¸€æ ·ï¼Œæ•´é½åˆ’ä¸€åœ°ç†æ¸…æˆ‘çš„æ€ç»ªã€‚ 2020 ç³Ÿç³•çš„äº‹æƒ…ï¼š åšäº†ä¸€äº›æ— ç”¨åŠŸï¼Œå¹¶ä¸”æœ€åä¹Ÿå¤„ç†å¾—ä¸å¥½ å·¥ä½œçš„æ—¶å€™å­¦ä¹ å˜å¾—é›¶ç¢ï¼Œä¼‘æ¯çš„æ—¶å€™ç¼ºä¹å­¦ä¹ çƒ­æƒ… èº«ä½“æ„Ÿè§‰ä¸å¥½ï¼Œä½œæ¯ä¸å¤Ÿè§„å¾‹ï¼ŒèŒä¸šç—…å°‘è¿åŠ¨ï¼Œæ‘„å…¥è¿‡å¤šé…’ç²¾ å¯¹äº‹ç‰©å¼€å§‹å†·æ„Ÿï¼Œä¸é˜…è¯»ä¸å†™ä½œ å·¥ä½œçš„æ—¶å€™å¾ˆè‡ªé—­ï¼Œä¼‘æ¯çš„æ—¶å€™å¾ˆè‚¥å®… æœ€è¿‘æœ‰ç‚¹æœ¬æœ«å€’ç½®ï¼Œå®³æ€•çœ‹åˆ°äº†å°½å¤´ æ„Ÿè§‰è‡ªå·±æœ‰ç‚¹ç—…äº†ï¼Œå¤±å»äº†ç”Ÿå‘½åŠ› 2020 ç¾å¥½çš„äº‹æƒ…ï¼š é‡åˆ°äº†å¾ˆçˆ±æˆ‘ã€æˆ‘å¾ˆçˆ±çš„å¥¹ï¼Œå¹¶ä¸”æˆ‘ä»¬æœ‰ä¸€åªå¯çˆ±çš„å°çŒ«å’ª æ˜¥æ‹›çš„ offer æ”¶å‰²æœºï¼ˆbushiï¼Œå¯¹è‡ªå·±çš„ä¸€ç‚¹ç‚¹çš„è‚¯å®š æ‹¿åˆ°äº†æ»¡æ„çš„ offerï¼Œå¦ˆå®çš„èƒœåˆ©ï¼ˆé€ƒ å¼€å§‹å­¦ä¹ ç†è´¢çŸ¥è¯†ï¼Œä¸€åœºæœ‰è¶£çš„æ¸¸æˆ â€‹æ€»çš„æ¥è¯´ï¼Œæˆ‘è®¨åŒ 2020 åŸåœ°è¸æ­¥ç”šè‡³æ‹¼å‘½å€’é€€çš„è‡ªå·±ï¼Œå¹¶ä¸”è¿™ç§æƒ³æ³•è¿˜ä¼šè¶Šæ¥è¶Šå°‘ï¼Œè‡ªå·±ä¹Ÿä¸æ„¿æ„èµ°å‡ºèˆ’é€‚åœˆã€‚ä¸æ­¤åŒæ—¶ï¼Œæˆ‘æ„Ÿåˆ°çµé­‚ä¸­ï¼Œå·²ç»å°‘äº†è®¸å¤šçº¯ç²¹ï¼Œåè€Œæ·»äº†è®¸å¤šæ¬²æœ›ã€‚2021 å¸Œæœ›è‡ªå·±å¥å¥åº·åº·ã€å¼€å¼€å¿ƒå¿ƒã€‚ 2021 Todo Listï¼š é‡è§†èº«ä½“æƒ…å†µï¼Œæ—©ç¡æ—©èµ·ï¼Œæ™šä¸Šå›æ¥å¯ä»¥åšåšè¿åŠ¨ï¼Œå…»ç”Ÿ åˆä¼‘å‰å’Œç¡è§‰å‰éƒ½å¯ä»¥è¯»è¯»ä¹¦ï¼Œå¤šçœ‹ç”µå½±å¤šå¬æ–°æ­Œï¼ŒåšæŒå†™æ—¥è®° å…»æˆæ¯å¤©å¼€å§‹å·¥ä½œå‰å…³æ³¨æ–°æŠ€æœ¯ï¼Œç»“æŸå·¥ä½œåæ€»ç»“è¿™ä¸€å¤©çš„å¥½ä¹ æƒ¯ å‘¨æœ«è¦å‡ºå»èµ°èµ°ï¼Œè¦å­¦ä¹ çŸ¥è¯† å·¥ä½œæ—¶é—´ä¸è¦åˆ†å¿ƒå…¶å®ƒäº‹æƒ…ï¼Œåšå¥½æ—¶é—´ç®¡ç† å’Œåˆ«äººäº¤å¾€å–„è‰¯å’Œçƒ­æƒ…ï¼Œå¦‚æœéœ€è¦ç»ƒä¹ é‚£ä¹ˆå°±å»ç»ƒä¹ ï¼Œä½†ä¹Ÿè¦æœ‰è‡ªå·±çš„åŸåˆ™ ä¸è¦æ‹–å»¶ï¼Œæƒ³å°±å»åšï¼Œæ¯å¤©è®°å½•è‡ªå·±å¥½çš„å˜åŒ– å¸Œæœ›æ–°çš„ä¸€å¹´é™¤äº†å·¥ä½œä»¥å¤–ï¼Œæœ‰ä¸€äº›æ–°çš„å…³æ³¨ç‚¹ â€‹Hope is a dangerous thing for a woman like me to have. Fake it till you make it.","link":"/2021/01/01/å†™åœ¨äºŒé›¶äºŒå£¹/"},{"title":"#Sucks# å†™åœ¨äºŒé›¶äºŒé›¶","text":"ï¼ˆï¼ˆï¼ˆæ— èŠçš„åæ§½ä¸æ²¡å¤šå°‘æ„æ€çš„å¤è¯» ç”Ÿæ´»å¤§æ¦‚å°±æ˜¯ï¼Œèµ·è½è½è½ã€‚ è¯´æ¥å†™å‰ç«¯ä¹Ÿå¿«ä¸€ä¸ªæœˆï¼Œè™½ç„¶ä»¥åå¤§æ¦‚ç‡ä¹Ÿä¸ä¼šå†ä¸“é—¨å¸®åˆ«äººå†™äº†ï¼Œä½†æ˜¯è¿™ä¸ªè¿‡ç¨‹è¿˜æ˜¯æœ‰ä¸å°‘å¿ƒå¾—ä½“ä¼šï¼Œæ¯”å¦‚ç†è§£éœ€æ±‚ã€è¯»æ‡‚æ¶æ„ã€å®ç°é€»è¾‘ã€ä¿è¯è´¨é‡å’Œé€šè¿‡æµ‹è¯•ä¹‹ç±»çš„ã€‚å› ä¸ºå¼€å‘å¾—æ¯”è¾ƒéšå¿ƒæ‰€æ¬²ï¼Œæ¢å¥è¯è¯´ï¼Œå°±æ˜¯è¿˜æœ‰å¾ˆå¤šæˆé•¿çš„ç©ºé—´ï¼Œéå¸¸æ„Ÿè°¢å®éªŒå®¤çš„å¸ˆå…„å¸ˆå§æ²¡æœ‰å«Œå¼ƒæˆ‘è¿™ä¸ªå°èœğŸ“ï¼Œé»„è€å¸ˆè¿˜å³å°†è¿æ¥äººç”Ÿç¬¬ä¸€æ¡¶é‡‘ (?) è¦è¯´åæ‚”åˆ°å°è±¡æ·±åˆ»çš„äº‹æƒ…ï¼Œé™¤äº†åœ¨GYå’•å’•æ‰äº†ä¿¡æ¯ç«èµ›ï¼Œé€‰å¤§æ•°æ®å¯èƒ½ä¹Ÿæ˜¯ä¹‹ä¸€ã€‚æ— éå°±æ˜¯ä¸ä¼šä¹Ÿä¸é‚£ä¹ˆæ„Ÿå…´è¶£ï¼Œæ¯æ¬¡å…ˆè¢«æ•°æ®å¤„ç†å¥—è·¯ä¸€é˜µï¼Œç„¶åå¯¹ç€æ•°å­¦å…¬å¼å’Œç¥ç»ç½‘ç»œæ•²æ•²æ•²ï¼ŒDebugæ²¡æœ‰æœºå™¨ä¹Ÿè¦æ¥ä¸ªåœ°ä¹…å¤©é•¿ï¼Œè¿˜è¦ç›¯ç€ABæ¦œæ‚£å¾—æ‚£å¤±ï¼Œå®åœ¨æ˜¯æä¸æ¥å•¦ã€‚è™½ç„¶ä½†æ˜¯ï¼Œå­¦ç®—æ³•è¿™åŠå¹´æ¥æœ€å¤§çš„æ”¶è·å°±æ˜¯å­¦ä¼šå¦‚ä½•å¿ƒå¹³æ°”å’Œåœ°æŠŠä¸€ä»¶äº‹æƒ…çœŸæ­£åšå¾—åˆå¿«åˆå¥½ï¼ˆæˆ‘å´è¿˜æ²¡æœ‰ è¿‡å»ä¸€å¹´æäº†ä¸å°‘å‰¯ä¸šï¼ŒçœŸæ­£æœ‰è¥å…»çš„å´ä¸å¤šï¼Œä»C++å†™åˆ°Dartï¼Œä»å…¨æ ˆå†™åˆ°äº‘è®¡ç®—â€¦æ˜ç™½ä¸€ä¸ªäººçš„ç²¾åŠ›å…¶å®å¾ˆæœ‰é™ï¼Œä»€ä¹ˆéƒ½å¹² â‰ˆ ä»€ä¹ˆéƒ½æ²¡å¹²ã€‚å°±ç®—å¼€äº†nä¸ªrepoï¼Œæ··äº†nä¸ªprojectï¼ŒæŒ‚äº†nä¸ªtitleï¼Œåªè¦é¢å¯¹ Talk is cheap, show me the code ä¹Ÿä¼šæ²‰é»˜ã€‚å½“ç„¶å¹¿åº¦ä¼˜å…ˆå­¦ä¹ ä¹Ÿæ²¡ä»€ä¹ˆä¸å¥½ï¼Œåªä¸è¿‡æ˜¯æˆ‘ç®—åŠ›å¤ªå¼±äº†ç½¢ã€‚åˆ°äº†ä¸‰å¹´çº§å°±ä¸å¯é¿å…åœ°æƒ³ä¸œæƒ³è¥¿ï¼Œä¸èƒ½å†åƒä»å‰ä¸€æ ·è¯´å¹²å°±å¹²ï¼Œè¦è€ƒè™‘æ²‰é»˜æˆæœ¬ï¼Œè¦é¢å¯¹åŒä¼´ç„¦è™‘ï¼Œå†³å®šå»å“ªæ¬ç –ä¹Ÿè¦å°å¿ƒç¿¼ç¿¼ï¼Œè¿˜éšæ—¶åœ¨æ•æ·å’ŒæŠ•æœºçš„è¾¹ç¼˜è¯•æ¢ã€‚æœ€åè¯´æœäº†è‡ªå·±è¿˜æ˜¯ä¿æŒåˆ®åˆ®ä¹çš„å¿ƒæ€â€¦ï¼ˆåˆ®åˆ°äº†äº‘è®¡ç®—è¿˜æŒºå¹¸è¿çš„ è¯¯ è™½ç„¶ä»¥ä¸Šéƒ½æ˜¯äº›æ— å…³ç—›ç—’çš„åæ§½ï¼Œç”Ÿæ´»ä¹Ÿè¿˜æœ‰å®ƒçš„å¤æ‚å’Œç¾å¥½ï¼Œè¯¸å¦‚å’Œå¾ˆé•¿ä¸€æ®µæ—¶é—´è¢«gaslightçš„è‡ªå·±å’Œè§£å•¦ã€ç¬¬ä¸€æ¬¡å½“PMå•¦ã€å»M$RAè¹­åƒè¹­å–å•¦ã€å†è§å¥½Xå‹å‘å±•é©å‘½æƒ…è°Šå•¦ã€æ— ç–¾è€Œç»ˆåœ°æš—æ‹è¿‡å•¦äº‘äº‘ï¼Œè¿™ç§æ—¶å€™è¿˜æ˜¯è¦æ„Ÿæ…¨å¹´è½»çœŸå¥½æ»´å˜»å˜» :P ä»¥å‰è§‰å¾—ç”Ÿæ´»æœ¬è´¨å°±æ˜¯å’Œè¥¿è¥¿å¼—æ–¯ç¥è¯ä¸€æ ·çš„ï¼Œç›¸å½“è™šæ— ã€‚ç°åœ¨ä¹Ÿè¿˜æ˜¯è¿™ä¹ˆè§‰å¾—ï¼Œä¸è¿‡ç›´è§‰ä¸Šæœ‰è¶£çš„äº‹æƒ…é‚£ä¹ˆå¤šï¼Œæ¯å¤©ä¸€ç‚¹ç‚¹ä¹Ÿè¶³å¤Ÿå¿«ä¹ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæ–°å¹´ä¹‹äº¤è®²çš„ä¸œè¥¿éƒ½ä¸èƒ½ä¿¡ï¼Œå°±ä¸ç»§ç»­ä¸€æœ¬æ­£ç»èƒ¡è¯´å…«é“äº†ï¼Œæœ€åä»¥å°æ³¢ä½œç»“å§ï¼š â€œé‚£ä¸€å¤©æˆ‘äºŒåä¸€å²ï¼Œåœ¨æˆ‘ä¸€ç”Ÿçš„é»„é‡‘æ—¶ä»£ã€‚æˆ‘æœ‰å¥½å¤šå¥¢æœ›ã€‚æˆ‘æƒ³çˆ±ï¼Œæƒ³åƒï¼Œè¿˜æƒ³å†ä¸€ç¬é—´å˜æˆå¤©ä¸ŠåŠæ˜åŠæš—çš„äº‘ã€‚åæ¥æˆ‘æ‰çŸ¥é“ï¼Œç”Ÿæ´»å°±æ˜¯ä¸ªç¼“æ…¢å—é”¤çš„è¿‡ç¨‹ï¼Œäººä¸€å¤©å¤©è€ä¸‹å»ï¼Œå¥¢æœ›ä¹Ÿä¸€å¤©å¤©æ¶ˆå¤±ï¼Œæœ€åå˜å¾—åƒæŒ¨äº†é”¤çš„ç‰›ä¸€æ ·ã€‚å¯æ˜¯æˆ‘è¿‡äºŒåä¸€å²ç”Ÿæ—¥æ—¶æ²¡æœ‰é¢„è§åˆ°è¿™ä¸€ç‚¹ã€‚æˆ‘è§‰å¾—è‡ªå·±ä¼šæ°¸è¿œç”ŸçŒ›ä¸‹å»ï¼Œä»€ä¹ˆä¹Ÿé”¤ä¸äº†æˆ‘ã€‚â€","link":"/2020/01/01/å†™åœ¨äºŒé›¶äºŒé›¶/"},{"title":"#Linux&Shell# é€ŸæŸ¥æ‰‹å†Œï¼šå¸¸ç”¨ Linux&Shell å‘½ä»¤","text":"è¦†ç›–åœ¨å­¦ä¹ å’Œå·¥ä½œä¸­çš„å¸¸ç”¨ Linux å‘½ä»¤ï¼šç®¡ç† / è¿æ¥ / ç½‘ç»œ / è¿›ç¨‹ / æ–‡ä»¶ / æ–‡æœ¬ ç›®å½• Table of Contents ç®¡ç†åˆ—ä¸¾123456# Ubuntuapt list --installed# CentOSyum list installed# Alpineapk info æ›´æ–°12345678# Ubuntuapt-get updateapt-get -y upgrade# CentOSyum update# Alpineapk updateapk upgrade å®‰è£…123456# Ubuntuapt-get install -y ${package}# CentOSyum install -y ${package}# Alpineapk add --upgrade ${package} å¸è½½123456# Ubuntuapt-get --purge remove ${package}# CentOSyum remove ${package}# Alpineapk del ${package} è¿æ¥ssh12ssh -p ${port} ${username}@${host}sshpass -p ${password} ssh -p ${port} ${username}@${host} telnet1telnet ${host} ${port} ping1ping ${host} nslookup1nslookup ${domain} curl12345curl \\-X ${method} \\-H \"${header_key}: ${\"header_val\"}\" \\-d \"${json_data}\" \\${api_url} \\ mysql1mysql -h ${host} -P ${port} -u ${username} -p ç½‘ç»œæŸ¥çœ‹ ip1ip a |grep eth æŸ¥çœ‹ dns1cat /etc/resolv.conf |grep nameserver è¿›ç¨‹æŸ¥è¯¢ proc1ps -ef |grep ${proc_name} æŸ¥è¯¢ port1lsof -i:${port} ä» proc æŸ¥ port / ä» port æŸ¥ proc12netstat -tunlp |grep ${proc_name}netstat -tunlp |grep ${port} æ€æ­»è¿›ç¨‹12345678ps -ef | grep ${including_keyword} | grep -v ${excluding_keyword}kill -s 9 ${pid}ps -ef | grep ${including_keyword} | grep -v ${excluding_keyword} | awk '{print $2}' | xargs kill -s 9kill -s 9 `pgrep ${keyword}`pkill -9 ${keyword} æ–‡ä»¶ä»æœåŠ¡å™¨ä¸‹è½½åˆ°æœ¬æœº12scp -r -P ${port} ${username}@${host}:/path/to/remote /path/to/local # åŒ…æ‹¬æ–‡ä»¶rsync -a -e ssh --exclude=\"${pattern}\" ${username}@${host}:/path/to/remote /path/to/local # æ’é™¤æ–‡ä»¶ ä»æœ¬æœºä¸Šä¼ åˆ°æœåŠ¡å™¨12scp -r /path/to/local -P ${port} ${username}@${host}:/path/to/remote # åŒ…æ‹¬æ–‡ä»¶rsync -a -e ssh --exclude=\"${pattern}\" /path/to/local ${username}@${host}:/path/to/remote # æ’é™¤æ–‡ä»¶ è§£å‹zip 1unzip -d /path/to/unzip ${pkg_to_unzip} tar 123tar -xvf ${pkg_to_untar} # è§£å‹ tar åŒ…tar -zxvf ${pkg_to_untar} # è§£å‹ tar.gz åŒ…tar -jxvf ${pkg_to_untar} # è§£å‹ tar.bz2 åŒ… åŠ å‹zip 123zip -r /path/to/unzip ${pkg_to_zip}zip -d /path/to/zip ${file_to_delete} # ä»å‹ç¼©åŒ…ä¸­åˆ é™¤æ–‡ä»¶zip -m /path/to/zip ${file_to_append} # å‘å‹ç¼©åŒ…ä¸­æ·»åŠ æ–‡ä»¶ tar 123tar -cvf ${pkg_to_tar} # åŠ å‹ tar åŒ…tar -zcvf ${pkg_to_tar} # åŠ å‹ tar.gz åŒ…tar -zjvf ${pkg_to_tar} # åŠ å‹ tar.bz2 åŒ… æ–‡æœ¬æŸ¥çœ‹json 1cat ${file} | python -m json.tool log 1234less ${log_file}vim ${log_file}tail -n ${number} ${log_file}tail -f ${log_file} ç¼–è¾‘å¤åˆ¶ 1ctrl + Insert ç²˜è´´ 1shift + Insert ç§»åŠ¨ 1234gg # é¦–è¡ŒG # æœ«è¡Œshift + ^ # è¡Œé¦–shift + $ # è¡Œæœ« æœç´¢ 1234/pattern # å‘å‰æœç´¢ï¼Ÿpattern # å‘åæœç´¢n # ä¸Šä¸€ä¸ªN # ä¸‹ä¸€ä¸ª æŸ¥çœ‹ç¼©è¿›å’Œè¡Œå°¾ 1: set list å¤„ç†åˆ†éš” 1awk -F:\"${seperator}\" '/${pattern}/${command}' ${file} æ›¿æ¢ 1sed \"s/${pattern}/${substr}/g\"","link":"/2020/05/14/é€ŸæŸ¥æ‰‹å†Œä¹‹å¸¸ç”¨Linux&Shellå‘½ä»¤/"},{"title":"#Golang# Golangä¸å¹¶å‘ç¼–ç¨‹(3) goroutineæ³„æ¼","text":"ä»‹ç» goroutine æ³„æ¼çš„ç›¸å…³å†…å®¹ï¼Œä¸»è¦è®¨è®ºä»¥ä¸‹ä¸‰ä¸ªéƒ¨åˆ†ï¼š goroutine æ³„æ¼åˆ¤æ–­ goroutine æ³„æ¼åˆ†ç±» goroutine æ³„æ¼é¢„é˜² ç›®å½• Table of Contents å‰æƒ…æè¦ goroutine æ³„æ¼æŒ‡çš„æ˜¯å› ä¸ºç¼–ç ä¸­çš„é™·é˜±ä½¿å¾— goroutine æ— æ³•æ­£å¸¸é‡Šæ”¾è€Œé€ æˆçš„å†…å­˜æ³„æ¼ï¼Œç”šè‡³å¯¼è‡´å†…å­˜æº¢å‡ºæˆ–æœ€ç»ˆç¨‹åºå´©æºƒã€‚ æœ¬æ–‡å°†è®¨è®º goroutineæ³„æ¼çš„åˆ¤æ–­ã€åˆ†ç±»å’Œé¢„é˜²ï¼Œå¦‚æœ‰é”™æ¼ï¼Œæ¬¢è¿æŒ‡å‡º ;P goroutineæ³„æ¼åˆ¤æ–­runtime.NumGoroutine runtime.NumGoroutine å¯ä»¥è¿”å›æ­£åœ¨è¿è¡Œä¸­çš„ goroutine æ•°é‡ï¼ˆåŒ…æ‹¬ main goroutine å’Œ normal goroutineï¼‰ã€‚ 12345678910import( \"fmt\" \"runtime\")// ...fmt.Println(runtime.NumGoroutine())// ... runtime/pprof runtime/pprof å¯ä»¥ï¼ˆä»¥å†™å…¥çš„å½¢å¼ï¼‰è¿”å› goroutine çš„è¿è¡Œæ•°é‡å’Œå †æ ˆä¿¡æ¯ã€‚ 12345678910import ( \"os\" \"runtime/pprof\" )// ...pprof.Lookup(\"goroutine\").WriteTo(os.Stdout, 1)// ... http/net/pprof http/net/pprof å¯ä»¥ï¼ˆä»¥è®¿é—®çš„å½¢å¼ï¼‰è¿”å› goroutine çš„è¿è¡Œæ•°é‡ã€å †æ ˆä¿¡æ¯å’Œå…¶å®ƒèµ„æºä¿¡æ¯ã€‚ 123456789101112import ( \"net/http\" _ \"net/http/pprof\" )// ...http.ListenAndServe(\"localhost:6060\", nil)// ...// è¿›å…¥ http://localhost:6060/debug/pprof/goroutine?debug=1 æŸ¥çœ‹ gops gops æ”¯æŒåˆ—å‡ºå½“å‰ç¯å¢ƒä¸‹çš„è¿›ç¨‹ä¿¡æ¯ã€‚ åœ¨ .go ä¸­ï¼š 123456789101112import ( \"log\" \"github.com/google/gops/agent\")// ...if err := agent.Start(); err != nil { log.Fatalln(err)}// ... åœ¨ terminal ä¸­ï¼š 12345$ gops # æŸ¥çœ‹è¿›ç¨‹ä¿¡æ¯$ gops stats PID # æŸ¥çœ‹çŠ¶æ€ä¿¡æ¯$ gops stack PID # æŸ¥çœ‹å †æ ˆä¿¡æ¯ leaktest leaktest å°†æ³„æ¼æ£€æµ‹è¿‡ç¨‹åŠ å…¥åˆ°è‡ªåŠ¨åŒ–æµ‹è¯•ä¸­å»ã€‚ 1234567891011import ( \"github.com/fortytw2/leaktest\")// ...defer leaktest.Check(t)defer leaktest.CheckTimeout(t, time.Second)defer leaktest.CheckContext(ctx, t)// ... goroutine æ³„æ¼åˆ†ç±»æ— é€€å‡ºçš„è®¡ç®—å¾ªç¯ å¯¹äºæ²¡æœ‰å‡½æ•°è°ƒç”¨ï¼Œçº¯å¾ªç¯è®¡ç®—çš„ Gï¼Œruntime æ— æ³•å®è¡ŒæŠ¢å ï¼› æ˜¾ç„¶ï¼Œå¦‚æœæ²¡æœ‰é€€å‡ºæœºåˆ¶ä¸”ç¨‹åºå¸¸é©»çš„è¯ï¼Œæ¯æ¬¡å¯åŠ¨çš„ goroutine éƒ½å¾—ä¸åˆ°é‡Šæ”¾ï¼Œå°±ä¼šå‘ç”Ÿ goroutine æ³„æ¼ã€‚ 12345678910111213141516171819202122package mainimport ( \"fmt\" \"runtime\" \"time\")func test() { for { fmt.Println(\"Testing...\") // æ­»å¾ªç¯æ— æ³•æŠ¢å å’Œå›æ”¶ }}func main() { defer func() { time.Sleep(time.Second) fmt.Println(\"NumGoroutine:\", runtime.NumGoroutine()) // è¾“å‡ºä¸º 2 ï¼Œå‘ç”Ÿæ³„æ¼ }() go test()} ä¸ç»“æŸçš„I/Oè¯·æ±‚ å¯¹äº I/O è¯·æ±‚ï¼Œruntime æ— æ³•å®è¡ŒæŠ¢å ï¼› å¦‚æœ I/O è¯·æ±‚ä¸€ç›´å¤„äºç­‰å¾…æœŸé—´ï¼Œè¯¥ goroutine åˆ™æ— æ³•é‡Šæ”¾ï¼Œå‡ºç°æ³„æ¼ã€‚ 1234567891011121314151617181920212223242526package mainimport ( \"bufio\" \"fmt\" \"os\" \"runtime\" \"time\")func test() { input := bufio.NewScanner(os.Stdin) if input.Scan() { text := input.Text() // I/Oè¯·æ±‚æ— æ³•æŠ¢å å’Œå›æ”¶ fmt.Println(text) }}func main() { defer func() { time.Sleep(time.Second) fmt.Println(\"NumGoroutine:\", runtime.NumGoroutine()) // è¾“å‡ºä¸º 2 ï¼Œå‘ç”Ÿæ³„æ¼ }() go test()} channel å¼•èµ·çš„æ³„æ¼åªå‘é€ä¸æ¥æ”¶ ä¸Šæ¸¸ç”Ÿäº§é€Ÿåº¦è¿œè¿œå¤§äºä¸‹æ¸¸æ¶ˆè´¹é€Ÿåº¦ï¼Œé˜»å¡çš„ goroutine ä¼šä¸€ç›´åœ¨ channel çš„å‘é€ç­‰å¾…é˜Ÿåˆ—ã€‚ æ— ç¼“å†² channel æ²¡æœ‰æ¥æ”¶å°±ä¼šé˜»å¡ï¼Œæœ‰ç¼“å†² channel ç¼“å†²æ»¡äº†å°±ä¼šé˜»å¡ã€‚ 123456789101112131415161718192021222324252627282930package mainimport ( \"fmt\" \"math/rand\" \"runtime\" \"time\")func query() int { n := rand.Intn(100) return n}func queryAll() int { ch := make(chan int) go func() { ch &lt;- query() }() go func() { ch &lt;- query() }() go func() { ch &lt;- query() }() return &lt;-ch}func main() { defer func() { time.Sleep(time.Second) fmt.Println(\"NumGoroutine:\", runtime.NumGoroutine()) // è¾“å‡ºä¸º 3 ï¼Œå‘ç”Ÿæ³„æ¼ }() queryAll()} åªæ¥æ”¶ä¸å‘é€ ä¸‹æ¸¸æ¶ˆè´¹é€Ÿåº¦è¿œè¿œå¤§äºä¸Šæ¸¸ç”Ÿäº§é€Ÿåº¦ï¼Œé˜»å¡çš„ goroutine ä¼šä¸€ç›´åœ¨ channel çš„æ¥æ”¶ç­‰å¾…é˜Ÿåˆ—ã€‚ æ— ç¼“å†² channel ä»ç„¶æ¥æ”¶å°±ä¼šé˜»å¡ï¼Œæœ‰ç¼“å†² channel ç¼“å†²ç©ºäº†å°±ä¼šé˜»å¡ã€‚ 12345678910111213141516171819package mainimport ( \"fmt\" \"runtime\" \"time\")func main() { defer func() { time.Sleep(time.Second) fmt.Println(\"NumGoroutine:\", runtime.NumGoroutine()) // è¾“å‡ºä¸º 2 ï¼Œå‘ç”Ÿæ³„æ¼ }() ch := make(chan bool) go func() { ch &lt;- true }()} ç©º channel å‘ nil channel å‘é€å’Œæ¥æ”¶æ•°æ®éƒ½ä¼šå¯¼è‡´é˜»å¡ï¼Œåªè¿›è¡Œå£°æ˜è€Œä¸åˆå§‹åŒ– channel å®¹æ˜“å‡ºç°è¯¥ç±»æ³„æ¼ã€‚ 12345678910111213141516171819202122package mainimport ( \"fmt\" \"runtime\" \"time\")func test() { var ch chan bool &lt;-ch // ch &lt;- data}func main() { defer func() { time.Sleep(time.Second) fmt.Println(\"NumGoroutine:\", runtime.NumGoroutine()) // è¾“å‡ºä¸º 2 ï¼Œå‘ç”Ÿæ³„æ¼ }() go test()} ç©º select select{} æ°¸è¿œæ— æ³•å“åº”å¯¼è‡´åç¨‹é˜»å¡ï¼Œä¸€èˆ¬ä¸ä¼šå‡ºç°è¿™ç§æƒ…å†µã€‚ 1234567891011121314151617181920package mainimport ( \"fmt\" \"runtime\" \"time\")func test() { select {}}func main() { defer func() { time.Sleep(time.Second) fmt.Println(\"NumGoroutine:\", runtime.NumGoroutine()) // è¾“å‡ºä¸º 2 ï¼Œå‘ç”Ÿæ³„æ¼ }() go test()} sync å¼•èµ·çš„æ³„æ¼Mutex å¿˜è®°è§£é” æœ‰ä¸€ä¸ª goroutine åŠ é”å¿˜äº†è§£é”ï¼Œå¦ä¸€ä¸ª goroutine ç«äº‰é”ä¼šå¤±è´¥ï¼Œç”±æ­¤è¿™ä¸ª goroutine å°†ä¸€ç›´åœ°é˜»å¡ã€‚ 1234567891011121314151617181920212223242526272829package mainimport ( \"fmt\" \"runtime\" \"sync\" \"time\")func test() { var mutex sync.Mutex for i := 1; i &lt;= 2; i++ { go func() { mutex.Lock() fmt.Println(\"goroutine index:\", i) }() }}func main() { defer func() { time.Sleep(time.Second) fmt.Println(\"NumGoroutine:\", runtime.NumGoroutine()) // è¾“å‡ºä¸º 2 ï¼Œå‘ç”Ÿæ³„æ¼ }() go test()} WaitGroup è®¡æ•°é”™è¯¯ WaiteGroup çš„ Add å’Œ Done æ•°é‡ä¸å¯¹åº”å°†å¼•èµ· Wait çš„ç­‰å¾…é€€å‡ºæ¡ä»¶æ°¸è¿œæ— æ³•æ»¡è¶³ï¼Œä»è€Œé˜»å¡åç¨‹ã€‚ 1234567891011121314151617181920212223242526272829package mainimport ( \"fmt\" \"runtime\" \"sync\" \"time\")func test() { var wg sync.WaitGroup wg.Add(2) go func() { wg.Done() }() wg.Wait()}func main() { defer func() { time.Sleep(time.Second) fmt.Println(\"NumGoroutine:\", runtime.NumGoroutine()) // è¾“å‡ºä¸º 2 ï¼Œå‘ç”Ÿæ³„æ¼ }() go test()} Cond æ²¡å‘ä¿¡å· Wait æ–¹æ³•é˜»å¡ç­‰å¾…æ¡ä»¶å˜é‡æ»¡è¶³æ¡ä»¶ï¼Œå¦‚æœæ²¡æœ‰ Signal æˆ–è€… Broadcastï¼ŒWait å°†ä¼šä¸€ç›´ä¸èƒ½å”¤é†’ã€‚ 12345678910111213141516171819202122232425262728293031323334353637package mainimport ( \"fmt\" \"runtime\" \"sync\" \"time\")func test() { cond := sync.NewCond(&amp;sync.Mutex{}) condition := false go func() { cond.L.Lock() condition = true cond.L.Unlock() }() cond.L.Lock() for !condition { cond.Wait() } cond.L.Unlock()}func main() { defer func() { time.Sleep(time.Second) fmt.Println(\"NumGoroutine:\", runtime.NumGoroutine()) // è¾“å‡ºä¸º 2 ï¼Œå‘ç”Ÿæ³„æ¼ }() go test()} goroutineæ³„æ¼é¢„é˜² å¯¹äºè®¡ç®—å¾ªç¯å’Œ I/O è¯·æ±‚ï¼šæ£€æŸ¥ä»£ç ã€‚ ç¡®ä¿æ¯ä¸ªè®¡ç®—å¾ªç¯éƒ½ä¼šé€€å‡ºï¼› ç¡®ä¿æ¯ä¸ª I/O è¯·æ±‚éƒ½ä¼šå…³é—­ã€‚ å¯¹äº channel å¼•èµ·çš„æ³„æ¼ï¼šæœ¬è´¨ä¸Šæ˜¯é˜²æ­¢ channel é˜»å¡ã€‚ ä½¿ç”¨æœ‰ç¼“å†²çš„ channel ï¼› ç”¨ make æ¥å£°æ˜å¹¶åˆå§‹åŒ– channelï¼› é¿å…ç©ºçš„ selectï¼› ä¼˜é›…åœ°å…³é—­ channel ç­‰ã€‚ å¯¹äº sync å¼•èµ·çš„æ³„æ¼ï¼šæœ¬è´¨ä¸Šæ˜¯é˜²æ­¢ sync é˜»å¡ã€‚ å¯¹äºäº’æ–¥é”ï¼ŒåŠ é”è§£é”åº”è¯¥æˆå¯¹åœ°å‡ºç°ï¼Œè¿™æ—¶å€™å¯ä»¥åˆ©ç”¨ deferï¼š 12345// ...mutex.Lock()// ...defer mutex.Unlock()// ... å¯¹äºä¿¡å·é‡ï¼ŒAdd(1) å’Œ Done() æ­é…ä½¿ç”¨ï¼Œè€Œä¸æ˜¯ä¸€å¼€å§‹å°±è§„å®šå¥½ä»»åŠ¡è®¡æ•°ï¼š 123456// ...wg.Add(1)go func() { wg.Done() // ...}() å¯¹äºæ¡ä»¶å˜é‡ï¼Œæ¡ä»¶æ”¹å˜ååº”å‘é€ä¿¡å·ï¼Œå•æ’­è¿˜æ˜¯å¤šæ’­æ ¹æ®å…·ä½“æƒ…å†µè€Œå®šï¼š 1234// ...condition = truecond.Signal() // or cond.Broadcast()// ... å‚è€ƒé“¾æ¥ Goè¯­è¨€åœ£ç» å¦‚ä½•é˜²æ­¢ goroutine æ³„éœ²ï¼ˆä¸€ï¼‰ å¦‚ä½•é˜²æ­¢ goroutine æ³„éœ²ï¼ˆäºŒï¼‰ Goroutine æ³„éœ²","link":"/2020/03/05/Golangä¸å¹¶å‘ç¼–ç¨‹(3)/"},{"title":"#Fiddler# HTTPçš„é€šä¿¡ç›‘æ§å’Œå›æ”¾ï¼šFiddleræŠ“åŒ…ä¸Socketå‘åŒ…","text":"åˆ©ç”¨FiddleræŠ“åŒ…å’ŒSocketå‘åŒ…ï¼Œå¹¶ç”¨Curlè„šæœ¬ç»Ÿè®¡å“åº”æ—¶é—´ï¼Œä¸»è¦åˆ†ä¸ºä»¥ä¸‹å››ä¸ªéƒ¨åˆ†ï¼š å·¥å…·çš„é…ç½®åŠå·¥å…·çš„ä½¿ç”¨ æˆªè·ã€ä¿®æ”¹ã€å‘é€æ•°æ®åŒ… ç»Ÿè®¡ç½‘é¡µå’Œå…ƒç´ çš„å“åº”æ—¶é—´ éœ€æ³¨æ„äº‹é¡¹åŠå¾…æ”¹è¿›äº‹é¡¹ ä»»åŠ¡ éƒ¨ç½²ç±»ä¼¼Microsoft PetshopWebåº”ç”¨åŸºæœ¬å®ä¾‹ï¼Œå¼€å‘æ€§èƒ½æµ‹è¯•å°å·¥å…·èƒ½æˆªè·åŸºäºIEæµè§ˆå™¨ä¸WebæœåŠ¡å™¨çš„äº¤äº’çš„æ•°æ®åŒ…ï¼Œä¿®æ”¹æ•°æ®åŒ…ï¼ˆæ¯”å¦‚ç®€åŒ–èµ·è§ï¼Œä¿®æ”¹è¦æœç´¢çš„å…³é”®å­—ï¼‰ï¼Œå†æŠŠä¿®æ”¹åçš„å†…å®¹ä½¿ç”¨å¤šçº¿ç¨‹çš„æ–¹å¼å‘é€åˆ°æœåŠ¡å™¨ã€‚ç»Ÿè®¡è¯·æ±‚æ¯ä¸ªç½‘é¡µä¸Šä¸»è¦å…ƒç´ ï¼ˆgif,cssç­‰ï¼‰éœ€è¦çš„æ—¶é—´ï¼Œä»¥åŠè¯·æ±‚æ•´ä¸ªç½‘é¡µçš„æ—¶é—´ã€‚ æç¤ºï¼š åœ¨è·å–æ•°æ®åŒ…çš„è¿‡ç¨‹ä¸­è¦æ ¹æ®HTTPè¯·æ±‚çš„ç‰¹ç‚¹ï¼Œä»åŸå§‹çš„æ•°æ®åŒ…ä¸­è¿‡æ»¤å‡ºHTTPçš„æ•°æ®åŒ…ã€‚æ‰¾åˆ°æäº¤çš„â€œæœç´¢çš„å…³é”®å­—â€ï¼Œå°†å…¶æ›¿æ¢æˆå…¶å®ƒå­—ç¬¦ã€‚ å‘é€æ•°æ®åŒ…ä½¿ç”¨Socketï¼Œå¯ä»¥å‚è€ƒç½‘ç»œç¼–ç¨‹çš„èµ„æ–™ã€‚ æ–¹æ³• æˆªè·æ•°æ®åŒ… ä¿®æ”¹æ•°æ®åŒ… å‘é€æ•°æ®åŒ… è®°å“åº”æ—¶é—´ æ‰‹æ®µ ç”¨Fiddleræˆªè· ç”¨Pythonä¿®æ”¹ ç”¨Socketå‘é€ ç”¨FiddleræŸ¥çœ‹ éªŒè¯ å¯ç”¨æ€§ æ˜“ç”¨æ€§ å¹¶å‘æ€§ å·¥å…·çš„é…ç½®å®‰è£…å·¥å…·Fiddlerä¸‹è½½åœ°å€ å¯¼å…¥è¯ä¹¦ å‹¾é€‰è§£ç  è¿‡æ»¤ä¿å­˜æ‰‹åŠ¨ è„šæœ¬ 1234567891011121314151617if (oSession.fullUrl.Contains(\"baidu.com\")) { // for(var key in oSession.oRequest.headers) { // if('Referer' === key) { if(oSession.oRequest.headers['Referer'].indexOf(\"&amp;wd=\") != -1) { var fso; var file; fso = new ActiveXObject(\"Scripting.FileSystemObject\"); file = fso.OpenTextFile(\"E:\\\\MyPrograms\\\\fiddler_sessions\\\\Session\" + new Date().getTime() + \".txt\", 8 ,true, true); // file.writeLine(\"Request url: \" + oSession.url); file.writeLine(\"Request header:\" + \"\\n\" + oSession.oRequest.headers); // file.writeLine(\"Request body: \" + oSession.GetRequestBodyAsString()); file.writeLine(\"\\n\"); file.close(); } // } // }} è®¾ç½®æ–­ç‚¹æ‰‹åŠ¨ å‘½ä»¤ åœ¨å·¦ä¸‹è§’é»‘æ¡†æ¡†ä¸­è¾“å…¥å‘½ä»¤ åœæ­¢æ–­ç‚¹ï¼šbpu å¼€å§‹æ–­ç‚¹ï¼šbpu $host å·¥å…·çš„ä½¿ç”¨Statistics Filters Inspectors Composer AutoResponder æˆªè·æ•°æ®åŒ…å›¾å½¢ç•Œé¢ ä½¿ç”¨å›¾å½¢ç•Œé¢æˆ–ç¼–ç¨‹è„šæœ¬åº”ç”¨è¿‡æ»¤ ç‚¹å‡»å·¦ä¸‹è§’ Capturingæˆ–ç©ºç™½å¤„ åœæ­¢æˆ–å¼€å§‹æˆªè·æ•°æ®åŒ… ä½¿ç”¨StatisticsæŸ¥çœ‹æ—¶é—´ï¼Œä½¿ç”¨InspectorsæŸ¥çœ‹å†…å®¹ ä½¿ç”¨å›¾å½¢ç•Œé¢æˆ–ç¼–ç¨‹è„šæœ¬ä¿å­˜ä¼šè¯ ä¿®æ”¹æ•°æ®åŒ…ç¨‹åºè„šæœ¬å¯¹äºæ‰‹åŠ¨ä¿å­˜çš„ä¼šè¯ 123456789101112131415161718192021222324252627282930# æ›¿æ¢è¯·æ±‚ä¸­çš„æœç´¢å­—æ®µdef get_ref(file, cont): with open(file, encoding='utf-8') as f: lines = f.readlines() for line in lines: if 'Referer' in line: start = line.find(\"&amp;wd=\") end = line.find(\"&amp;rsv_pq=\") old_str = line[start+4:end] new_str = parse.quote(cont) line = line.replace(old_str, new_str) return line# é‡æ–°æ‹¼è£…éœ€å‘é€çš„æŠ¥æ–‡def get_req(file, cont): msg = '' with open(file, encoding='utf-8') as f: lines = f.readlines() for line in lines: if 'GET' in line: line = 'GET ' + get_ref(file, cont)[9:-1] + ' HTTP/1.1' if 'Referer' in line: line = get_ref(file, cont) if 'Accept-Encoding' in line: continue line = line.strip('\\n') + '\\r\\n' msg += line msg = bytes(msg, encoding=\"utf8\") return msg å¯¹äºè‡ªåŠ¨ä¿å­˜çš„ä¼šè¯ 1234567891011121314151617181920212223242526272829303132# æ›¿æ¢è¯·æ±‚ä¸­çš„æœç´¢å­—æ®µdef get_ref(file, cont): with open(file, encoding='utf-16') as f: lines = f.readlines() for line in lines: if 'Referer' in line: start = line.find(\"&amp;wd=\") end = line.find(\"&amp;rsv_pq=\") old_str = line[start+4:end] new_str = parse.quote(cont) line = line.replace(old_str, new_str) return line# é‡æ–°æ‹¼è£…éœ€å‘é€çš„æŠ¥æ–‡def get_req(file, cont): msg = '' with open(file, encoding='utf-16') as f: lines = f.readlines() for line in lines: if 'Request header:' in line: continue if 'GET' in line: line = 'GET ' + get_ref(file, cont)[9:-1] + ' HTTP/1.1' if 'Referer' in line: line = get_ref(file, cont) if 'Accept-Encoding' in line: continue line = line.strip('\\n') + '\\r\\n' msg += line msg = bytes(msg[:-4], encoding=\"utf8\") return msg å‘é€æ•°æ®åŒ…Fiddlerä½¿ç”¨WebForms ä½¿ç”¨å›¾å½¢ç•Œé¢æˆ–ç¼–ç¨‹è„šæœ¬åº”ç”¨è¿‡æ»¤ ä½¿ç”¨å›¾å½¢ç•Œé¢æˆ–è¿è¡Œå‘½ä»¤è®¾ç½®æ–­ç‚¹ åœ¨ å¯¹åº”æŠ¥æ–‡A çš„ Request WebFormså†…ä¿®æ”¹â€œæœç´¢å…³é”®å­—â€ ç‚¹å‡» Break on Response å°†ä¿®æ”¹åçš„ å¯¹åº”æŠ¥æ–‡A å‘é€åˆ°Fiddler åœ¨ å¯¹åº”æŠ¥æ–‡B çš„ Request WebFormså†…æŸ¥çœ‹â€œæœç´¢å…³é”®å­—â€ ç‚¹å‡» Run to Completion å°†ä¿®æ”¹åçš„ å¯¹åº”æŠ¥æ–‡B å‘é€åˆ°Server ä½¿ç”¨Composer ä¿å­˜ä¼šè¯Requestè¯·æ±‚å¤´éƒ¨ åœ¨è®°äº‹æœ¬å†…ä¿®æ”¹â€œæœç´¢å…³é”®å­—â€ åœ¨Composerå†…å‘é€è¯·æ±‚æŠ¥æ–‡ Socket 123456789101112131415161718192021222324252627282930if __name__ == '__main__': # è¯»å–ä¿¡æ¯ file = input(\"file:\") cont = input(\"cont:\") # å¥—æ¥å­—è¿æ¥æœåŠ¡ç«¯ s = ssl.wrap_socket(socket.socket()) s.connect(('www.baidu.com', 443)) # å‘é€ä¿®æ”¹åçš„è¯·æ±‚ s.send(get_req(file, cont)) # ç¼“å­˜æœåŠ¡ç«¯çš„å“åº” buffer = [] while True: d = s.recv(1024) if d: buffer.append(d) else: break res = b''.join(buffer) # å®¢æˆ·ç«¯å…³é—­å¥—æ¥å­— s.close() # ä¿å­˜å“åº” header, html = res.split(b'\\r\\n\\r\\n', 1) print(header.decode('utf-8')) with open(cont + '.html', 'wb') as f: f.write(html) è®°å“åº”æ—¶é—´FiddlerPyCurlUrllibRequestå®ä¾‹çš„æ¼”ç¤º [ä»…ä½¿ç”¨FiddleræŠ“åŒ…ã€ä¿®æ”¹ã€å‘åŒ…](å½•å±é“¾æ¥To be continueâ€¦) [FiddleræŠ“åŒ…+Pythonä¿®æ”¹+Socketå‘åŒ…](å½•å±é“¾æ¥To be continueâ€¦) éœ€æ³¨æ„äº‹é¡¹æŠ¥æ–‡æ ¼å¼ æ— è®ºä½¿æ‰‹åŠ¨è¿˜æ˜¯è„šæœ¬ä¿å­˜ä¼šè¯çš„è¯·æ±‚æŠ¥æ–‡ï¼Œéƒ½éœ€è¦æ³¨æ„æ¯ä¸ªå±æ€§æ˜¯å¦ä»¥ \\r\\n ç»“å°¾ï¼Œæœ€åå±æ€§æ˜¯å¦ä»¥ \\r\\n\\r\\n ç»“å°¾ é‡åˆ° HTTP 400 Bad Request å“åº”ä»”ç»†æ£€æŸ¥æŠ¥æ–‡æ ¼å¼æ˜¯å¦æ­£ç¡® ç¼–ç é—®é¢˜ æ³¨æ„ä¿å­˜ä¼šè¯çš„ç¼–ç æ ¼å¼ï¼Œæ‰‹åŠ¨ä¿å­˜ä½¿ç”¨ç¼–ç æ ¼å¼ utf-8 ï¼Œè„šæœ¬ä¿å­˜ä½¿ç”¨ç¼–ç æ ¼å¼ utf-16 Socketå‘é€æŠ¥æ–‡å’Œæ¥å—æŠ¥æ–‡éƒ½éœ€è¦äºŒè¿›åˆ¶æ•°æ® Fiddleré»˜è®¤ä½¿ç”¨GZipæ ¼å¼å‹ç¼©ï¼Œåœ¨å‘é€è¯·æ±‚æŠ¥æ–‡æ—¶ä¸ºç¡®ä¿å“åº”ä¸»é¢˜éä¹±ç ï¼Œåº”è¯¥å»é™¤ Accept-Encoding: gzip, deflate è¿™è¡Œå±æ€§ ç«¯å£é—®é¢˜ Socketé€šä¿¡éœ€è¦çŸ¥é“ä¸»æœºåœ°å€åŠå…¶ç«¯å£å· Fiddler Sessionsæˆ–Inpectorså¯çŸ¥ä¸»æœºåœ°å€åŠå…¶ç«¯å£å· ä¿å­˜çš„TCPæŠ¥æ–‡ï¼ˆä½¿ç”¨Wiresharkï¼‰å¯çŸ¥ä¸»æœºåœ°å€åŠå…¶ç«¯å£å· ä¿å­˜çš„HTTP/HTTPSæŠ¥æ–‡ï¼ˆä½¿ç”¨Fiddlerï¼‰ä»…çŸ¥ä¸»æœºåœ°å€ï¼Œå·²çŸ¥å¸¸ç”¨ç«¯å£ï¼šHTTPä¸º80/HTTPSä¸º443 è¯·æ±‚å˜åŒ– Break on Response å’Œ Run to Completion å¯¹åº”ä¼šè¯å¹¶ä¸ç›¸åŒ å¾…æ”¹è¿›äº‹é¡¹ ä¼˜åŒ–è¿‡æ»¤ä¼šè¯å’Œæ›¿æ¢å†…å®¹è„šæœ¬ï¼ˆæ­£åˆ™è¡¨è¾¾å¼ï¼‰ å‘é€å“åº”å›æµè§ˆå™¨ï¼ˆSocketå‘å…¶å®ƒè¿›ç¨‹å‘æŠ¥æ–‡ï¼‰ æŒç»­åŒ–ã€å¤šçº¿ç¨‹æŠ“åŒ…ã€ä¿®æ”¹ã€å‘åŒ…ï¼ˆå¤šçº¿ç¨‹ç¼–ç¨‹ï¼‰","link":"/2019/10/11/HTTPçš„é€šä¿¡ç›‘æ§å’Œå›æ”¾ï¼šFiddleræŠ“åŒ…ä¸Socketå‘åŒ…/"},{"title":"#Golang# Golangä¸ç¼–ç¨‹èŒƒå¼ä¹‹é¢å‘å¯¹è±¡ç¼–ç¨‹","text":"ä»‹ç» Golang ä¸­çš„é¢å‘å¯¹è±¡æ€æƒ³å®è·µï¼Œä¸»è¦è®¨è®ºä»¥ä¸‹å››ä¸ªéƒ¨åˆ†ï¼š ç±»å’Œå¯¹è±¡ å°è£… ç»§æ‰¿ å¤šæ€ ç›®å½• Table of Contents ç®€ä»‹ Golang çš„èµ·æºå—è¯¸å¤šæ—©æœŸç¼–ç¨‹è¯­è¨€çš„å½±å“ã€‚ç±» C è®© Golang æœ¬è´¨ä¸Šæ›´å€¾å‘äºæ˜¯ä¸€é—¨é¢å‘è¿‡ç¨‹çš„è¯­è¨€ï¼ŒåŒæ—¶Golang ä¹Ÿå€Ÿé‰´äº† Alef æ¥è®¾è®¡ Golang çš„å‡½æ•°å¼ç¼–ç¨‹ç‰¹æ€§ï¼Œèåˆ CSP ä¸­ä½¿ç”¨ç®¡é“è¿›è¡Œé€šä¿¡å’Œæ§åˆ¶åŒæ­¥çš„æ€æƒ³åˆ™å¾ˆå¥½åœ°ä½“ç°äº†å¦‚ä½•é¢å‘æ¶ˆæ¯ç¼–ç¨‹ã€‚ è™½ç„¶ Golang ä¸æ˜¯ä¸€é—¨ä¼ ç»Ÿçš„é¢å‘å¯¹è±¡è¯­è¨€ï¼Œä½†æ˜¯ Golang çš„è®¾è®¡å´æ·±å—é¢å‘å¯¹è±¡æ€æƒ³çš„å½±å“ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ç§ Golang çš„æ–¹å¼æ¥å®ç°é¢å‘å¯¹è±¡çš„é‡è¦ç‰¹æ€§ï¼Œè¿™ä¹Ÿæ˜¯æ¥ä¸‹æ¥å°†è¦è®¨è®ºçš„é‡ç‚¹ã€‚ PSï¼šæœ¬æ–‡ just ä¸€ç‚¹è‡ªå·±çš„è§è§£ï¼Œå­¦è¯†æœ‰é™éš¾å…æœ‰è¯¯ï¼Œä¹Ÿå¸Œæœ›å¯ä»¥æŠ›ç –å¼•ç‰ï¼Œæ¬¢è¿å¤§å®¶çš„å‹˜è¯¯å’Œè®¨è®ºâ•°(ï¿£Ï‰ï¿£ï½) ç±»å’Œå¯¹è±¡ ä¼—æ‰€å‘¨çŸ¥ğŸ¤«ï¼Œç±»å’Œå¯¹è±¡æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹çš„çµé­‚ï¼ˆï¼Ÿç±»å®šä¹‰äº†ä¸€ä»¶äº‹ç‰©çš„æŠ½è±¡ç‰¹ç‚¹ï¼ŒåŒ…å«äº†æ•°æ®çš„å½¢å¼å’Œå¯¹æ•°æ®çš„æ“ä½œï¼›å¯¹è±¡æ˜¯ç±»çš„å®ä¾‹ï¼Œå¯ä»¥é€šè¿‡æ„é€ å‡½æ•°å’Œææ„å‡½æ•°æ¥è¿›è¡Œå¯¹ç”Ÿæˆå’Œé”€æ¯çš„ç‰¹æ®Šå¤„ç†ã€‚ C++ çš„ç±»å’Œå¯¹è±¡12345678910111213141516171819202122232425262728293031323334class Person {private: // æ•°æ®æˆå‘˜ string name; protected: // æ•°æ®æ–¹æ³• string getName() { return this-&gt;name; } void setName(string name) { this-&gt;name = name; } public: // æ„é€ å‡½æ•° Person(string name) { this-&gt;name = name; } // ææ„å‡½æ•° ~Person() { // ... }};int main() { Person* somebody = new Person(\"Bot\"); cout &lt;&lt; somebody-&gt;getName() &lt;&lt; endl; // Output: Bot somebody-&gt;setName(\"Exp\"); cout &lt;&lt; somebody-&gt;getName() &lt;&lt; endl; // Output: Exp return 0;} Golangçš„â€œç±»å’Œå¯¹è±¡â€1234567891011121314151617181920212223242526272829type Person struct { // æ•°æ®æˆå‘˜ name string}// æ•°æ®æ–¹æ³•func (this *Person) GetName() string { return p.name}func (this *Person) SetName(name string) { p.name = name}// æ„é€ å‡½æ•°func NewPerson(string name) *Person { return &amp;Person{ name: name, }}// ææ„å‡½æ•°// ç”±äº Golang é‡‡ç”¨åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œä¸€èˆ¬ä¸éœ€è¦æ˜¾å¼å†™ææ„å‡½æ•°func main() { somebody := NewPerson(\"Bot\") fmt.Println(somebody.getName()) // Output: Bot somebody.SetName(\"Exp\") fmt.Println(somebody.getName()) // Output: Exp} åŒºåˆ«è”ç³»è€¦åˆç¨‹åº¦ C++ çš„ç±»æ˜¯é¢å‘ class è€Œè¨€çš„ï¼Œæ•°æ®æˆå‘˜å’Œæ•°æ®æ–¹æ³•éƒ½å¿…é¡»åœ¨ class å†…ä¿®æ”¹ï¼Œå¯è§è€¦åˆç¨‹åº¦è¾ƒé«˜ã€‚ Golang çš„â€œç±»â€æ˜¯é¢å‘ type è€Œè¨€çš„ï¼Œæ•°æ®æˆå‘˜åœ¨ struct å†…ä¿®æ”¹ï¼Œæ•°æ®æ–¹æ³•åˆ™æ˜¯å¯ä»¥åœ¨ä»»æ„å¤„å¢åˆ  (recv *receiver_type) å¯¹åº”çš„æ–¹æ³•ï¼Œå¯è§è€¦åˆç¨‹åº¦è¾ƒä½ã€‚ ã€PSï¼šè¿™é‡Œ type çš„å¤–å»¶æ¯” class è¦å¹¿ï¼Œtype é™¤åŒ…æ‹¬è‡ªå®šä¹‰ç±»å‹å¤–è¿˜æ”¯æŒå†…ç½®ç±»å‹çš„åˆ«åã€‘ this æŒ‡é’ˆ C++ å¯¹è±¡çš„ this æŒ‡é’ˆå¸¸å¸¸æ˜¯éšå¼çš„ï¼Œæ¯ä¸€ä¸ªæ•°æ®æ–¹æ³•å®é™…ä¸Šéƒ½éšå¼ä¼ å…¥äº†ä¸€ä¸ªæŒ‡å‘è¯¥å¯¹è±¡çš„ this æŒ‡é’ˆï¼š 123void setName([Person* this], string name) { this-&gt;name = name;} Golang â€œå¯¹è±¡â€çš„ this æŒ‡é’ˆå¿…é¡»æ˜¯æ˜¾å¼çš„ï¼Œä¸éš¾çœ‹å‡º this æŒ‡é’ˆæ˜¯è¿æ¥ Golang ä¸­ç±»å‹å’Œæ–¹æ³•çš„å…³é”®æ¡¥æ¢ï¼š 123func (this *Person) setName(string name) { this.name = name} æ„é€ ä¸ææ„ C++ çš„æ„é€ å‡½æ•°å’Œææ„å‡½æ•°æ˜¯æ¯”è¾ƒå®¹æ˜“ç†è§£çš„ï¼Œæ„é€ å‡½æ•°åœ¨å¯¹è±¡åˆ›å»ºæ—¶è¢«è‡ªåŠ¨è°ƒç”¨ï¼Œææ„å‡½æ•°åœ¨å¯¹è±¡é”€æ¯æ—¶è¢«è‡ªåŠ¨è°ƒç”¨ã€‚ç”±äº C++ æ— åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå’Œä½œç”¨åŸŸç´§å¯†ç›¸å…³ã€‚ Golang ä¸¥æ ¼ä¸Šæ¥è¯´æ²¡æœ‰æ„é€ å‡½æ•°å’Œææ„å‡½æ•°çš„è¯´æ³•ï¼Œå¯ä»¥é€šè¿‡ç”¨æ¥ä¸“é—¨åšåˆå§‹åŒ–çš„å‡½æ•°æ¥æ¨¡æ‹Ÿæ„é€ å‡½æ•°ï¼Œè€Œdefer å’Œ finalizer æœ‰ç±»ä¼¼ææ„çš„æ„å‘³ï¼Œä½†æœ¬è´¨è¿˜æ˜¯å¾ˆä¸åŒçš„ã€‚ç”±äº Golang æœ‰åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå–å†³äºä½•æ—¶è¢« GC è¿›ç¨‹å›æ”¶ï¼Œä¸€èˆ¬è€Œè¨€å½“å˜é‡ä¸å†è¢«å¼•ç”¨å°±ä¼šè¢«åƒåœ¾å›æ”¶æ‰ã€‚ å°è£… å°è£… aka ä¿¡æ¯éšè—ï¼Œå…¶å®åŒ…å«äº†ä¸¤å±‚æ„æ€ï¼šä¸€æ˜¯è°ƒç”¨æ–¹æ— é¡»å…³å¿ƒå®ç°ç»†èŠ‚ï¼ŒäºŒæ˜¯è°ƒç”¨æ–¹æ— æ³•æ›´æ”¹å®ç°ç»†èŠ‚ã€‚å°è£…åœ¨ç¼–ç¨‹è¯­è¨€ä¸­ä¸€èˆ¬ä½“ç°åœ¨è®¿é—®æƒé™ä¸­ã€‚ Java çš„å°è£… ä»¥ç»å…¸çš„ OO è¯­è¨€ Java ä¸ºä¾‹ï¼Œç”±äº Java åŒæ—¶å­˜åœ¨ç±»å’ŒåŒ…çš„æ¦‚å¿µï¼Œå…¶è®¿é—®æƒé™éœ€è¦è€ƒè™‘åˆ°ä¸¤ä¸ªç»´åº¦ï¼Œç›¸å¯¹è€Œè¨€æ¯”è¾ƒå¤æ‚ã€‚å…¶ä¸­ï¼ŒJava çš„è®¿é—®æƒé™é€šè¿‡å…³é”®å­—å®šä¹‰ï¼š publicï¼šå…¬å…±å¯è§ï¼Œæ‰€æœ‰ç±»å¯è§ protectedï¼šç»§æ‰¿å¯è§ï¼Œå¿…é¡»ä¸ºç»§æ‰¿å…³ç³»ï¼Œå…è®¸è·¨åŒ… [default]ï¼šåŒ…å†…å¯è§ï¼Œä¸è¦æ±‚ç»§æ‰¿å…³ç³»ï¼Œä»…é™åŒåŒ… privateï¼šç§æœ‰å¯è§ï¼Œä»…æœ¬ç±»å¯è§ Golang çš„å°è£… è€Œåœ¨ Golang ä¸­æ²¡æœ‰æ‰€è°“çš„ç±»å’Œå¯¹è±¡æ¦‚å¿µï¼ˆæˆ–è€…è¯´å¯ä»¥ç”¨å¾ˆ Golang çš„æ–¹å¼ç±»ä¼¼å®ç°ï¼‰ï¼Œä½†å¼•å…¥äº†åŒ…ç®¡ç†æœºåˆ¶ï¼ŒGolang ä¸­åªæœ‰ç®€åŒ–çš„ä¸¤å±‚è®¿é—®æƒé™ã€‚å…¶ä¸­ï¼ŒGolang çš„è®¿é—®æƒé™é€šè¿‡æ ‡è¯†ç¬¦å¤§å°å†™å®šä¹‰ï¼š æ ‡è¯†ç¬¦é¦–å­—æ¯å¤§å†™ï¼šåŒ…å¤–å¯è§ï¼Œæ‰€æœ‰çš„åŒ…å‡å¯è§ æ ‡è¯†ç¬¦é¦–å­—æ¯å°å†™ï¼šåŒ…å†…å¯è§ï¼Œæœ¬åŒ…æ–‡ä»¶å‡å¯è§ ä¸€äº›è¯´æ˜ Golang ä¸­çš„ æ ‡è¯†ç¬¦é¦–å­—æ¯å¤§å†™ ç±»ä¼¼äº Java ä¸­çš„ public Golang ä¸­çš„ æ ‡è¯†ç¬¦é¦–å­—æ¯å°å†™ ç±»ä¼¼äº Java ä¸­çš„ [default] ç»§æ‰¿ ç»§æ‰¿æ¶‰åŠä¸‰æ–¹é¢çš„å†…å®¹ï¼šä¸€æ˜¯å­ç±»å¯ä»¥ä½¿ç”¨çˆ¶ç±»çš„å±æ€§å’Œæ–¹æ³•ï¼Œé¿å…é‡å¤ç¼–ç ï¼›äºŒæ˜¯å­ç±»å¯ä»¥è¦†ç›–çˆ¶ç±»çš„å±æ€§å’Œæ–¹æ³•ï¼Œæ˜¯å®ç°å¤šæ€çš„å¿…è¦æ¡ä»¶ä¹‹ä¸€ï¼›ä¸‰æ˜¯å­ç±»å¯ä»¥è¿½åŠ å±äºè‡ªå·±çš„å±æ€§å’Œæ–¹æ³•ï¼Œå®Œæˆå­ç±»çš„å®šåˆ¶åŠŸèƒ½ã€‚ C++ çš„ç»§æ‰¿123456789101112131415161718192021222324252627282930313233343536373839class Parent {public: // ... virtual void parentFunc() { // ... } virtual void parentFunc(params) { // ... } virtual void overrideFunc() { // Parent class content }}class Child: public Parent {public: // ... virtual void overrideFunc() { // Child class content } virtual void childFunc() { // ... }};int main() { Child* child = new Child(); child-&gt;parentFunc(); // ä½¿ç”¨çˆ¶ç±»æ–¹æ³• child-&gt;overrideFunc(); // ä½¿ç”¨å·²è¦†ç›–çš„å­ç±»æ–¹æ³• child-&gt;Parent::overrideFunc(); // ä½¿ç”¨æœªè¦†ç›–çš„çˆ¶ç±»æ–¹æ³• child-&gt;childFunc(); // ä½¿ç”¨å­ç±»æ–¹æ³• return 0;} Golang çš„ç»§æ‰¿1234567891011121314151617181920212223242526272829303132type Parent struct { // ...}func (p *Parent) ParentFunc() { // ...}func (p *Parent) OverrideFunc() { // Parent class content}type Child struct { parent Parent // ...}func (c *Child) OverrideFunc() { // Child class content}func (c *Child) ChildFunc() { // ...}func main() { child := &amp;Child{} child.ParentFunc() // ä½¿ç”¨çˆ¶ç±»æ–¹æ³• child.OverrideFunc() // ä½¿ç”¨å·²è¦†ç›–çš„å­ç±»æ–¹æ³• child.parent.OverrideFunc() // ä½¿ç”¨æœªè¦†ç›–çš„çˆ¶ç±»æ–¹æ³• child.ChildFunc() // ä½¿ç”¨å­ç±»æ–¹æ³•} ä¸€äº›è¯´æ˜ C++ çš„ç»§æ‰¿æ›´åƒæ˜¯é“¾å¼ç»§æ‰¿ï¼Œä»çˆ¶ç±»åˆ°å­ç±»è¿›è¡Œæ„é€ ï¼Œä»å­ç±»åˆ°çˆ¶ç±»è¿›è¡Œè®¿é—® Golang çš„ç»§æ‰¿æ›´åƒæ˜¯ç»„åˆç»§æ‰¿ï¼Œå­ç±»å†…åµŒä¸€ä¸ªæˆ–å¤šä¸ªçˆ¶ç±» ä» Golang çš„ç»§æ‰¿æœºåˆ¶å®¹æ˜“çœ‹å‡ºå®ƒæ”¯æŒå¤šç»§æ‰¿ï¼Œä¸€äº›ç¼–ç¨‹è¯­è¨€ï¼ˆå¦‚ Javaï¼‰ä»…æ”¯æŒå•ç»§æ‰¿ å¤šæ€ å¤šæ€æŒ‡åŒä¸€æ“ä½œä½œç”¨äºä¸åŒçš„å¯¹è±¡ï¼Œå¯ä»¥æœ‰ä¸åŒçš„è§£é‡Šï¼Œäº§ç”Ÿä¸åŒçš„æ‰§è¡Œç»“æœã€‚å½“æˆ‘ä»¬è®¨è®ºå¤šæ€æ—¶ï¼Œæˆ‘ä»¬å¸¸å¸¸ä¼šè®¨è®ºé‡è½½ä»¥åŠé‡å†™å’ŒåŠ¨æ€ç»‘å®šã€‚ è¯­è¨€åŸºç¡€æ¥å£ ç±»å‹ç»‘å®šæ–¹æ³•é›†ï¼Œæ¥å£å®šä¹‰æ–¹æ³•é›†ã€‚å¦‚æœç±»å‹ç»‘å®šçš„æ–¹æ³•é›†å’Œæ¥å£å®šä¹‰çš„æ–¹æ³•é›†é‡åˆï¼Œé‚£ä¹ˆç±»å‹å®ç°äº†æ¥å£ã€‚ ç±»å‹å†…å®šä¹‰äº†æœ‰ä»€ä¹ˆå±æ€§ï¼Œæ¥å£å†…å®šä¹‰äº†æœ‰ä»€ä¹ˆæ“ä½œï¼Œä¸¤è€…äº§ç”Ÿå…³è”çš„å…³é”®æ˜¯æ–¹æ³•æ˜¯å¦éƒ½è¢«å®ç°ã€‚ æ¥å£æ˜¯éšå¼å®ç°çš„ï¼Œä¸éœ€è¦æ˜¾å¼å£°æ˜ï¼›æ¥å£æ˜¯ä¸€ç§ç‰¹æ®Šçš„ç±»å‹ï¼Œå®ƒå¯ä»¥è¢«èµ‹å€¼æˆå®ä¾‹çš„æŒ‡é’ˆæˆ–å¼•ç”¨ã€‚ åŸºäºä»¥ä¸Šäº‹å®ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼š ä¸åŒçš„æ¥å£å¯ä»¥å®Œæˆä¸åŒçš„ç»„åˆæ“ä½œï¼› å¤šä¸ªç±»å‹å¯ä»¥å®ç°åŒä¸ªæ¥å£ï¼Œä¸€ä¸ªç±»å‹å¯ä»¥å®ç°å¤šä¸ªæ¥å£ï¼› ä¸åŒçš„ç±»å‹å®Œæˆä¸åŒçš„ç»„åˆæ“ä½œï¼Œçœ‹èµ·æ¥å´æ˜¯åŒä¸€ä¸ªæ¥å£ï¼Œè¿™å°±æ˜¯å¤šæ€ï¼ æ–­è¨€ è™½ç„¶æˆ‘ä»¬æä¾›å¯¹å¤–æä¾›äº†ç»Ÿä¸€æ¥å£è°ƒç”¨çš„æ–¹æ¡ˆï¼Œä½†æ˜¯å¯¹å†…æˆ‘ä»¬åˆ°åº•å¦‚ä½•ä»æ¥å£å‡ºå‘è¾¨åˆ«çº·ç¹çš„ç±»å‹å‘¢ï¼Ÿç»™å®šä¸€ä¸ªç±»å‹æˆ‘ä»¬åˆè¯¥å¦‚ä½•ç¡®å®šå®ƒæ˜¯å¦å®ç°äº†æŸä¸ªæ¥å£ï¼Ÿ ç±»å‹æ–­è¨€å’Œç±»å‹é€‰æ‹©ï¼šç»™å®šæ¥å£ç¡®å®šç±»å‹ 1234567891011121314// ç±»å‹æ–­è¨€if _, ok := varI.(T); ok {// ...}// ç±»å‹é€‰æ‹©switch t := varI.(type) {case T:// ...case nil:// ...default:// ...} æ¥å£æ–­è¨€ï¼šç»™å®šç±»å‹ç¡®å®šæ¥å£ 1234// æ¥å£æ–­è¨€if _, ok := varT.(I); ok {// ...} Golang çš„å¤šæ€é‡è½½ é‡è½½æ˜¯æŒ‡æ ¹æ®ä¸åŒçš„æ–¹æ³•ç­¾åè°ƒç”¨ä¸åŒçš„å‡½æ•°å®ç°ã€‚ Golang çš„è®¾è®¡æ€æƒ³ä¸­æ˜¯ä¸å…è®¸ä»»ä½•å½¢å¼çš„é‡è½½çš„ï¼Œè¿™æ˜¯ä¸ºäº†å¼ºåŒ–æ˜¾å¼åŒ–çš„é£æ ¼ã€‚ ã€PSï¼šä¸åŒç±»å‹çš„æ¥æ”¶å™¨ç»‘å®šçš„åŒåæ–¹æ³•ï¼Œä¸¥æ ¼æ¥è¯´ä¸ç®—é‡è½½ã€‘ å°½ç®¡ Golang æœ¬èº«ä¸æä¾›é‡è½½çš„æœºåˆ¶ï¼Œæˆ‘ä»¬è¿˜æ˜¯å¯ä»¥å€ŸåŠ©æ¥å£æ¥å®ç°ç±»ä¼¼çš„åŠŸèƒ½ã€‚ 12345678910111213141516171819202122func Speak(persons ...interface{}) { for _, person := range persons { switch t := person.(type) { case Chinese: // Speak Chinese case American: // Speak English case nil: // Error handler default: // Default handler } }}func main() { chinese := Chinese{} american := american{} Speak(chinese) // Speak Chinese Speak(american) // Speak English Speak(chinese, american) // chinese Speak Chinese, american Speak English} é‡å†™å’ŒåŠ¨æ€ç»‘å®š é‡å†™å’ŒåŠ¨æ€ç»‘å®šæ˜¯ä¸ºäº†å…è®¸å°†å­ç±»ç±»å‹çš„æŒ‡é’ˆèµ‹å€¼ç»™çˆ¶ç±»ç±»å‹çš„æŒ‡é’ˆï¼Œåœ¨è¿è¡Œæ—¶å¯ä»¥é€šè¿‡æŒ‡å‘çˆ¶ç±»çš„æŒ‡é’ˆæ¥è°ƒç”¨å®ç°å­ç±»ä¸­çš„æ–¹æ³•ã€‚ æ—¢ç„¶Golangä¸­ä¸å­˜åœ¨ä¸¥æ ¼çš„ç±»å’Œå¯¹è±¡ï¼Œé‡å†™å’ŒåŠ¨æ€ç»‘å®šçš„ç†è®ºå…¶å®å¹¶ä¸å¤ªé€‚åˆ Golangï¼Œæˆ‘ä»¬åªéœ€è¦å…³å¿ƒæ€ä¹ˆå°†åˆ©ç”¨ä¸€ä¸ªæ¥å£è®¿é—®å¯ä»¥å®šä½åˆ°å…·ä½“çš„ç±»å‹å°±å¯ä»¥äº†ã€‚ Golang å®ç°äº†ç¼–è¯‘æ—¶é™æ€æ¥å£åˆ¤æ–­ï¼ˆç±»å‹æ˜¯å¦å®ç°æ¥å£ï¼‰ï¼Œè¿è¡Œæ—¶åŠ¨æ€ç±»å‹é€‰æ‹©ï¼ˆåˆ°åº•æ˜¯å“ªç§ç±»å‹ï¼‰ã€‚ 1234567891011121314151617181920212223242526272829303132type Animal interface { move() // ...}type Bird struct { // ...}func (b *Bird) move() { // fly}type Pig struct { // ...}func (p *Pig) move() { // walk}func main() { var animal Animal bird := Bird{} pig := Pig{} animal = bird animal.move() // fly animal = pig animal.move() // walk} å‚è€ƒé“¾æ¥ ã€ŠGoè¯­è¨€åœ£ç»ã€‹ ã€ŠGoå…¥é—¨æŒ‡å—ã€‹ è‡´è°¢ æ„Ÿè°¢ç‹åŒå­¦åšæŒä¸æ‡ˆçš„â€œå…«ç‚¹é’Ÿæ£€æŸ¥â€ä»¥åŠä¸€ç‚¹éƒ½ä¸å«Œå¼ƒçš„â€œåº·åº·åšå®¢â€ï¼Œè®©æˆ‘å¾—ä»¥åœ¨å¿«è¦å†™ä¸ä¸‹å»çš„æ—¶å€™è¿˜åšæŒç€åšä¸€äº›æœ‰æ„ä¹‰çš„å¤è¯»ï¼ŒXOXOã€‚","link":"/2020/03/01/Golangä¸ç¼–ç¨‹èŒƒå¼(1)/"},{"title":"#Docker# LinuxOneä¸Šçš„Dockeråˆä½“éªŒ","text":"åœ¨LinuxOneä¸Šåˆ©ç”¨Dockeréƒ¨ç½²åº”ç”¨ä¸æœåŠ¡ï¼Œä¸»è¦åˆ†ä¸ºä»¥ä¸‹äº”ä¸ªéƒ¨åˆ†ï¼š ç¯å¢ƒå‡†å¤‡ Environment DockeråŸç† Theory Dockerä½¿ç”¨ Usage Dockerå®æˆ˜ Practice æ³¨æ„äº‹é¡¹ Notices ç›®å½• Table of Contents ç¯å¢ƒå‡†å¤‡ Environmentç”³è¯·Githubè´¦å·å¹¶é…ç½®å¥½æœ¬åœ°Git å»–é›ªå³°Gitæ•™ç¨‹ ç”³è¯·IBM IDè´¦å·å¹¶å¼€é€šå¼€å‘è€…è´¦å· è¯¥æ­¥éª¤ä¸»è¦æä¾›æ¥å£æƒé™ Register IBM ID ï¼ˆç»Ÿä¸€é‚®ç®±ï¼‰ Create an API Developer Portal account ï¼ˆç»Ÿä¸€é‚®ç®±ï¼‰ Apps Create new App Configure the App: Title: $TITLE Sumbit Client ID Client Secret API Products Use banking API Subscribe Default Plan Select Previous App Subscribe ç”³è¯·IBM LinuxOneè´¦å· è¯¥æ­¥éª¤ä¸»è¦æä¾›éƒ¨ç½²ç¯å¢ƒ Virtual Machine Login Virtual Services Manage Instances Create Instances Configure the Instance Type: General purpose VM Instance Name: $INSTANCE_NAME Instance Description: $INSTANCE_DESCRITION Image: RHEL7.6 SSH Key Pairs: Create â†’ Save â†’ Select â†’ Create Check the Instance Status: Active Linux User: linux1 IP Address: 148.100.xxx.xxx Private Cloud Login Catalog openmplbank Configure Input Release name Select Target Namespace Install View Helm Release Deployment AVAILABLE = 1 Launch å®‰è£…Node.jsç¯å¢ƒ å®‰è£…Node.js: Download | Node.js æ£€æŸ¥æ˜¯å¦å®‰è£…æˆåŠŸ: 12$ node -v$ npm -v å®‰è£…SSHç™»å½•å·¥å…· Windowsï¼šå¯é€‰PuTTYæˆ–Xshellæˆ–WSL Linuxï¼šssh -i /path/to/key/keyname.pem linuxusername@serveripaddress DockeråŸç† Theoryå·¥ä½œæµç¨‹ åè¯è¾¨æ æ¦‚å¿µ å«ä¹‰ Docker é•œåƒ(Images) Dockeré•œåƒæ˜¯ç”¨äºåˆ›å»ºDockerå®¹å™¨çš„æ¨¡æ¿ã€‚ Docker å®¹å™¨(Container) Dockerå®¹å™¨æ˜¯ç‹¬ç«‹è¿è¡Œçš„ä¸€ä¸ªæˆ–ä¸€ç»„åº”ç”¨ã€‚ Docker å®¢æˆ·ç«¯(Client) Dockerå®¢æˆ·ç«¯é€šè¿‡å‘½ä»¤è¡Œæˆ–è€…å…¶ä»–å·¥å…·ä½¿ç”¨Docker APIï¼Œä¸Dockerçš„å®ˆæŠ¤è¿›ç¨‹é€šä¿¡ã€‚ Docker ä¸»æœº(Host) Dockerä¸»æœºæ˜¯ä¸€ä¸ªç‰©ç†æˆ–è€…è™šæ‹Ÿçš„æœºå™¨ç”¨äºæ‰§è¡ŒDockerå®ˆæŠ¤è¿›ç¨‹å’Œå®¹å™¨ã€‚ Dockerä½¿ç”¨ Usageå®‰è£… å®‰è£…docker 123456789101112# ä¸‹è½½Dockerå½’æ¡£åŒ…wget ftp://ftp.unicamp.br/pub/linuxpatch/s390x/redhat/rhel7.3/docker-17.05.0-ce-rhel7.3-20170523.tar.gz# è§£å‹Dockerå½’æ¡£åŒ…tar -xzvf docker-17.05.0-ce-rhel7.3-20170523.tar.gz# è¿ç§»Dockerå½’æ¡£åŒ…# !!! è¿™é‡Œç›´æ¥cpåˆ°/usr/binå°±å¥½ï¼Œå› ä¸º/usr/local/binä¸åœ¨PATHç¯å¢ƒå˜é‡é‡Œ !!!cp docker-17.05.0-ce-rhel7.3-20170523/docker* /usr/bin/ å®‰è£…docker-compose 12345678910111213141516171819202122232425262728293031# æŸ¥çœ‹python-setuptoolsyum info python-setuptools# å®‰è£…python-setuptoolsyum install -y python-setuptools# å®‰è£…pipeasy_install pip# ç½‘é€Ÿè¿‡æ…¢çš„è¯å…ˆç¦ç”¨æ‰ IPv6echo 1 &gt; /proc/sys/net/ipv6/conf/all/disable_ipv6# å‡çº§backports.ssl_match_hostnamepip install backports.ssl_match_hostname --upgrade --ignore-installed# å…ˆå®‰è£…ä¾èµ–ï¼Œä¸ç„¶ä¼šæŠ¥é”™yum install python-devel libffi-devel# å®‰è£…docker-composepip install docker-compose==1.13.0# æŸ¥çœ‹docker-composeå®‰è£…æƒ…å†µå’Œç‰ˆæœ¬ä¿¡æ¯docker-compose version å‘½ä»¤ åå°å¯åŠ¨daemonè¿›ç¨‹ 1234# -g è®¾ç½®Docker Daemonè¿è¡Œæ—¶çš„æ ¹ç›®å½•# &amp; æ”¾åœ¨å‘½ä»¤åé¢è¡¨ç¤ºè®¾ç½®æ­¤è¿›ç¨‹ä¸ºåå°è¿›ç¨‹docker daemon -g /local/docker/lib &amp; å‘½ä»¤æŸ¥çœ‹dockerä¿¡æ¯ 1234567# æŸ¥çœ‹å½“å‰æœºå™¨dockerç‰ˆæœ¬è€æ—§docker version# æ£€æŸ¥åå°æœ‰æ— dockerè¿›ç¨‹è¿è¡Œps aux | grep docker dockeré•œåƒå¤„ç† 1234567891011# æŸ¥çœ‹æ‰€æœ‰é•œåƒdocker images# æ‹‰å–è¿œç¨‹é•œåƒdocker image pull repository:tag# æ„å»ºæœ¬åœ°é•œåƒdocker build -t \"repository:tag\" ./ dockerå®¹å™¨å¤„ç† 1234567891011# æŸ¥çœ‹æ‰€æœ‰å®¹å™¨docker ps# åˆ›å»ºè¿è¡Œå®¹å™¨docker run image# åœæ­¢è¿è¡Œå®¹å™¨docker stop container dockeræœåŠ¡å¤„ç† 1234567891011# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡docker-compose ps# åˆ›å»ºè¿è¡ŒæœåŠ¡docker-compose up# åœæ­¢è¿è¡ŒæœåŠ¡docker-compose down docker build 123# -t åœ¨æ–°å®¹å™¨å†…æŒ‡å®šä¸€ä¸ªä¼ªç»ˆç«¯æˆ–ç»ˆç«¯docker build -t \"repository:tag\" ./ docker run 12345# -d å¼€å¯daemonæ¨¡å¼# -i å…è®¸ä½ å¯¹å®¹å™¨å†…çš„æ ‡å‡†è¾“å…¥ (STDIN) è¿›è¡Œäº¤äº’# -p æŒ‡å®šç«¯å£æ˜ å°„è§„åˆ™docker run -d -i -p ipadress1:port1/protocal:ipadress2:port2/protocal repository:tag docker-compose up 1234# -d å¼€å¯daemonæ¨¡å¼# ç«¯å£æ˜ å°„å’Œé•œåƒæ¥æºéƒ½å†™åœ¨äº†.ymlé…ç½®æ–‡ä»¶docker-compose up -d docker exec 1234# -i å…è®¸ä½ å¯¹å®¹å™¨å†…çš„æ ‡å‡†è¾“å…¥ (STDIN) è¿›è¡Œäº¤äº’# -t åœ¨æ–°å®¹å™¨å†…æŒ‡å®šä¸€ä¸ªä¼ªç»ˆç«¯æˆ–ç»ˆç«¯docker exec â€“it container bash Dockerå®æˆ˜ Practiceåˆ‡æ¢æƒé™å’Œè·¯å¾„ï¼Œé…ç½®ç”¨æˆ·ä¹ æƒ¯123456789101112131415# åˆ‡ä¸ºæ ¹ç”¨æˆ·ï¼Œå¦åˆ™æ²¡æœ‰æƒé™sudo su# åˆ‡åˆ°å®¶ç›®å½•ï¼Œå¦åˆ™éš¾æ‰¾æ–‡ä»¶cd ~# RHEL 7.6å·²ç»è‡ªå¸¦å®‰è£…äº†VIM 7.4ï¼Œå¯åŠ¨å‘½ä»¤æ˜¯viï¼Œä¹ æƒ¯ç”¨vimå‘½ä»¤çš„åŒå­¦å¯ä»¥å…ˆè®¾ç½®ä¸€ä¸‹åˆ«å[å½“å‰ç”Ÿæ•ˆ]alias vim='vi'# RHEL 7.6å·²ç»è‡ªå¸¦å®‰è£…äº†VIM 7.4ï¼Œå¯åŠ¨å‘½ä»¤æ˜¯viï¼Œä¹ æƒ¯ç”¨vimå‘½ä»¤çš„åŒå­¦å¯ä»¥å…ˆè®¾ç½®ä¸€ä¸‹åˆ«å[æ°¸ä¹…ç”Ÿæ•ˆ]# !!! å¯ä»¥å°†alias vim='vi'åŠ åˆ°~/.bashrcä¸­ !!!source ~/.bashrc å®‰è£…å¹¶è¿è¡Œ WebSphere Libertyï¼ˆç»ƒä¹ ä½¿ç”¨docker runï¼‰123456789# æ‰‹åŠ¨æ‹‰å–websphere-libertyé•œåƒåˆ°æœ¬åœ°docker image pull s390x/websphere-liberty:webProfile7# åå°è¿è¡Œå®¹å™¨ï¼Œå¹¶æŒ‡å®šç«¯å£æ˜ å°„è§„åˆ™docker run -d -p 80:9080 -p 443:9443 s390x/websphere-liberty:webProfile7# æµè§ˆå™¨è®¿é—®http://[LinuxOne Host IP]ï¼Œå³å¯çœ‹åˆ°WebSphere Libertyçš„ç•Œé¢ å®‰è£…å¹¶è¿è¡Œ WordPressï¼ˆç»ƒä¹ ä½¿ç”¨docker-compose upï¼‰12345678910111213141516171819202122232425262728293031323334353637383940# åˆ›å»ºdocker-compose.ymlvim docker-compose.yml# ç¼–è¾‘docker-compose.ymlversion: '2'services: wordpress: image: s390x/wordpress ports: - 8080:80 # å°†æœ¬åœ° 8080 ç«¯å£æ˜ å°„åˆ°å®¹å™¨çš„ 80 ç«¯å£ environment: WORDPRESS_DB_PASSWORD: example mysql: image: brunswickheads/mariadb-5.5-s390x environment: MYSQL_ROOT_PASSWORD: example:wq# æŸ¥çœ‹docker-compose.ymlcat docker-compose.yml# åˆ›å»ºwordpressç›®å½•æ–¹ä¾¿æ•´ç†mkdir wordpressmv docker-compose.yml wordpress/cd wordpress/# æ ¹æ®docker-compose.ymlä¸­å®šä¹‰çš„æœåŠ¡å¯åŠ¨å®¹å™¨docker-compose up -d# åˆ›å»ºå®Œæˆåï¼ŒæŸ¥çœ‹ç›¸å…³å®¹å™¨çš„çŠ¶æ€docker-compose ps# æµè§ˆå™¨è®¿é—®http://[Your LinuxONE IP Address]:8080ï¼Œå³å¯çœ‹åˆ° WordPress çš„é¡µé¢ å®‰è£…å¹¶è¿è¡Œ Todo Appï¼ˆç†Ÿæ‚‰MEAN Stack + Dockeræ¶æ„ï¼‰123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101# ä¸ºæ–¹ä¾¿ç®¡ç†æ–‡ä»¶ï¼Œåˆ‡æ¢åˆ°å®¶ç›®å½•cd ~# ä»Githubæ‹‰å–æºç åˆ°æœ¬åœ°ä½¿ç”¨git clone https://github.com/IBM/Cloud-Native-Workloads-on-LinuxONE# è¿ç§»æºç æ–‡ä»¶å¤¹åˆ°å®¶ç›®å½•cp -r Cloud-Native-Workloads-on-LinuxONE/files/mean-docker ./# å®‰è£…æ˜¾ç¤ºç›®å½•æ ‘çš„æ’ä»¶åŒ…yum install -y tree# æ˜¾ç¤ºmean-dockerçš„ç›®å½•æ ‘tree mean-dockermean-dockerâ”œâ”€â”€ docker-compose.yml # docker-compose é…ç½®æ–‡ä»¶â”œâ”€â”€ express-serverâ”‚ â”œâ”€â”€ appâ”‚ â”‚ â”œâ”€â”€ modelsâ”‚ â”‚ â”‚ â””â”€â”€ todo.jsâ”‚ â”‚ â””â”€â”€ routes.jsâ”‚ â”œâ”€â”€ configâ”‚ â”‚ â””â”€â”€ database.jsâ”‚ â”œâ”€â”€ Dockerfile # docker image ç”Ÿæˆæ–‡ä»¶â”‚ â”œâ”€â”€ licenseâ”‚ â”œâ”€â”€ package.jsonâ”‚ â”œâ”€â”€ publicâ”‚ â”‚ â”œâ”€â”€ index.html # å‰ç«¯æ–‡ä»¶â”‚ â”‚ â””â”€â”€ jsâ”‚ â”‚ â”œâ”€â”€ controllersâ”‚ â”‚ â”‚ â””â”€â”€ main.js # åç«¯æ–‡ä»¶â”‚ â”‚ â”œâ”€â”€ core.jsâ”‚ â”‚ â””â”€â”€ servicesâ”‚ â”‚ â””â”€â”€ todos.js # æ•°æ®åº“æ–‡ä»¶â”‚ â”œâ”€â”€ README.mdâ”‚ â””â”€â”€ server.jsâ””â”€â”€ README.md # è¯´æ˜æ–‡æ¡£8 directories, 14 files# ä¿®æ”¹Angular.jsæˆå›½å†…é•œåƒæºvim mean-docker/express-server/public/index.htmlsrc=\"//cdn.bootcss.com/angular.js/1.2.16/angular.min.js\"# æŸ¥çœ‹Dockerfileçš„å†…å®¹cd express-server/lsvim Dockerfile# ç¼–è¾‘Dockerfileçš„å†…å®¹# Expose the port the app runs inEXPOSE 8081......# Express listening portENV PORT 8081:wq# é‡æ–°æ„å»ºé•œåƒcd mean-dockerdocker-compose down # åœæ­¢æ­£åœ¨è¿è¡Œçš„å®¹å™¨docker-compose build # å…ˆé‡æ–°æ„å»ºé•œåƒdocker-compose up # å†åŸºäºæ–°é•œåƒé‡æ–°å¯åŠ¨å®¹å™¨# æŸ¥çœ‹docker-compose.ymlçš„å†…å®¹cd mean-docker/lsvim docker-compose.yml# ç¼–è¾‘docker-compose.ymlçš„å†…å®¹# å› ä¸ºä¹‹å‰æœ¬åœ°çš„8080ç«¯å£è¢« WordPress å ç”¨äº†ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨8081ç«¯å£......ports:- \"8081:8081\" # æœ¬åœ° 8081 ç«¯å£æ˜ å°„åˆ° express å®¹å™¨çš„ 8081 ç«¯å£......:wq# å¯åŠ¨æŒ‡å®šæœåŠ¡docker-compose up -d# ä½¿ç”¨docker-compose pså‘½ä»¤æŸ¥çœ‹å¯åŠ¨çš„å®¹å™¨docker-compose ps# æµè§ˆå™¨è®¿é—®http://[ip of machine]:8081ï¼Œå³å¯çœ‹åˆ°ä½ çš„ TODO-List App Todo Appå‰ç«¯æ’å…¥æ•°æ®ã€åç«¯å¤„ç†æ•°æ®ã€æ•°æ®åº“æŸ¥æ•°æ®ï¼ˆç†Ÿæ‚‰MEAN Stack + Dockerå‰åç«¯æ•°æ®åº“äº¤äº’ï¼‰1234567891011121314151617181920212223242526272829......# åœ¨è¿è¡Œçš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤docker exec â€“it meandocker_database_1 bash# è¿›å…¥MongoDB&gt; mongo# æŸ¥çœ‹æ•°æ®åº“&gt; show dbs# æŒ‡å®šæ•°æ®åº“&gt; use docker-mean# æšä¸¾æ•°æ®è¡¨&gt; show tables# æŸ¥çœ‹å…ƒç¥–é›†&gt; db.todos.find()# æŒ‡å®šå…ƒç¥–é¡¹&gt; db.todos.find({\"key\": \"value\"}) æœ¬åœ°éƒ¨ç½²é‡‘èå¾®æœåŠ¡ï¼ˆç†Ÿæ‚‰Localhost â†’ Micro-servicesæ¨¡å¼ï¼‰12345678910111213141516171819202122232425# Fork ICp-banking-microservices åˆ°è‡ªå·±è´¦å·ä¸‹ï¼Œå°†ä½ Forkçš„é¡¹ç›®git cloneè‡³æœ¬åœ°# Githubé…ç½®è¿‡SSHgit clone git@github.com:LotteWong/ICp-banking-microservices.git# Githubæœªé…ç½®SSHgit clone https://github.com/YOUR_USERNAME/ICp-banking-microservices# åœ¨banking-application/public/js/bankingAPI.jsä¸­å¡«å…¥ä½ çš„Client IDå’ŒClient Secret# è¿›å…¥ICp-banking-microservices/banking-applicationç›®å½•ï¼Œå®‰è£…npmä¾èµ–npm install# å¦‚æœå‡ºç°npmä»£ç†è®¾ç½®é”™è¯¯ï¼Œé‡æ–°è®¾ç½®ä»£ç†å³å¯npm config set registry \"http://registry.npmjs.org/\"# è¿›å…¥ICp-banking-microservices/banking-applicationç›®å½•ï¼Œå¯åŠ¨åº”ç”¨node app.js# æµè§ˆå™¨è®¿é—®http://localhost:3000ï¼Œå³å¯è®¿é—®åº”ç”¨# éšä¾¿é€‰æ‹©ä¸€ä¸ªcustomer IDæµ‹è¯•ï¼Œè‹¥æœ‰JSONæ ¼å¼çš„æ•°æ®è¿”å›ï¼Œåˆ™è¯´æ˜APIå¯ç”¨ã€‚å¦‚æœå‡ºé”™å¯è‡ªæ’æŸ¥ï¼Œå¯èƒ½æ˜¯IDå’ŒSecretä¸åŒ¹é…ï¼ˆå‰å¾€å¼€å‘è€…é¡µé¢çš„åº”ç”¨ç¨‹åºé¡µé¢ä¸­éªŒè¯IDå’ŒSecretï¼‰æˆ–è€…æµè§ˆå™¨ä¸æ”¯æŒç½‘é€Ÿè¾ƒæ…¢ä¹‹ç±»ï¼ˆæ›´æ¢æµè§ˆå™¨æ›´æ¢ç½‘ç»œæºï¼‰ è¿œç¨‹éƒ¨ç½²é‡‘èå¾®æœåŠ¡ï¼ˆç†Ÿæ‚‰Docker â†’ Micro-servicesæ¨¡å¼ï¼‰1234567891011121314151617181920212223242526272829303132333435363738# åœ¨é LinuxOne çš„æœ¬æœºå°†é¡¹ç›®æ¨é€è‡³ Github è¿œç¨‹ä»“åº“# !!! å®é™…ä¸Šä¸åº”è¯¥æŠŠClient IDå’ŒClient Secretè¿™ç§å¯†é’¥ç±»å‹çš„æ•°æ®æ¨åˆ° Github ä¸Šï¼Œè¿™é‡Œä¸ºäº†æ–¹ä¾¿å®éªŒæš‚æ—¶è¿™ä¹ˆåšï¼Œä»¥ååˆ‡å‹¿æ¨¡ä»¿ã€‚ !!!git add public/js/bankingAPI.jsgit commit -m \"Update of bankingAPI.js\"git push origin master# å…ˆç™»å½•ä½ çš„ LinuxONE ä¸»æœºå®ä¾‹ï¼Œä¸ºæ–¹ä¾¿ç®¡ç†æ–‡ä»¶ï¼Œåˆ‡æ¢åˆ°å®¶ç›®å½•cd ~# å°†ä½  Fork ååˆæ›´æ–°çš„ä»£ç æ‹‰å–åˆ°æœ¬åœ°# Githubé…ç½®è¿‡SSHgit clone git@github.com:LotteWong/ICp-banking-microservices.git# Githubæœªé…ç½®SSHgit clone https://github.com/YOUR_USERNAME/ICp-banking-microservices# æ„å»º Docker é•œåƒdocker build -t \"respository:tag\" ./# æŸ¥çœ‹ Docker é•œåƒdocker images# å¯åŠ¨ Docker å®¹å™¨docker run -p 3000:3000 respository:tag# æŸ¥çœ‹ Docker å®¹å™¨docker ps# æµè§ˆå™¨è®¿é—®http://[LinuxOne Host IP]:3000ï¼Œå³å¯è®¿é—®åº”ç”¨# éšä¾¿é€‰æ‹©ä¸€ä¸ªcustomer IDæµ‹è¯•ï¼Œè‹¥æœ‰JSONæ ¼å¼çš„æ•°æ®è¿”å›ï¼Œåˆ™è¯´æ˜APIå¯ç”¨ã€‚å¦‚æœå‡ºé”™å¯è‡ªæ’æŸ¥ï¼Œå¯èƒ½æ˜¯IDå’ŒSecretä¸åŒ¹é…ï¼ˆå‰å¾€å¼€å‘è€…é¡µé¢çš„åº”ç”¨ç¨‹åºé¡µé¢ä¸­éªŒè¯IDå’ŒSecretï¼‰æˆ–è€…æµè§ˆå™¨ä¸æ”¯æŒç½‘é€Ÿè¾ƒæ…¢ä¹‹ç±»ï¼ˆæ›´æ¢æµè§ˆå™¨æ›´æ¢ç½‘ç»œæºï¼‰ äº‘ç«¯éƒ¨ç½²é‡‘èå¾®æœåŠ¡ï¼ˆç†Ÿæ‚‰Cloud â†’ Micro-servicesæ¨¡å¼ï¼‰123# åˆ° ICP ä¸­éƒ¨ç½²å¥½çš„åº”ç”¨ï¼Œç‚¹å‡»å¯åŠ¨ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨è·³è½¬åˆ°åˆ†é…çš„ç«¯å£# ä¹‹åå°±å’Œæ­¤å‰çš„å®éªŒä¸€æ ·äº†ï¼Œåªä¸è¿‡ä½ çš„åº”ç”¨æ˜¯éƒ¨ç½²åœ¨ ICP ä¸Šï¼Œç”± Kubernetes è‡ªåŠ¨ç»´æŠ¤å¯ç”¨çš„ Pod æ•°é‡ æ³¨æ„äº‹é¡¹ Notices ç«¯å£æ˜ å°„å°±æ˜¯å°†ä¸»æœºçš„IPåœ°å€çš„ä¸€ä¸ªç«¯å£æ˜ å°„åˆ°å±€åŸŸç½‘ä¸­ä¸€å°æœºå™¨ï¼Œå½“ç”¨æˆ·è®¿é—®è¿™ä¸ªIPçš„è¿™ä¸ªç«¯å£æ—¶ï¼ŒæœåŠ¡å™¨è‡ªåŠ¨å°†è¯·æ±‚æ˜ å°„åˆ°å¯¹åº”å±€åŸŸç½‘åˆ†æœºã€‚ .pemä¸ºé€šç”¨è¯ä¹¦æ ¼å¼ï¼Œppkä¸ºPuTTYä¸‹é¢çš„ä¸“æœ‰æ ¼å¼ã€‚ä¸¤è€…éƒ½ä¸ºSSH Key Pairsæ ¼å¼ï¼Œå†…å«å…¬é’¥å’Œå¯†é’¥ã€‚ é•œåƒæ˜¯ç±»ï¼Œå®¹å™¨æ˜¯å¯¹è±¡ï¼ŒæœåŠ¡æ˜¯å¯¹è±¡é›†ã€‚Dockerfileç”¨äºæ„å»ºé•œåƒï¼›docker-compose.ymlç”¨äºç»„ç»‡é•œåƒï¼›docker runç”¨äºå¯åŠ¨å®¹å™¨ï¼›docker-compose upç”¨äºå¯åŠ¨æœåŠ¡ã€‚ ä½¿ç”¨Dockeréœ€è¦éå¸¸æ³¨æ„å·çš„ç®¡ç†ï¼Œå¦‚æœé‡‡ç”¨é»˜è®¤åŒ¿åçš„æ–¹å¼è€Œä¸æŒ‡å®šå·çš„ä½ç½®ï¼ŒæœåŠ¡å™¨çš„å®¹é‡å¾ˆå¿«å°±ä¼šè¢«æ¯æ¬¡é‡æ–°ç”Ÿæˆçš„åŒä¸€é•œåƒç»™çˆ†æ‰ã€‚ MEAN StackåŒ…æ‹¬MongoDBï¼ˆæ•°æ®åº“ï¼‰ã€Express.jsï¼ˆè·¯ç”±ï¼‰ã€AngularJSï¼ˆå‰ç«¯ï¼‰å’ŒNode.jsï¼ˆåç«¯ï¼‰ã€‚æœ¬æ¬¡å®éªŒæœ€ç»ˆé¡¹ç›®å‹é“¾ ğŸ‘‰ SCUT Online Bank Applicationã€‚","link":"/2019/06/18/LinuxOneä¸Šçš„Dockerå®è·µ/"},{"title":"#WSL# WSLä»å…¥é—¨åˆ°...(2) Dive into WSL 1","text":"å¯¹ WSL 1 çš„ä¸€äº›å®ç°ç»†èŠ‚è¿›è¡Œè¡¥å……è¯´æ˜ï¼Œä¸»è¦åˆ†ä¸ºä»¥ä¸‹äº”ä¸ªéƒ¨åˆ†ï¼š å‰æƒ…æè¦ èƒŒæ™¯ æ¶æ„ä¸åŠŸèƒ½ æ€»ç»“ å‚è€ƒé“¾æ¥ ç›®å½• Table of Contents å‰æƒ…æè¦ å‰é¢å·²ç»ç®€è¦ä»‹ç»äº† WSL 1 å’Œ WSL 2 çš„åŒºåˆ«ï¼Œæœ¬èŠ‚å°†èšç„¦äº WSL 1çš„å®ç°ç»†èŠ‚ã€‚ç‚¹å¼€å®˜æ–¹åšå®¢å¼€å§‹æ”¶è·æƒŠ(da)å–œ(keng)ï¼Œæ‰ç–å­¦æµ…å†™é”™ä¹Ÿä¸è¦æ‰“æˆ‘ (é¢„å…ˆæ„Ÿè°¢å„ä½å‹˜è¯¯ é€ƒ ã€æ›´å¤šä¿¡æ¯ ğŸ‘‰ WSLä»å…¥é—¨åˆ°â€¦(1) WSL 1 vs WSL 2ã€‘ èƒŒæ™¯ Early subsystems were implemented as user mode modules that issued appropriate NT system calls based on the API they presented to applications for that subsystem. All applications were PE/COFF executables, a set of libraries and services to implement the subsystem API and NTDLL to perform the NT system call. When a user mode application got launched, the loader invoked the right subsystem to satisfy the application dependencies based on the executable header. æ—©æœŸçš„å­ç³»ç»Ÿé‡‡ç”¨çš„æ–¹æ³•æ˜¯ï¼Œå°†å­ç³»ç»Ÿè§†ä¸ºä¸Šå±‚çš„ä¸€ç³»åˆ—è¿›ç¨‹ç»„ï¼Œé€šè¿‡ NTDLL æä¾›çš„ API å®ç°ç”¨æˆ·æ¨¡å¼å’Œå†…æ ¸æ¨¡å¼é€šä¿¡ï¼Œå…¶ä¸­ loader å¯¹ application å’Œ subsystem è¿›è¡Œç®¡ç†ã€‚è¿™é‡Œè¿è¡Œçš„ä»ç„¶æ˜¯ Win32 binariesï¼Œéœ€è¦ç§»æ¤å’Œç»´æŠ¤ã€‚ Later versions of subsystems replaced the POSIX layer to provide the Subsystem for Unix-based Applications (SUA). The primary role of SUA was to encourage applications to get ported to Windows without significant rewrites. This was achieved by implementing the POSIX user mode APIs using NT constructs. åæ¥çš„å­ç³»ç»Ÿé‡‡ç”¨çš„æ–¹æ³•æ˜¯ï¼Œåœ¨ POSIX å±‚åšä¼˜åŒ–ï¼Œç§»æ¤è€Œä¸æ˜¯é‡å†™ã€‚è¿™é‡Œè¿è¡Œçš„ä»ç„¶æ˜¯ Win32 binariesï¼Œéœ€è¦ç§»æ¤å’Œç»´æŠ¤ã€‚ WSL is a collection of components that enables native Linux ELF64 binaries to run on Windows. It contains both user mode and kernel mode components. It is primarily comprised of: User mode session manager service that handles the Linux instance life cycle Pico provider drivers (lxss.sys, lxcore.sys) that emulate a Linux kernel by translating Linux syscalls Pico processes that host the unmodified user mode Linux (e.g. /bin/bash) WSL é‡‡ç”¨çš„æ–¹æ³•æ˜¯ï¼Œæ„é€ ä¸€æ•´å¥—åŒ…å«ç”¨æˆ·æ¨¡å¼å’Œå†…æ ¸æ¨¡å¼ç»„ä»¶çš„ç³»ç»Ÿï¼Œå…¶ä¸»è¦ç”±ç”¨æˆ·æ¨¡å¼ä¼šè¯ç®¡ç†æœåŠ¡ï¼ˆUser mode session manager serviceï¼‰ã€Pico é©±åŠ¨ï¼ˆPico provider driversï¼‰å’Œ Pico è¿›ç¨‹ ï¼ˆPico processesï¼‰ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆã€‚è¿™é‡Œè¿è¡Œçš„ä»ç„¶æ˜¯ Linux binariesï¼Œæ— éœ€ç§»æ¤å’Œç»´æŠ¤ã€‚ æ¶æ„ å·¥ä½œæµå¤§æ¦‚æ˜¯ï¼šWindows çš„ Bash é”®å…¥æŒ‡ä»¤ï¼Œäº¤ç”± LXSS Manager Service å¯åŠ¨å¯¹åº”çš„ Linux å®ä¾‹å¹¶è¿›å…¥å¯¹åº”çš„ Pico è¿›ç¨‹ï¼ŒLinux çš„ Bash é€šè¿‡ä¸­é—´å±‚çš„é©±åŠ¨å™¨ä¸ Windows Kernel è¿›è¡Œç¿»è¯‘äº¤æµï¼ˆâ€œThe lxss.sys and lxcore.sys drivers translate the Linux system calls into NT APIs and emulate the Linux kernel.â€ï¼‰ã€‚ LXSS Manager Service LXSS Manager Service è´Ÿè´£ Windows çš„ Bashï¼ˆWin32 Processï¼‰å’Œ Linux çš„ Bashï¼ˆPico Processï¼‰ä¹‹é—´çš„é€šä¿¡ï¼Œä¸»è¦åœ¨åˆå§‹æ—¶å·¥ä½œã€‚ä½œç”¨èŒƒå›´åŒ…æ‹¬ä½†ä¸å±€é™äºï¼šåŒæ­¥ Linux å®ä¾‹çš„å®‰è£…å’Œå¸è½½ã€æ¯æ¬¡åªå…è®¸ä¸€ä¸ªè¿›ç¨‹å¯åŠ¨ Linux Binary å¹¶åœ¨ pending æ—¶é˜»å¡åç»­å¯åŠ¨è¿›ç¨‹ç­‰ç­‰ã€‚ Pico Drivers Pico Drivers è´Ÿè´£ Linux Instanceï¼ˆUser Modeï¼‰å’Œ Windows Kernelï¼ˆKernel Modeï¼‰ä¹‹é—´çš„é€šä¿¡ï¼Œä¸»è¦åœ¨è¿è¡Œæ—¶å·¥ä½œã€‚ä½œç”¨èŒƒå›´åŒ…æ‹¬ä½†ä¸å±€é™äºï¼šç¿»è¯‘ Linux system calls ä¸º Windows NT APIs å¯ä»¥ç†è§£çš„å½¢å¼ï¼Œæ¨¡æ‹Ÿ Linux å†…æ ¸å¹¶å¯¹ Windows å†…æ ¸è¿›è¡Œæ“ä½œç­‰ç­‰ã€‚ Pico Processes å°†å¯æ‰§è¡Œçš„ ELF binaries åŠ è½½è¿›åˆ° Pico Processes çš„åœ°å€ç©ºé—´ï¼Œå¹¶åœ¨ Linux å±‚ä¸Šè¿è¡Œã€‚å…¶ä¸­ Linux å®ä¾‹æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ä¸º Pico Processes æœåŠ¡çš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥åŒ…å«å¹¶è¿½è¸ªæ‰€æœ‰çš„ Linux è¿›ç¨‹ã€çº¿ç¨‹å’Œè¿è¡ŒçŠ¶æ€ã€‚å®ƒåœ¨ Win32 Process é¦–æ¬¡å¯åŠ¨ Linux Binary æ—¶åˆ›å»ºï¼Œåœ¨ Win32 Process æœ€åçš„å®¢æˆ·ç«¯å…³é—­è¿æ¥æ—¶è¢«é”€æ¯ã€‚ä»æ•´ä½“ä¸Šçœ‹ï¼Œæ•´ä¸ª WSL 1 åªæœ‰ä¸€ä¸ª Linux å®ä¾‹ï¼Œå®ƒéš”ç¦»å¼€äº†æœ¬æœºåŸæœ‰çš„ Windows å’Œæ‰€æœ‰æ–°å»ºçš„ Linux ï¼›ä»å†…éƒ¨æ¥çœ‹ï¼ŒLinux å®ä¾‹å†…çš„æ¯ä¸ª Pico Process éƒ½è¢«å•ç‹¬éš”ç¦»ï¼Œè¿™ç‚¹å’Œå®¹å™¨å¾ˆç±»ä¼¼ã€‚ åŠŸèƒ½ ç”±äº Windows Kernel å’Œ Linux Kernel åŸºæœ¬ä¸Šä¸å…¼å®¹ï¼Œéœ€è¦é¢å¤–å¤„ç†å¾ˆå¤šä¸­é—´è½¬æ¢ï¼Œä¸€èˆ¬åŒ…æ‹¬ç³»ç»Ÿè°ƒç”¨ã€æ–‡ä»¶ç³»ç»Ÿã€æƒé™ç®¡ç†å’Œç½‘ç»œé…ç½®ç­‰ï¼Œä¸‹é¢ä»‹ç»æœ€åŸºæœ¬å’Œæœ€é‡è¦çš„ä¸¤ä¸ªæ–¹é¢ï¼š System Calls syscall æ˜¯å†…æ ¸æä¾›çš„ä¸€é¡¹æœåŠ¡ï¼Œå¯ä»¥åœ¨ç”¨æˆ·æ¨¡å¼ä¸‹è°ƒç”¨ã€‚Windows Kernel å’Œ Linux Kernel éƒ½æš´éœ²äº†éå¸¸å¤šçš„ syscallï¼Œä½†ä¸¤è€…å¯¹æ­¤çš„è®¾è®¡æ¨¡å¼å¹¶ä¸åŒå¯¼è‡´ä¸å…¼å®¹ã€‚ è§£å†³è¿™ç§å†²çªçš„æ–¹æ³•æ˜¯å¼•å…¥ Pico Driversï¼ˆlxss.sys and lxcore.sysï¼‰ã€‚å½“ä¸€ä¸ª Linux Kernel syscall è¢«è°ƒç”¨ï¼Œè¯¥è¯·æ±‚å°†è¢«è½¬å‘ç»™ lxcore.sysï¼Œlxcore.sys å°† Linux Kernel syscall ç¿»è¯‘æˆç­‰ä»·çš„ Windows Kernel syscallï¼Œæœ€åä¼ åˆ° Windows Kernelã€‚ç‰¹åˆ«åœ°ï¼Œå¦‚æœåœ¨ä¸¤ç§å†…æ ¸ä¹‹é—´æœ‰æŸä¸ª syscall ä¸å­˜åœ¨æ˜ å°„å…³ç³»ï¼ˆäº¦å³ä¸èƒ½äº’ç›¸ç¿»è¯‘ï¼‰ï¼Œlxss.sys è¿˜è¢«è¦æ±‚å¤„ç†è¿™ç§å¼‚å¸¸å¹¶æä¾›ç›¸åº”çš„æœåŠ¡ã€‚ ä»¥ Linux çš„ fork() ä¸ºä¾‹ï¼š As an example, the Linux fork() syscall has no direct equivalent call documented for Windows. When a fork system call is made to the Windows Subsystem for Linux, lxcore.sys does some of the initial work to prepare for copying the process. It then calls internal Windows NT kernel APIs to create the process with the correct semantics, and completes copying additional data for the new process. ä»¥ Linux çš„ chmod ä¸ºä¾‹ï¼š Linux Instance äº§ç”Ÿé™„åŠ  metadataï¼Œåªç”± Linux æ–‡ä»¶ç³»ç»Ÿèƒ½ç†è§£ï¼Œ Windows æ–‡ä»¶ç³»ç»Ÿå¹¶ä¸èƒ½ç†è§£ï¼Œä½†æ˜¯ Windows Kernel ä»ä¼šæ¥æ”¶è¯¥ metadataã€‚ä½†æ˜¯ NTFS å¯¹è¿™ä¸ª metadata æ— åŠ¨äºè¡·ï¼Œè€Œæ˜¯ lxss.sys å¤„ç†è¯¥ metadataï¼Œæœ€ç»ˆåæ˜ åˆ° ext4 ä¸­ã€‚ç”±æ­¤å¯è§ï¼ŒWSL 1 éå¸¸å¤§çš„å·¥ä½œé‡éƒ½è¦èŠ±åœ¨åº”å¯¹ä¸å…¼å®¹çš„æŒ‡ä»¤é›†ã€‚ PS: å°½ç®¡ Linux çš„å†…æ ¸æ›´æ–°å¾—éå¸¸å¿«ï¼Œç”¨æˆ·æ¨¡å¼çš„æ¥å£å´æ˜¯ç›¸å¯¹å›ºå®šçš„ï¼Œæ‰€ä»¥å¯ä»¥è®¤ä¸ºâ€œWSL 1 abstracts the Linux kernel via their interfaceâ€ File System ç”±äº Windows å’Œ Linux çš„æ–‡ä»¶ç³»ç»Ÿä¹Ÿä¸ç›¸åŒï¼ˆWindows çš„æ–‡ä»¶ç³»ç»Ÿæ˜¯ NTFSï¼ŒLinux çš„æ–‡ä»¶ç³»ç»Ÿæ˜¯ ext4ï¼‰ï¼Œä¸èƒ½ç›´æ¥äº’ç›¸æ“ä½œã€‚WSL çš„æ–‡ä»¶ç³»ç»Ÿè®¾è®¡éœ€è¦æ»¡è¶³ä¸¤ç‚¹ï¼š å®Œæ•´æ”¯æŒ Linux æ–‡ä»¶ç³»ç»Ÿ å¯è®¿é—®å’Œæ“ä½œ Windows ä¸­çš„ç£ç›˜å’Œæ–‡ä»¶ ä¸ºå®ç°ä»¥ä¸Šçš„ç›®æ ‡ WSL å¼•å…¥äº†ä¸¤å¥—æ–‡ä»¶ç³»ç»Ÿï¼ˆVolFs and DriveFsï¼‰ã€‚ VolFs æ–‡ä»¶ç³»ç»Ÿä¸»è¦æä¾›äº† Linux æ–‡ä»¶ç³»ç»Ÿç‰¹æ€§çš„æ”¯æŒï¼Œæ¯”å¦‚ Linux æ–‡ä»¶ç›®å½•ï¼ˆ/etc, /bin, /usr, etc.ï¼‰ã€æƒé™ç®¡ç†å’Œç¬¦å·é“¾æ¥ç­‰ç­‰ã€‚DriveDs æ–‡ä»¶ç³»ç»Ÿä¸»è¦ç”¨äºä¸ Windows åšäº¤äº’ï¼Œæ¯”å¦‚ Windows æ–‡ä»¶ç›®å½•ï¼ˆ/mnt/c, /mnt/d, etc.ï¼‰ã€å¯åŠ¨ Windows çš„å¯æ‰§è¡Œæ–‡ä»¶ç­‰ç­‰ã€‚ PS: éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸¤å¥—æ–‡ä»¶ç³»ç»Ÿä¹‹é—´æ˜¯å¦‚ä½•è¿›è¡Œäº¤äº’çš„å¹¶æœªåœ¨åŸåšå®¢è¯¦ç»†è®¨è®ºï¼Œæ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯è‡ªè¡Œé˜…è¯»ç»­ç¯‡ WSL File System Support æ€»ç»“ ç®€å•çš„ç†è§£ï¼šWSL 1 åœ¨ Windows Kernel ä¹‹ä¸Šåˆ›å»º Linux Instanceï¼ŒWin32 Process é€šè¿‡ LXSS Manager Service ç®¡ç† Pico Processï¼Œç”¨æˆ·æ¨¡å¼çš„ Linux Instance å’Œå†…æ ¸æ¨¡å¼çš„ Windows Kernel ä¹‹é—´é€šè¿‡ Pico Drivers äº¤æµï¼Œä¾é ä¸­é—´å±‚é©±åŠ¨å™¨ç¿»è¯‘å¯ä»¥è§£å†³ System Calls ä¸å…¼å®¹çš„é—®é¢˜ï¼Œè®¾è®¡ä¸¤å¥—æ–‡ä»¶ç³»ç»Ÿèƒ½å¤Ÿæ»¡è¶³åŒæ—¶ä½¿ç”¨ Windows å’Œ Linux çš„éœ€è¦ã€‚ å‚è€ƒé“¾æ¥ Windows Subsystem for Linux Overview Project Drawbridge","link":"/2019/12/13/WSLä»å…¥é—¨åˆ°...(2)/"},{"title":"#WSL# WSLä»å…¥é—¨åˆ°...(4) Quick Start on WSL","text":"å®‰è£…ã€é…ç½®å¹¶ä½¿ç”¨ WSL ï¼Œä¸»è¦åˆ†ä¸ºä»¥ä¸‹äº”ä¸ªéƒ¨åˆ†ï¼š å‰æƒ…æè¦ å®‰è£…å‘è¡Œç‰ˆæœ¬ ç¼–å†™é…ç½®è„šæœ¬ ä½¿ç”¨ç›¸å…³å‘½ä»¤ å‚è€ƒé“¾æ¥ ç›®å½• Table of Contents å‰æƒ…æè¦ ç»ˆäºç»“æŸæ¼«é•¿çš„å¬åŠ›ç¿»è¯‘å’Œé˜…è¯»ç†è§£ï¼Œå¼€å§‹çœŸæ­£ææœºï¼ˆæœŸå¾…åœ°æ“æ‰‹æ‰‹.gifã€‚æœ¬æ–‡å°†è§£é” WSL 1 åˆä½“éªŒï¼ˆå‘ç° Windows build ç‰ˆæœ¬å¥½åƒå¿«è½åäº†ä¸€ä¸ªä¸–çºªï¼ŒWSL 2 è£…ä¸äº†æƒ¹ã€‚ å®‰è£…å‘è¡Œç‰ˆæœ¬ é…ç½®ç›¸å…³ï¼š Windows 10 å®¶åº­ä¸­æ–‡ç‰ˆ 1903 64 ä½æ“ä½œç³»ç»Ÿï¼ŒåŸºäº x64 çš„å¤„ç†å™¨ WSL 1 Ubuntu 16.04 LTS Alpine WSL Step 1: å¼€å¯æ”¯æŒ WSL é€‰é¡¹ æ–¹æ³•ä¸€ï¼šæ§åˆ¶é¢æ¿è®¾ç½® â€œæ§åˆ¶é¢æ¿â€ -&gt; â€œç¨‹åºâ€ -&gt; â€œå¯ç”¨æˆ–å…³é—­ Windows åŠŸèƒ½â€ -&gt; â€œé€‚ç”¨äº Linux çš„ Windows å­ç³»ç»Ÿâ€ é‡å¯ç”µè„‘ æ–¹æ³•äºŒï¼šè¾“å…¥å‘½ä»¤è®¾ç½® â€œWindows PowerShellï¼ˆä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œï¼‰â€ -&gt; Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Windows-Subsystem-Linux é‡å¯ç”µè„‘ Step 2: å®‰è£… Linux å‘è¡Œç‰ˆæœ¬ æ–¹æ³•ä¸€ï¼šMicrosoft Store å®‰è£… æ‰“å¼€åº”ç”¨å•†åº— é€‰æ‹©å‘è¡Œç‰ˆæœ¬ Ubuntu 16.04 LTS Ubuntu 18.04 LTS OpenSUSE Leap 15 OpenSUSE Leap 42 SUSE Linux Enterprise Server 12 SUSE Linux Enterprise Server 15 Kali Linux Debian GNU/Linux Fedora Remix for WSL Pengwin Pengwin Enterprise Alpine WSL å®‰è£…å‘è¡Œç‰ˆæœ¬ æ–¹æ³•äºŒï¼šCommand-Line/Script å®‰è£… Manually download Windows Subsystem for Linux distro packages Step 3: é…ç½® Linux å‘è¡Œç‰ˆæœ¬ å¯åŠ¨å·²å®‰è£…å¥½çš„ Linux å‘è¡Œç‰ˆæœ¬ ç‚¹å‡»å¯åŠ¨ï¼š èœå•æ å•å‡»è¿è¡Œå‘è¡Œç‰ˆæœ¬ ç£è´´æ¿å•å‡»è¿è¡Œå‘è¡Œç‰ˆæœ¬ å‘½ä»¤å¯åŠ¨ï¼š bash.exe ï¼šé»˜è®¤ç›®å½•ä¸º Windows ç”¨æˆ·ç›®å½• distro.exeï¼šé»˜è®¤ç›®å½•ä¸º Linux ç”¨æˆ·ç›®å½• wsl.exeï¼šå…è®¸ Windows å’Œ Linux çš„å‘½ä»¤æ··ç”¨ ç­‰å¾… Linux å‘è¡Œç‰ˆæœ¬è§£å‹ç¼©å’Œåˆå§‹åŒ– åˆ›å»º Linux ä¸‹çš„æ–°ç”¨æˆ·åŠå…¶å¯†ç  ç®¡ç†å‘˜ç”¨æˆ·ä¹‹ä¸€ æ¯æ¬¡è¿›å…¥çš„é»˜è®¤ç”¨æˆ· ä¸ Windows ç”¨æˆ·åæ— å…³ å®šæœŸæ›´æ–° Linux ä¸‹çš„ Package sudo apt update &amp;&amp; sudo apt upgrade PS: å¸¸è§æŠ¥é”™è§£å†³é¡µ ğŸ‘‰ WSL troubleshooting page ç¼–å†™é…ç½®è„šæœ¬ WSL æ”¯æŒä½¿ç”¨ wsl.conf æ¥åˆå§‹åŒ–è‡ªåŠ¨æŒ‚è½½å’Œç½‘ç»œé…ç½®ä¸¤å¤§åŠŸèƒ½ã€‚wsl.conf ä½äº /etcç›®å½•ï¼Œå¦‚æœæ–‡ä»¶å·²å­˜åœ¨ï¼ŒWSL ä¼šè‡ªåŠ¨è¯»å–é€‚é…ï¼›å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œå¯ä»¥è‡ªè¡Œåœ¨ç›®å½•å†…æ–°å»ºï¼›å¦‚æœæ–‡ä»¶å‡ºé”™äº†ï¼ŒWSL ä¼šå¿½ç•¥é…ç½®æ–‡ä»¶ã€‚ è‡ªåŠ¨æŒ‚è½½Section Label: [automount] key value default notes enabled boolean true true causes fixed drives (i.e C:/ or D:/) to be automatically mounted with DrvFs under /mnt. false means drives wonâ€™t be mounted automatically, but you could still mount them manually or via fstab. mountFsTab boolean true true sets /etc/fstab to be processed on WSL start. /etc/fstab is a file where you can declare other filesystems, like an SMB share. Thus, you can mount these filesystems automatically in WSL on start up. root String /mnt/ Sets the directory where fixed drives will be automatically mounted. For example, if you have a directory in WSL at /windir/and you specify that as the root, you would expect to see your fixed drives mounted at /windir/c options comma-separated list of values empty string This value is appended to the default DrvFs mount options string. Only DrvFs-specific options can be specified. Options that the mount binary would normally parse into a flag are not supported. If you want to explicitly specify those options, you must include every drive for which you want to do so in /etc/fstab. ç½‘ç»œé…ç½®Section label: [network] key value default notes generateHosts boolean true true sets WSL to generate /etc/hosts. The hosts file contains a static map of hostnames corresponding IP address. generateResolvConf boolean true true set WSL to generate /etc/resolv.conf. The resolv.conf contains a DNS list that are capable of resolving a given hostname to its IP address. äº¤äº’æ“ä½œSection label: [interop] These options are available in Insider Build 17713 and later. key value default notes enabled boolean true Setting this key will determine whether WSL will support launching Windows processes. appendWindowsPath boolean true Setting this key will determine whether WSL will add Windows path elements to the $PATH environment variable. å…·ä½“ç¤ºä¾‹1234567891011# Enable extra metadata options by default[automount]enabled = trueroot = /windir/options = \"metadata,umask=22,fmask=11\"mountFsTab = false# Enable DNS â€“ even though these are turned on by default, weâ€™ll specify here just to be explicit.[network]generateHosts = truegenerateResolvConf = true ä½¿ç”¨ç›¸å…³å‘½ä»¤æŸ¥çœ‹ç‰ˆæœ¬åˆ—è¡¨ wsl -l, wsl --listï¼šå¯ç”¨çš„ Linux å‘è¡Œç‰ˆ wsl --list --allï¼š æœªå¯ç”¨å’Œå·²å¯ç”¨çš„ Linux å‘è¡Œç‰ˆ wsl --list --runningï¼šè¿è¡Œçš„ Linux å‘è¡Œç‰ˆ è®¾ç½®é»˜è®¤ç‰ˆæœ¬ wsl -s &lt;DistributionName&gt;, wsl --setdefault &lt;DistributionName&gt; é‡æ–°å®‰è£…ç‰ˆæœ¬ wsl --unregister &lt;DistributionName&gt; é‡å¤â€œå®‰è£…å‘è¡Œç‰ˆæœ¬â€çš„â€œStep 3: é…ç½® Linux å‘è¡Œç‰ˆæœ¬â€ æŒ‡å®šå‚æ•°ç™»å½• wsl -d, wsl --distributionï¼šæŒ‡å®šç‰ˆæœ¬ç™»å½• wsl -u, wsl --userï¼šæŒ‡å®šç”¨æˆ·ç™»å½• äº¤äº’æ“ä½œé€‰æ‹© $ echo 0 &gt; /proc/sys/fs/binfmt_misc/WSLInteropï¼šåœç”¨äº¤äº’æ“ä½œ $ echo 1 &gt; /proc/sys/fs/binfmt_misc/WSLInteropï¼šå¼€å¯äº¤äº’æ“ä½œ Windowså‘½ä»¤è¡Œè¿è¡ŒLinuxå·¥å…· wsl &lt;LinuxCommand&gt; 12345C:\\temp&gt; wsl ls -la | findstr \"foo\"-rwxrwxrwx 1 root root 14 Sep 27 14:26 foo.batC:\\temp&gt; dir | wsl grep foo09/27/2016 02:26 PM 14 foo.bat Linuxå‘½ä»¤è¡Œè¿è¡ŒWindowså·¥å…· &lt;WindowsCommand&gt; 123456$ cmd.exe /C dir&lt;- contents of C:\\ -&gt;$ PING.EXE www.microsoft.comPinging e1863.dspb.akamaiedge.net [2600:1409:a:5a2::747] with 32 bytes of data:Reply from 2600:1409:a:5a2::747: time=2ms PS: ä»¥ä¸Šé€‚ç”¨äº â€œWindows 10 Version 1903 and laterâ€œ, â€œVersions Earlier than Windows 10 Version 1903 â€œçš„å¯¹åº”ç›®å½•è¯·æŸ¥çœ‹æ–‡æœ«çš„å‚è€ƒé“¾æ¥ã€‚Windows Insiders Builds 17063 èµ·æ”¯æŒ Windows å’Œ Linux å…±äº«ç¯å¢ƒå˜é‡ï¼›Fall Creators Update èµ· Windows Path å°†åŠ å…¥ Linux $PATH ã€‚ å‚è€ƒé“¾æ¥ Windows Subsystem for Linux Documentation","link":"/2019/12/15/WSLä»å…¥é—¨åˆ°...(4)/"},{"title":"#Others# ä»é›¶åˆ°å£¹ï¼šGitHub Pages + Hexo = Blog","text":"åˆ©ç”¨GitHub Pages+Hexoæ‰“é€ ä¸€ä¸ªä¸ªäººåšå®¢ï¼Œä¸»è¦åˆ†ä¸ºä»¥ä¸‹äº”ä¸ªéƒ¨åˆ†ï¼š ç¯å¢ƒå‡†å¤‡ Environment æ–‡ä»¶é…ç½® Configuration ä¸ªæ€§åŒ– Customization åšå®¢å†™ä½œ Writing åŒå¤‡ä»½ Backup ç¯å¢ƒå‡†å¤‡ Environmentå®‰è£…Git + Github å®‰è£…Gitéƒ¨ç½²æ’ä»¶: 1$ npm install hexo-deployer-git --save å®‰è£…Node.js å®‰è£…Node.js: Download | Node.js æ£€æŸ¥æ˜¯å¦å®‰è£…æˆåŠŸ: 12$ node -v$ npm -v å®‰è£…Hexo å®‰è£…Hexo: 1$ npm install -g hexo-cli æ£€æŸ¥æ˜¯å¦å®‰è£…æˆåŠŸ: 1$ hexo -v åˆå§‹åŒ–: 1$ hexo init blog æ–‡ä»¶é…ç½® Configurationæœ¬åœ°è¿è¡Œ123$ hexo clean # åˆ é™¤ç¼“å­˜$ hexo g # ç”ŸæˆHexoé¡µé¢$ hexo s # æœ¬åœ°éƒ¨ç½²Hexoé¡µé¢ è¿œç¨‹è¿è¡Œ123$ hexo clean # åˆ é™¤ç¼“å­˜$ hexo g # ç”ŸæˆHexoé¡µé¢$ hexo d # è¿œç¨‹éƒ¨ç½²Hexoé¡µé¢ åŸºæœ¬é…ç½®/_config.yml 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485# Hexo Configuration## Docs: https://hexo.io/docs/configuration.html## Source: https://github.com/hexojs/hexo/# Sitetitle: LotteWong # ä¸ªäººåšå®¢æ˜¾ç¤ºåç§°subtitle: åœ¨ä»£ç ç¬¦å·è¡¨è±¡ä¸­é¿éš¾ã€‚ # ä¸ªäººåšå®¢å‰¯æ ‡é¢˜description: # æœç´¢å¼•æ“æè¿°ä¿¡æ¯keywords: # æœç´¢å¼•æ“å…³é”®è¯author: LotteWong # ç½‘ç«™ä½œè€…avatar: ./themes/icarus/source/images/favicon.ico # ç½‘ç«™å¤´åƒlanguage: en # ç½‘ç«™è¯­è¨€timezone: Asia/HongKong # ç½‘ç«™æ—¶åŒº# URL## If your site is put in a subdirectory, set url as 'http://yoursite.com/child' and root as '/child/'url: http://yoursite.comroot: /permalink: :year/:month/:day/:title/permalink_defaults:# Directorysource_dir: sourcepublic_dir: publictag_dir: tagsarchive_dir: archivescategory_dir: categoriescode_dir: downloads/codei18n_dir: :langskip_render:# Writingnew_post_name: :title.md # File name of new postsdefault_layout: posttitlecase: false # Transform title into titlecaseexternal_link: true # Open external links in new tabfilename_case: 0render_drafts: falsepost_asset_folder: falserelative_link: falsefuture: truehighlight: enable: true line_number: true auto_detect: false tab_replace: # Home page setting# path: Root path for your blogs index page. (default = '')# per_page: Posts displayed per page. (0 = disable pagination)# order_by: Posts order. (Order by date descending by default)index_generator: path: '' per_page: 10 order_by: -date # Category &amp; Tagdefault_category: uncategorizedcategory_map:tag_map:# Date / Time format## Hexo uses Moment.js to parse and display date## You can customize the date format as defined in## http://momentjs.com/docs/#/displaying/format/date_format: YYYY-MM-DDtime_format: HH:mm:ss# Pagination## Set per_page to 0 to disable paginationper_page: 10pagination_dir: page# Extensions## Plugins: https://hexo.io/plugins/## Themes: https://hexo.io/themes/plugins: # è®¾ç½®ä¸ªäººåšå®¢æ’ä»¶theme: icarus # è®¾ç½®ä¸ªäººåšå®¢ä¸»é¢˜# Deployment## Docs: https://hexo.io/docs/deployment.htmldeploy: type: git # éƒ¨ç½²ç±»å‹ repo: git@github.com:LotteWong/lottewong.github.io.git # éƒ¨ç½²ä»“åº“ branch: master # éƒ¨ç½²åˆ†æ”¯ ä¸ªæ€§åŒ– Customization/themes/icarus/_config.yml 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234# Version of the Icarus theme that is currently usedversion: 2.3.0# Path or URL to the website's iconfavicon: /images/favicon.ico# Path or URL to RSS atom.xmlrss: # Path or URL to the website's logo to be shown on the left of the navigation bar or footerlogo: /images/logo.png# Open Graph metadata# https://hexo.io/docs/helpers.html#open-graphopen_graph: # Facebook App ID # fb_app_id: # Facebook Admin ID # fb_admins: # Twitter ID # twitter_id: # Twitter site # twitter_site: # Google+ profile link # google_plus: # Navigation bar link settingsnavbar: # Navigation bar menu links menu: Home: / Archives: /archives Categories: /categories Tags: /tags About: /about # Navigation bar links to be shown on the right # links: # Download on GitHub: # icon: fab fa-github # url: 'https://github.com/LotteWong'# Footer section link settingsfooter: # Links to be shown on the right of the footer section links: Github: icon: fab fa-github url: 'https://github.com/LotteWong' RSS: icon: fas fa-rss url: 'https://www.zhihu.com/people/lai-xiu-ping'# Article display settingsarticle: # Code highlight theme # https://github.com/highlightjs/highlight.js/tree/master/src/styles highlight: atom-one-light # Whether to show article thumbnail images thumbnail: true # Whether to show estimate article reading time readtime: true# Search plugin settings# https://ppoffice.github.io/hexo-theme-icarus/categories/Plugins/Searchsearch: # Name of the search plugin type: insight# Comment plugin settings# https://ppoffice.github.io/hexo-theme-icarus/categories/Plugins/Commentcomment: # Name of the comment plugin type: # Donation entries# https://ppoffice.github.io/hexo-theme-icarus/categories/Donation/donate: - # Donation entry name type: alipay # Qrcode image URL qrcode: '/images/alipay.png' - # Donation entry name type: wechat # Qrcode image URL qrcode: '/images/wechat.png' - # Donation entry name type: paypal # Paypal business ID or email address business: 'SuperGsama@outlook.com' # Currency code currency_code: USD - # Donation entry name # type: patreon # URL to the Patreon page # url: ''# Share plugin settings# https://ppoffice.github.io/hexo-theme-icarus/categories/Plugins/Shareshare: # Share plugin name type: # Sidebar settings.# Please be noted that a sidebar is only visible when it has at least one widgetsidebar: # left sidebar settings left: # Whether the left sidebar is sticky when page scrolls # https://ppoffice.github.io/hexo-theme-icarus/Configuration/Theme/make-a-sidebar-sticky-when-page-scrolls/ sticky: false # right sidebar settings right: # Whether the right sidebar is sticky when page scrolls # https://ppoffice.github.io/hexo-theme-icarus/Configuration/Theme/make-a-sidebar-sticky-when-page-scrolls/ sticky: false# Sidebar widget settings# https://ppoffice.github.io/hexo-theme-icarus/categories/Widgets/widgets: - # Widget name type: profile # Where should the widget be placed, left or right position: left # Author name to be shown in the profile widget author: LotteWong # Title of the author to be shown in the profile widget author_title: SCUT, Undergraduate # Author's current location to be shown in the profile widget location: Guangzhou, China # Path or URL to the avatar to be shown in the profile widget avatar: # Email address for the Gravatar to be shown in the profile widget gravatar: # Whether to show avatar image rounded or square avatar_rounded: false # Path or URL for the follow button follow_link: 'https://www.jianshu.com/u/80ee6b6f3418' # Links to be shown on the bottom of the profile widget social_links: Project: icon: fab fa-creative-commons url: 'https://github.com/scutse-man-month-myth/InkYear' Organization: icon: fab fa-creative-commons-by url: 'https://github.com/scutse-man-month-myth' Developer: icon: fab fa-github url: 'https://github.com/LotteWong' #Facebook: #icon: fab fa-facebook #url: 'https://facebook.com' #Twitter: #icon: fab fa-twitter #url: 'https://twitter.com' #Dribbble: #icon: fab fa-dribbble #url: 'https://dribbble.com' - # Widget name type: toc # Where should the widget be placed, left or right position: left - # Widget name type: links # Where should the widget be placed, left or right position: left # Links to be shown in the links widget links: Dart: 'https://dart.dev/' Flutter: 'https://flutter.dev/' - # Widget name type: category # Where should the widget be placed, left or right position: left - # Widget name type: tagcloud # Where should the widget be placed, left or right position: left - # Widget name type: recent_posts # Where should the widget be placed, left or right position: right - # Widget name type: archive # Where should the widget be placed, left or right position: right - # Widget name type: tag # Where should the widget be placed, left or right position: right# Other plugin settingsplugins: # Enable page animations animejs: true # Enable the lightGallery and Justified Gallery plugins # https://ppoffice.github.io/hexo-theme-icarus/Plugins/General/gallery-plugin/ gallery: true # Enable the Outdated Browser plugin # http://outdatedbrowser.com/ outdated-browser: true # Enable the MathJax plugin # https://ppoffice.github.io/hexo-theme-icarus/Plugins/General/mathjax-plugin/ mathjax: true # Show the back to top button on mobile devices back-to-top: true # Google Analytics plugin settings # https://ppoffice.github.io/hexo-theme-icarus/Plugins/General/site-analytics-plugin/#Google-Analytics google-analytics: # Google Analytics tracking id tracking_id: # Baidu Analytics plugin settings # https://ppoffice.github.io/hexo-theme-icarus/Plugins/General/site-analytics-plugin/#Baidu-Analytics baidu-analytics: # Baidu Analytics tracking id tracking_id: # Hotjar user feedback plugin # https://ppoffice.github.io/hexo-theme-icarus/Plugins/General/site-analytics-plugin/#Hotjar hotjar: # Hotjar site id site_id: # Show a loading progress bar at top of the page progressbar: true # Show the copy button in the highlighted code area clipboard: true # BuSuanZi site/page view counter # https://busuanzi.ibruce.info busuanzi: false# CDN provider settings# https://ppoffice.github.io/hexo-theme-icarus/Configuration/Theme/speed-up-your-site-with-custom-cdn/providers: # Name or URL of the JavaScript and/or stylesheet CDN provider cdn: jsdelivr # Name or URL of the webfont CDN provider fontcdn: google # Name or URL of the webfont Icon CDN provider iconcdn: fontawesome åšå®¢å†™ä½œ Writing é»˜è®¤ 1$ hexo new \"blog title\" è‡ªå®šä¹‰ 1234567891011title: {{ blog title }}categories: {{ blog category }}tags:- {{ blog tag }}thumbnail: {{ blog thumbnail }}{{ Abstract }}&lt;!-- more --&gt;{{ Content }} åŒå¤‡ä»½ Backup Hexoå¤‡ä»½: 12# master branch$ hexo d Srcå¤‡ä»½: 12345# dev branch$ git checkout dev$ git add --all$ git commit -m \"new blog\"$ git push origin dev å¾…åŠäº‹é¡¹ Todos å¯¹åº”å›¾æ ‡ æ›´å¤šæ’ä»¶ ç»‘å®šåŸŸå æ›´æ–°å¤–é“¾ å‚è€ƒé“¾æ¥ References GitHub+Hexo æ­å»ºä¸ªäººç½‘ç«™è¯¦ç»†æ•™ç¨‹ Hexo icarus","link":"/2019/06/02/ä»é›¶åˆ°å£¹ï¼šGitHub Pages + Hexo = Blog/"}],"tags":[{"name":"Golang","slug":"Golang","link":"/tags/Golang/"},{"name":"Concurrency","slug":"Concurrency","link":"/tags/Concurrency/"},{"name":"Machine Learning","slug":"Machine-Learning","link":"/tags/Machine-Learning/"},{"name":"WSL","slug":"WSL","link":"/tags/WSL/"},{"name":"Git","slug":"Git","link":"/tags/Git/"},{"name":"Linux","slug":"Linux","link":"/tags/Linux/"},{"name":"Shell","slug":"Shell","link":"/tags/Shell/"},{"name":"Fiddler","slug":"Fiddler","link":"/tags/Fiddler/"},{"name":"Programming Paradigm","slug":"Programming-Paradigm","link":"/tags/Programming-Paradigm/"},{"name":"Docker","slug":"Docker","link":"/tags/Docker/"},{"name":"GitHub Pages","slug":"GitHub-Pages","link":"/tags/GitHub-Pages/"},{"name":"Hexo","slug":"Hexo","link":"/tags/Hexo/"}],"categories":[{"name":"Programming Language","slug":"Programming-Language","link":"/categories/Programming-Language/"},{"name":"Artificial Intelligence","slug":"Artificial-Intelligence","link":"/categories/Artificial-Intelligence/"},{"name":"DevOps","slug":"DevOps","link":"/categories/DevOps/"},{"name":"Quick Ref Guide","slug":"Quick-Ref-Guide","link":"/categories/Quick-Ref-Guide/"},{"name":"Sucks","slug":"Sucks","link":"/categories/Sucks/"},{"name":"Testing","slug":"Testing","link":"/categories/Testing/"},{"name":"Cloud Computing","slug":"Cloud-Computing","link":"/categories/Cloud-Computing/"},{"name":"Others","slug":"Others","link":"/categories/Others/"}]}